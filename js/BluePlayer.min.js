(function(m){var l=function(){function h(){this._listeners=[]}var l=0;h.prototype.getListeners=function(){return this._listeners=this._listeners.filter(function(k){return!k.dead}).sort(function(k,g){return k.priority-g.priority})};h.prototype.subscribe=function(k,g){void 0===g&&(g=20);var h={id:l++,handler:k,priority:g,dead:!1},m=this;this._listeners.push(h);return{remove:function(){if(!h.dead){var g=m._listeners.indexOf(h);-1<g&&m._listeners.splice(g,1);h.dead=!0}}}};h.prototype.dispatch=function(h){var g=
this;this.getListeners().forEach(function(k){g._handleCallback(k.handler,h)})};h.prototype._handleCallback=function(h,g){try{h(g)}catch(t){window.setTimeout(function(){throw t;},0)}};return h}(),p=function(){var h=null,l=null,k=!1;return{promise:new Promise(function(g,k){h=g;l=k}),resolve:function(g){k||(h(g),k=!0)},reject:function(g){k||(l(g),k=!0)},isResolved:function(){return k}}},w=function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,k){h.__proto__=k}||function(h,
k){for(var g in k)k.hasOwnProperty(g)&&(h[g]=k[g])};return function(l,k){function g(){this.constructor=l}h(l,k);null===k?l.prototype=Object.create(k):(g.prototype=k.prototype,l.prototype=new g)}}(),v=function(){function h(c){void 0===c&&(c={});if(!c.container)throw Error("Container must be exists.");void 0===c.mode&&(c.mode=g.REPEAT_LIST);void 0===c.volume&&(c.volume=100);void 0===c.customAudioType&&(c.customAudioType={});void 0===c.playlist&&(c.playlist=[]);void 0===c.handlers&&(c.handlers={});var f=
this;this.onDestructed=new l;this._id=v++;this._container=c.container;this._autoplay=c.autoplay||!1;this._random=c.random||!1;this._volume=c.volume;this._mode=c.mode;this._customAudioType=c.customAudioType;this._showAlbumName=c.showAlbumName||!1;this._enableLyric=c.enableLyric||!1;this._enableMediaSession=c.enableMediaSession||!1;this._mediaSessionForwardTime=void 0!==c.mediaSessionForwardTime?c.mediaSessionForwardTime:2E4;this._mediaSessionBackwardTime=void 0!==c.mediaSessionBackwardTime?c.mediaSessionBackwardTime:
2E4;this._activeFade=c.activeFade||!1;this._fadeDuration=c.fadeDuration||200;this._initPlaylist=c.playlist;this._labels=c.labels||{};this._messages=c.messages||{};this._handlers=c.handlers;this._initialized=!1;this._Playlist=this._Playback=this._Controller=this._UI=this._initTimerID=null;this._initializingDeferred=p();this._initializingPromise=this._initializingDeferred.promise;this._destructed=!1;this._initTimerID=window.setTimeout(function(){f._initTimerID=null;f.init()},0)}var v=0,k="undefined"!==
typeof navigator&&"mediaSession"in navigator&&navigator.mediaSession||null,g=function(){var c=[];c[c.NONE=0]="NONE";c[c.REPEAT_LIST=1]="REPEAT_LIST";c[c.REPEAT_TRACK=2]="REPEAT_TRACK";c[c.CUSTOM_LIST=3]="CUSTOM_LIST";return c}(),t=function(){var c=0;return function(f,d){this.id=c++;this.title=f.title;this.artist=f.artist||null;this.album=f.album||null;this.albumArt=f.albumArt||null;this.duration=f.duration||null;this.url=f.url||null;this.type=f.type||null;this.lrcType=f.lrcType||null;this.lrc=f.lrc||
null;this.allowRemove=f.allowRemove||!1;this.description=d||null;this.lrc||(this.lrcType=null)}}(),y=function(){function c(a,e){var b=m(this);b.hasClass("sliding")||b.addClass("sliding")}function f(a,e){var b=m(this);b.hasClass("sliding")&&b.removeClass("sliding")}function d(a,e){if(e)return a.map(function(a){return'<span class="notice">'+a+"</span>"}).join("");var b=null;return a.reduce(function(a,e,n){null===b&&(b=e[0]);b!==e[0]&&(b=e[0],a.push('<span class="blank"></span>'));a.push('<span class="lrc" data-position="'+
e[0]+'" data-index="'+n+'">'+e[1]+"</span>");return a},[]).join("")}function b(a,e,b){if(!a)throw Error("Target must be exists;");void 0===b&&(b={});var n=b.labels,c=b.messages,d=b.handlers;this._Player=e;this._currentTrackItem=null;this.onPreviousButtonClick=new l;this.onNextButtonClick=new l;this.onPlayButtonClick=new l;this.onPauseButtonClick=new l;this.onTrackItemClick=new l;this.onModeButtonClick=new l;this.onRandomButtonClick=new l;this.onVolumeButtonClick=new l;this.onTrackRemoveClick=new l;
this.onVolumeChange=new l;this.onPlaybackTimelineChange=new l;this._TrackListTemplates=[];this._ListClusterize=null;this._playLabel=n.play||"Play";this._pauseLabel=n.pause||"Pause";this._randomLabel=n.random||"Random";this._repeatLabel=n.repeat||"Repeat";this._skipForwardLabel=n.skipForward||"Skip to next track";this._skipBackwardLabel=n.skipBackward||"Skip to previous track";this._moreLabel=n.more||"More";this._removeLabel=n.remove||"Remove";this._closeLabel=n.close||"Close";this._rightClickPlayLabel=
n.rightClickPlay?n.rightClickPlay:"Play";this._rightClickPauseLabel=n.rightClickPause?n.rightClickPause:"Pause";this._rightClickRemoveTrackLabel=n.rightClickRemoveTrack?n.rightClickRemoveTrack:"Remove";this._notFoundLyricMessage=c.notFoundLyric||"";this._lyricExpanded=!1;this._CustomPlaylist=void 0!==d.CustomPlaylist?d.CustomPlaylist:!1;this._showAlbumName=b.showAlbumName||!1;this._enableLyric=void 0!==b.enableLyric?b.enableLyric:!1;this._mute=void 0!==b.mute?b.mute:!1;this._volume=void 0!==b.volume?
b.volume:100;this._random=void 0!==b.random?b.random:!1;this._mode=void 0!==b.mode&&g[b.mode]?b.mode:g.REPEAT_LIST;this._handlers=b.handlers;this._destructed=this._initialized=!1;this._$container=m(a);this._focusedTrackItemOnRightClick=this._LyricExtendSimpleBar=this._TrackListSimpleBar=this._$LyricExtendCloseButton=this._$LyricExtendContent=this._$LyricExtendWrapper=this._$LyricExtend=this._$LyricContent=this._$Lyric=this._$AlbumCoverContainer=this._$CurrentTime=this._$Duration=this._$TrackInfoTags=
this._$VolumeButton=this._$PlayNextButton=this._$PlayPrevButton=this._$PlayToggleButton=this._$RandomButton=this._$ModeButton=this._$TrackList=this._$TrackListRightClickMenu=this._$TrackListWrapper=this._$TrackLisContainer=this._$VolumeSlider=this._$PlaybackTimelineBuffered=this._$PlaybackTimelineSlider=this._$PlayerControls=this._$UI=null;this._onPlaybackTimelineChange=this._handlePlaybackTimelineChange.bind(this);this._onVolumeChangeHandler=this._handleVolumeChange.bind(this);this._onPlayToggleButtonClickHandler=
this._handlePlayToggleButtonClick.bind(this);this._onPrevButtonClickHandler=this._handlePrevButtonClick.bind(this);this._onNextButtonClickHandler=this._handleNextButtonClick.bind(this);this._onModeButtonClickHandler=this._handleModeButtonClick.bind(this);this._onRandomButtonClickHandler=this._handleRandomButtonClick.bind(this);this._onVolumeButtonClickHandler=this._handleVolumeButtonClick.bind(this);this._onTrackItemClickHandler=this._handleTrackItemClick.bind(this);this._onResizeHandler=this._onResize.bind(this);
this._onDocumentClickHandler=this._handleDocumentClick.bind(this);this._onTrackListContextHandler=this._handleTrackListContext.bind(this);this._onLyricClickHandler=this._handleLyricClick.bind(this);this._onExtendedLyricCloseButtonClickHandler=this._handleExtendedLyricCloseButtonClick.bind(this);this._onExtendedLyricLineClickHandler=this._handleExtendedLyricLineClick.bind(this);this._init()}b.msecToTimeStr=function(a){var e=Math.floor(parseInt(a,10)/1E3);if(!e||isNaN(e))e=0;a=Math.floor(e/60);e-=60*
a;10>e&&(e="0"+e);return a+":"+e};b.getTrackInfoTagsTemplate=function(a,e,b){a='<div class="Tags__Title"> <span>'+(a?a:"unknown")+"</span></div>";b&&(a+='<div class="Tags__Album"><span>'+b+"</span></div>");e&&(a+='<div class="Tags__Artist"><span>'+e+"</span></div>");return a};b.getAlbumCoverTemplate=function(a){return a?'<img class="AlbumCover__image" src="'+a+'" />':""};b.getTrackListRightClickTemplate=function(a,e,b,c){var n=!1,d=m("<ul></ul>");return a&&(a.forEach(function(a){var f=a.handler;a=
m("<li>"+a.name+"</li>");a.click(function(){f&&"function"===typeof f&&f(e,b);c&&c()});d.append(a);n=!0}),n)?d:null};b.prototype.getPlayerTemplate=function(){var a=this._Player.getID();return'<div class="BluePlayer__container">\n    <div id="BluePlayer" class="mobile'+(void 0!==a?" PlayerID_"+a:"")+'">\n\n        <div class="BluePlayer__Controls__container">\n            <div class="BluePlayer__Controls">\n                <div class="BluePlayer__TrackInfo">\n<div class="TrackInfo__Lyric__extend"><div class="closeBtn__section"><a class="controls-Icon" href="javascript:;" title="'+
this._closeLabel+'"><i class="close"></i></a></div><div class="LyricExtend__wrapper"><div class="LyricExtend__content"></div></div></div>                    <div class="TrackInfo__Description__container">\n                        <div class="TrackInfo__Description">\n                            <div class="TrackInfo__AlbumCover">\n                                <div class="AlbumCover__image__container">\n                                </div>\n                            </div>\n                            <div class="TrackInfo__Tags__wrapper">\n                                <div class="TrackInfo__Tags">\n                                    <div class="Tags__Title">\n                                        <p>Unknown</p>\n                                    </div>\n                                    <div class="Tags__Artist">\n                                        <p>Unknown</p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="TrackInfo__Lyric__container">\n                        <div class="TrackInfo__Lyric">\n                            <div class="Lyric__contents">\n                                <span class="wait">'+
this._notFoundLyricMessage+'</span>\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n\n                <div class="Controls__container">\n                    <div class="PlaybackTimeline__container">\n                        <div class="PlaybackTimeline">\n                            <div class="PlaybackTimeline__TimePassed">\n                                <span>0:00</span>\n                            </div>\n                            <div class="PlaybackTimeline__ProgressBar">\n\n                            </div>\n                            <div class="PlaybackTimeline__Duration">\n                                <span>0:00</span>\n                            </div>\n                            <div class="clear"></div>\n                        </div>\n                    </div>\n\n                    <div class="Controls__ControlBtns__container">\n                        <div class="ControlBtns__Left">\n                            <a href="javascript:;" class="controls-Icon repeat repeatStats" title="'+
this._repeatLabel+'"></a>\n                            <a href="javascript:;" class="controls-Icon random randomStats" title="'+this._randomLabel+'"></a>\n                        </div>\n\n                        <div class="ControlBtns__Right">\n                            <div class="ControlBtns__Volume">\n                                <a href="javascript:;" class="controls-Icon volume volume-large"></a>\n                                <div class="Volume__Slider">\n\n                                </div>\n                            </div>\n                        </div>\n                        <div class="clear"></div>\n                        <div class="ControlBtns__Main">\n                            <a href="javascript:;" class="controls-Icon playPrev" title="'+
this._skipBackwardLabel+'"</a>\n                            <a href="javascript:;" class="controls-Icon play playStats" title="'+this._playLabel+'"></a>\n                            <a href="javascript:;" class="controls-Icon playNext" title="'+this._skipForwardLabel+'"></a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="BluePlayer__TrackList__container"><div class="TrackList__RightClick"></div>            <div class="BluePlayer__TrackList">\n                <div class="TrackList">\n                </div>\n            </div>\n        </div>\n        <div class="clear"></div>\n    </div>\n</div>'};
b.prototype.getTrackItemTemplate=function(a,e){var n=a.id,c=a.title,d=a.artist,f=a.album,g=a.albumArt,h=a.duration,k=null;this._showAlbumName||(f=null);e=!0;if(a.allowRemove||e)k='<div class="controls">',a.allowRemove&&(k+='<a class="controls-icon remove" href="javascript:;" title="'+this._removeLabel+'"><i class="icon"></i></a>'),e&&(k+='<a class="controls-icon more" href="javascript:;" title="'+this._moreLabel+'"><i class="icon"></i></a>'),k+="</div>";return'<div class="TrackItem" data-id="'+n+
'">\n<div class="TrackItemDescription">\n<div class="TrackItemDescription__left">\n<div class="albumCover__wrapper">\n<div class="albumCover">'+(g?'<img class="albumCover__img" src="'+g+'" />':"")+'</div></div><div class="info"><div class="artist">'+(d?"<span>"+d+"</span>":"")+(d&&f?'<span class="separator"> - </span>':"")+(f?'<span class="album">'+f+"</span>":"")+'</div><div class="title"><span>'+c+'</span></div></div></div><div class="TrackItemDescription__right'+((k?" enableControl":"")+'">'+(k?
k:"")+'<div class="duration"><span>'+(h?b.msecToTimeStr(h):"")+'</span></div> </div> <div class="clear"></div> </div></div>')};b.prototype._ensureNotDestructed=function(){if(this.isDestructed())throw Error("UI was destructed");};b.prototype._init=function(){if(!this._initialized){var a=this;this._$UI=m(this.getPlayerTemplate()).find("#BluePlayer");this._$PlayerControls=this._$UI.find(".BluePlayer__Controls");this._$PlaybackTimelineSlider=this._$UI.find(".PlaybackTimeline__ProgressBar");this._$VolumeSlider=
this._$UI.find(".Volume__Slider");this._$TrackLisContainer=this._$UI.find(".BluePlayer__TrackList__container");this._$TrackListWrapper=this._$UI.find(".BluePlayer__TrackList");this._$TrackListRightClickMenu=this._$TrackLisContainer.find(".TrackList__RightClick");this._$TrackList=this._$TrackLisContainer.find(".TrackList");this._$ModeButton=this._$UI.find(".ControlBtns__Left .repeatStats");this._$RandomButton=this._$UI.find(".ControlBtns__Left .randomStats");this._$PlayToggleButton=this._$UI.find(".ControlBtns__Main .playStats");
this._$PlayPrevButton=this._$UI.find(".ControlBtns__Main .playPrev");this._$PlayNextButton=this._$UI.find(".ControlBtns__Main .playNext");this._$VolumeButton=this._$UI.find(".ControlBtns__Volume .volume");this._$TrackInfoTags=this._$UI.find(".TrackInfo__Tags");this._$Duration=this._$UI.find(".PlaybackTimeline__Duration span");this._$CurrentTime=this._$UI.find(".PlaybackTimeline__TimePassed span");this._$AlbumCoverContainer=this._$UI.find(".AlbumCover__image__container");this._$Lyric=this._$UI.find(".TrackInfo__Lyric");
this._$LyricContent=this._$UI.find(".TrackInfo__Lyric__container .Lyric__contents");this._$LyricExtend=this._$UI.find(".TrackInfo__Lyric__extend");this._$LyricExtendWrapper=this._$LyricExtend.find(".LyricExtend__wrapper");this._$LyricExtendContent=this._$LyricExtend.find(".LyricExtend__content");this._$LyricExtendCloseButton=this._$LyricExtend.find(".closeBtn__section a");this._$PlaybackTimelineSlider.slider({orientation:"horizontal",range:"min",max:0,value:0,slide:this._onPlaybackTimelineChange,
start:c,stop:f});this._$PlaybackTimelineBuffered=m('<div class="PlaybackTimelineSlider__leftBuffer"></div>');this._$PlaybackTimelineSlider.prepend(this._$PlaybackTimelineBuffered);this._$PlaybackTimelineSlider.prepend('<div class="PlaybackTimelineSlider__extend"></div>');this._$VolumeSlider.slider({orientation:"horizontal",range:"min",max:100,value:this._volume,slide:this._onVolumeChangeHandler,start:c,stop:f});this._$VolumeSlider.prepend('<div class="VlumeSlider__extend"></div>');m(document).on("click touchstart",
this._onDocumentClickHandler);this._$TrackLisContainer.on("contextmenu",this._onTrackListContextHandler);this._$PlayToggleButton.on("click",this._onPlayToggleButtonClickHandler);this._$PlayPrevButton.on("click",this._onPrevButtonClickHandler);this._$PlayNextButton.on("click",this._onNextButtonClickHandler);this._$ModeButton.on("click",this._onModeButtonClickHandler);this._$RandomButton.on("click",this._onRandomButtonClickHandler);this._$VolumeButton.on("click",this._onVolumeButtonClickHandler);this._$TrackLisContainer.on("click",
".TrackList .TrackItem[data-id]",this._onTrackItemClickHandler);this._$Lyric.on("click",this._onLyricClickHandler);this._$LyricExtendCloseButton.on("click",this._onExtendedLyricCloseButtonClickHandler);this._$LyricExtendContent.on("click",".lrc[data-position]",this._onExtendedLyricLineClickHandler);this._$container.html(this._$UI);this._initialized=!0;this._CustomPlaylist||this._mode!==g.CUSTOM_LIST||(this._mode=g.REPEAT_LIST);"SimpleBar"in window&&(this._TrackListSimpleBar=new SimpleBar(this._$TrackListWrapper[0]),
this.isEnabledLyric()&&(this._LyricExtendSimpleBar=new SimpleBar(this._$LyricExtendWrapper[0],{autoHide:!1})));this._ListClusterize=new window.Clusterize({rows:[],scrollElem:this._TrackListSimpleBar?this._TrackListSimpleBar.getScrollElement():this._$TrackListWrapper[0],contentElem:this._$TrackList[0],rows_in_block:10,show_no_data_row:!1,tag:"div",callbacks:{clusterChanged:function(e){a._onClusterChanged()}}});this.setRandom(this._random);this.setMode(this._mode);this.enableLyric(this._enableLyric);
m(window).on("resize",this._onResizeHandler);this._resizePlayer()}};b.prototype._onClusterChanged=function(){if(this._currentTrackItem){var a=this._$TrackList.find('.TrackItem[data-id="'+this._currentTrackItem.id+'"]');a.length&&!a.hasClass("current")&&a.addClass("current")}this._focusTrackItemOnRightClick()};b.prototype._onResize=function(){this._resizePlayer()};b.prototype._handleTrackItemClick=function(a){var e=m(a.currentTarget),b=m(a.srcElement?a.srcElement:a.target),c=b.parent(".controls-icon");
c.length&&(b=c);if(e=e.attr("data-id"))e=parseInt(e,10),e=this._Player._Playlist.getTrackItem(e),b.length&&b.hasClass("controls-icon")?b.hasClass("remove")?this._handleRemoveButtonClick(e):b.hasClass("more")&&this._handleMoreButtonClick(e,b,a):(a=this._Player._Playback)&&a.getCurrentTrackItem()===e?a.isReady()&&(a.isPlaying()?(a.pause(),this.setUIPlaying()):a.play()):(this.setCurrentTrackItem(e),this.onTrackItemClick.dispatch(e))};b.prototype._handlePlayToggleButtonClick=function(){this.isUIPaused()?
this._handlePauseButtonClick():this._handlePlayButtonClick()};b.prototype._handlePlayButtonClick=function(){var a=this._Player._Playback;this.setUIPaused();a.play();this.onPlayButtonClick.dispatch(void 0)};b.prototype._handlePauseButtonClick=function(){var a=this._Player._Playback;this.setUIPlaying();a.pause();this.onPauseButtonClick.dispatch(void 0)};b.prototype._handlePrevButtonClick=function(){this.onPreviousButtonClick.dispatch(void 0)};b.prototype._handleNextButtonClick=function(){this.onNextButtonClick.dispatch(void 0)};
b.prototype._handleModeButtonClick=function(){var a=this.getMode();a=void 0!==g[a+1]?a+1:0;this._CustomPlaylist||a!==g.CUSTOM_LIST||(a=void 0!==g[a+1]?a+1:0);this.setMode(a);this.onModeButtonClick.dispatch(a)};b.prototype._handleRandomButtonClick=function(){var a=this.isRandom();this.setRandom(!a);this.onRandomButtonClick.dispatch(!a)};b.prototype._handleRemoveButtonClick=function(a){if(a){var e=this._Player,b=e._Playlist,c=e._Playback;e=e._Controller;a===c.getCurrentTrackItem()&&e.skipForwardTrack(c.isPlaying()||
c.isSignalledPlay());b.removeTrackItem(a);this.removeTrackItem(a.id);this.onTrackRemoveClick.dispatch(a)}};b.prototype._handleMoreButtonClick=function(a,e,b){if(a){var c=this._getTrackListContainerOffset(),d=e.offset();b=d.left-c.left;c=d.top-c.top;d=this._getRightClickMenu(a);var n=e.outerWidth();e=e.outerHeight();n&&(b+=n/2);e&&(c+=e/2);this._showTrackListRightClickMenu(d,a,b,c)}};b.prototype._handleVolumeButtonClick=function(){var a=this._Player._Playback,e=this.isMuted();this.setMute(!e);a.setMute(!e);
this.onVolumeButtonClick.dispatch(!e)};b.prototype._handleVolumeChange=function(a,e){var b=this._Player._Playback,c=e?e.value:void 0;void 0===c&&(c=this._$VolumeSlider.slider("value"));this.isMuted()&&(this.setMute(!1),b.setMute(!1));this.onVolumeChange.dispatch(c);this.setVolume(c,!1,!0);b.setVolume(c)};b.prototype._handleLyricClick=function(){this._showLyricExtend()};b.prototype._handleExtendedLyricLineClick=function(a){a=m(a.target||a.srcElement);a=parseInt(a.attr("data-position"),10);if(!isNaN(a)&&
void 0!==a){var e=this._Player._Playback;e&&e.isReady()&&e.seek(Math.min(e.getDuration(),a+10))}};b.prototype._handleExtendedLyricCloseButtonClick=function(){this._hideLyricExtend()};b.prototype._handlePlaybackTimelineChange=function(a,e){var b=this._Player._Playback,c=e.value;this._setCurrentPosition(c);b.seek(c);this.onPlaybackTimelineChange.dispatch(c)};b.prototype._handleTrackListContext=function(a){var e=m(a.srcElement?a.srcElement:a.target);e=e.hasClass("TrackItem")?e:e.parents(".TrackItem");
var b=e.attr("data-id");if(e.length&&b&&(b=parseInt(b,10),e=this._Player._Playlist.getTrackItem(b))){var c=this._getTrackListContainerOffset();b=a.pageX-c.left;a=a.pageY-c.top;c=this._getRightClickMenu(e);this._showTrackListRightClickMenu(c,e,b,a);return!1}return!0};b.prototype._handleDocumentClick=function(a){a=m(a.srcElement?a.srcElement:a.target);var e=a.hasClass("controls-icon more")||0<a.parents(".controls-icon.more").length;a.parents(".TrackList__RightClick").length||a.is(this._$TrackListRightClickMenu)||
e||this._hideTrackListRightClickMenu()};b.prototype._showLyricExtend=function(){this.isEnabledLyric()&&(this._lyricExpanded=!0,this._$PlayerControls.hasClass("extendLyric")||this._$PlayerControls.addClass("extendLyric"),this._resizeLyricExtend())};b.prototype._hideLyricExtend=function(){this._lyricExpanded=!1;this._$PlayerControls.removeClass("extendLyric")};b.prototype._getTrackListContainerOffset=function(){var a=this._$TrackLisContainer.offset();return{top:a.top,left:a.left}};b.prototype._getRightClickMenu=
function(a){var e=[];if(a){var b=this._Player._Playback;b.getCurrentTrackItem()===a&&b.isPlaying()?e.push({name:this._rightClickPauseLabel,handler:this._getTrackItemPauseHandler(a)}):e.push({name:this._rightClickPlayLabel,handler:this._getTrackItemPlayHandler(a)});a.allowRemove&&e.push({name:this._rightClickRemoveTrackLabel,handler:this._getTrackItemRemoveHandler(a)});this._handlers&&this._handlers.trackMenu&&(e=e.concat(this._handlers.trackMenu(a)))}return e};b.prototype._getTrackItemPlayHandler=
function(a){if(a){var e=this;return function(){var b=e._Player,c=b._Playback,d=b._Playlist,f=b._Controller,g=c.getCurrentTrackItem();d=d.getTrackItemIndex(a);!b.isDestructed()&&0<=d&&(g!==a?f.setCurrentTrackItem(a,!0):c.play())}}return null};b.prototype._getTrackItemPauseHandler=function(a){if(a){var e=this;return function(){var b=e._Player,c=b._Playlist,d=b._Controller,f=b._Playback.getCurrentTrackItem();c=c.getTrackItemIndex(a);!b.isDestructed()&&0<=c&&f===a&&d.pause()}}return null};b.prototype._getTrackItemRemoveHandler=
function(a){if(a){var e=this;return function(){return e._handleRemoveButtonClick(a)}}return null};b.prototype._resizePlayer=function(){if(!this.isDestructed()){var a=this._$UI,e=this._$UI.width(),b=this.isMobileMode(),c=320>e,d=650>e,f=a.find(".ControlBtns__Right");d?(b||a.addClass("mobile"),this._$PlaybackTimelineSlider.css("width",e-94),this._$TrackLisContainer.css("width","100%"),this._$TrackListWrapper.css("max-height","")):d||(this._$PlaybackTimelineSlider.css("width",234),b&&a.removeClass("mobile"),
e=this._$UI[0].getBoundingClientRect(),e=Math.floor((e.width?e.width:e.right-e.left)-324),a=a.find(".BluePlayer__Controls__container").height(),this._$TrackLisContainer.css("width",e),this._$TrackListWrapper.css("max-height",a-1));c?f.hide():f.show();this._resizeLyricExtend(d);this._resizeTrackItemWidth(d);this._ListClusterize.refresh();this._TrackListSimpleBar&&(this._TrackListSimpleBar.recalculate(),this._$TrackListWrapper.find(".simplebar-content-wrapper").css({paddingRight:0,paddingBottom:0}))}};
b.prototype._resizeTrackItemWidth=function(a){var e=this._$TrackLisContainer.width(),b=e-130+(a?25:0);a=this._Player.getID();e="#BluePlayer.PlayerID_"+a+" .TrackItemDescription__left .info span {max-width: "+b+"px;}\n#BluePlayer.PlayerID_"+(a+" .TrackItemDescription__left .info .artist {max-width: "+b+"px;}\n#BluePlayer.PlayerID_")+(a+" .TrackItemDescription__right {left: "+(e-67)+"px; height: 48px;}\n");this.isEnabledLyric()&&(b=this._$PlayerControls.width(),e+="#BluePlayer.PlayerID_"+a+" .TrackInfo__Lyric .Lyric__contents span {width: "+
(b-1)+"px;}\n");b=this._$UI.find("style#BluePlayer__"+a+".trackItemTextWidth");b.length&&b.remove();this._$UI.prepend('<style id="BluePlayer__'+a+'" class="trackItemTextWidth">'+e+"</style>")};b.prototype._resizeLyricExtend=function(){var a=650>this._$UI.width(),b=this._$UI.find(".BluePlayer__TrackInfo"),c=this._$UI.find(".BluePlayer__Controls__container").width();a=a?this._$PlayerControls.height():b.height()-22;b=this._$LyricExtendWrapper;b.css({width:c,height:a});b=b.find(".simplebar-content");
b.length&&b.css({width:c,height:a,display:"table-cell",verticalAlign:"middle"});this.isLyricExpanded()&&(c=this._Player._Lyric)&&(c=c.getRecentLyricOffset())&&0<c.length&&this.focusExtendedLyricLine(c)};b.prototype._reflectTrackItemToPlayer=function(a){this._setTitleAndArtist(a.title,a.artist,this._showAlbumName?a.album:null);this._setAlbumCover(a.albumArt);a.duration&&(a=a.duration&&!isNaN(a.duration)?a.duration:0,this.setDuration(a))};b.prototype._getTrackItemNode=function(a){a=this._$TrackList.find('.TrackItem[data-id="'+
a.id+'"]');return a.length?a:null};b.prototype._showTrackListRightClickMenu=function(a,b,c,d){this._focusoutTrackItemOnRightClick();(a=this.constructor.getTrackListRightClickTemplate(a,b,this._Player,this._hideTrackListRightClickMenu.bind(this)))?(this._$TrackListRightClickMenu.html(""),this._$TrackListRightClickMenu.css({top:d,left:c}),this._$TrackListRightClickMenu.append(a),this._$TrackListRightClickMenu.addClass("show"),this._focusedTrackItemOnRightClick=b,this._focusTrackItemOnRightClick()):
this._hideTrackListRightClickMenu()};b.prototype._hideTrackListRightClickMenu=function(){this._focusoutTrackItemOnRightClick();this._$TrackListRightClickMenu.html("");this._$TrackListRightClickMenu.removeClass("show")};b.prototype._focusTrackItemOnRightClick=function(){if(this._focusedTrackItemOnRightClick){var a=this._$TrackList.find('.TrackItem[data-id="'+this._focusedTrackItemOnRightClick.id+'"]');a.length&&!a.hasClass("rightClick")&&a.addClass("rightClick")}};b.prototype._focusoutTrackItemOnRightClick=
function(){this._focusedTrackItemOnRightClick&&(this._$TrackList.find('.TrackItem[data-id="'+this._focusedTrackItemOnRightClick.id+'"]').removeClass("rightClick"),this._focusedTrackItemOnRightClick=null)};b.prototype._setTitleAndArtist=function(a,b,c){a=this.constructor.getTrackInfoTagsTemplate(a,b,c);this._$TrackInfoTags.html(a)};b.prototype._setAlbumCover=function(a){this._$AlbumCoverContainer.css("background-image",a?'url("'+a+'")':"")};b.prototype._setCurrentPosition=function(a){if(!a||isNaN(a))a=
0;this._$CurrentTime.html(this.constructor.msecToTimeStr(a))};b.prototype._isPlaybackTimelineSliding=function(){return this._$PlaybackTimelineSlider.hasClass("sliding")};b.prototype._isVolumeSliding=function(){return this._$VolumeSlider.hasClass("sliding")};b.prototype.setRandom=function(a){this._ensureNotDestructed();(this._random=a)?this._$RandomButton.addClass("active"):this._$RandomButton.removeClass("active")};b.prototype.setMode=function(a){this._ensureNotDestructed();this._mode=a;this._$ModeButton.removeClass("repeat-default repeat-one repeat-and-auto active");
switch(a){case g.NONE:this._$ModeButton.addClass("repeat-default");break;case g.REPEAT_LIST:this._$ModeButton.addClass("repeat-default active");break;case g.REPEAT_TRACK:this._$ModeButton.addClass("repeat-one active");break;case g.CUSTOM_LIST:this._$ModeButton.addClass("repeat-and-auto active")}};b.prototype.setDuration=function(a){this._ensureNotDestructed();if(!a||isNaN(a))a=0;this._$PlaybackTimelineSlider.slider("option","max",a);this._$Duration.html(this.constructor.msecToTimeStr(a))};b.prototype.setPosition=
function(a,b){this._ensureNotDestructed();if(!this._isPlaybackTimelineSliding()||b){if(!a||isNaN(a))a=0;this._$PlaybackTimelineSlider.slider("value",a);this._setCurrentPosition(a)}};b.prototype.setUIPlaying=function(){this._ensureNotDestructed();this._$PlayToggleButton.hasClass("pause")?this._$PlayToggleButton.removeClass("pause"):this._$PlayToggleButton.hasClass("play")||this._$PlayToggleButton.addClass("play");this._$PlayToggleButton.attr("title",this._playLabel)};b.prototype.setUIPaused=function(){this._ensureNotDestructed();
this._$PlayToggleButton.hasClass("play")?this._$PlayToggleButton.hasClass("pause")||this._$PlayToggleButton.addClass("pause"):this._$PlayToggleButton.removeClass("play");this._$PlayToggleButton.attr("title",this._pauseLabel)};b.prototype.enableLyric=function(a){this._ensureNotDestructed();a?this._$PlayerControls.addClass("EnableLyric"):this._$PlayerControls.removeClass("EnableLyric")};b.prototype.isUIPaused=function(){return this.isDestructed()?null:this._$PlayToggleButton.hasClass("pause")};b.prototype.isDestructed=
function(){return this._destructed};b.prototype.isEnabledLyric=function(){return this.isDestructed()?null:this._enableLyric};b.prototype.updateLyric=function(a){if(this.isEnabledLyric())if(!a||!a.length)this._$LyricContent.html("");else if(0<a.length){var b=[];a.forEach(function(a){b.push("<span"+(a.wait?' class="wait"':"")+">"+a.text+"</span>")});this._$LyricContent.html(b.join(""))}};b.prototype.updateExtendedLyric=function(a,b){var e=a&&0<a.length?d(a,b):"";this._$LyricExtendContent.html(e)};b.prototype.updateBufferedSlider=
function(a,b){this._$PlaybackTimelineBuffered&&this._$PlaybackTimelineBuffered.css("width",a&&a>=b?"100%":a&&b?a/b*100+"%":0)};b.prototype.focusExtendedLyricLine=function(a){if(!this.isLyricExpanded())return!1;var b=this._$LyricExtendContent;b.find(".focus").each(function(){m(this).removeClass("focus")});if(a&&0<a.length){var c=[];a.forEach(function(a){a=b.find('span[data-index="'+a+'"]');0<a.length&&(c.push(a),a.addClass("focus"))});this.scrollExtendedLyricLine(c)}};b.prototype.scrollExtendedLyricLine=
function(a){var b=m(this._LyricExtendSimpleBar.getScrollElement());if(void 0===a)b.scrollTop(0);else{var c=this._$LyricExtendWrapper,d=c.offset();c=c.height();var f=b.scrollTop(),g=0;a&&0<a.length&&(a.forEach(function(a){a=m(a);g+=a.height()}),a=a[0].offset().top+f-d.top,b.scrollTop(a-(c/2-g/2)))}};b.prototype.setVolume=function(a,b,c){this._ensureNotDestructed();if(!this._isVolumeSliding()||c)this._$VolumeButton.removeClass("volume-mute volume-small volume-large"),0>=a?this._$VolumeButton.addClass("volume-mute"):
60>=a?this._$VolumeButton.addClass("volume-small"):this._$VolumeButton.addClass("volume-large"),b||(this._volume=a),this._$VolumeSlider.slider("value",a)};b.prototype.setMute=function(a){this._ensureNotDestructed();this._mute=a;return this.setVolume(a?0:this._volume,a)};b.prototype.getMode=function(){return this.isDestructed()?null:this._mode};b.prototype.isMobileMode=function(){return this.isDestructed()?null:this._$UI.hasClass("mobile")};b.prototype.isRandom=function(){return this.isDestructed()?
null:this._random};b.prototype.isMuted=function(){return this.isDestructed()?null:this._mute};b.prototype.isLyricExpanded=function(){return this.isEnabledLyric()?this._lyricExpanded:!1};b.prototype.addTrackItems=function(a){this._ensureNotDestructed();if(a&&a.length){var b=this,c=[];a.forEach(function(a){if(a){var e=b.getTrackItemTemplate(a);c.push({TrackItem:a,template:e})}});c.length&&(a=c.map(function(a){return a.template}),this._ListClusterize.append(a),this._TrackListTemplates=this._TrackListTemplates.concat(c))}};
b.prototype.removeTrackItem=function(a){this._ensureNotDestructed();var b=[];this._TrackListTemplates=this._TrackListTemplates.filter(function(e){if(e.TrackItem&&e.TrackItem.id==a)return!1;b.push(e.template);return!0});this._ListClusterize.update(b)};b.prototype.scrollToTrackList=function(a){this._ensureNotDestructed();var b=this._$TrackList.find(".TrackItem"),c=null;b.length&&(c=b.eq(0).height());if(c){var d=this._$TrackListWrapper.css("max-height");d&&"string"===typeof d?((b=/\d+/.exec(d))&&0<b.length&&
(d=parseInt(b[0],10)),isNaN(d)&&(d=null)):d=300;b=this._TrackListSimpleBar?m(this._TrackListSimpleBar.getScrollElement()):this._$TrackListWrapper;var f=this._Player._Playlist,g=this.isMobileMode()?d:b.height()||this._$PlayerControls.height();d=f.getTrackItemCount()*c;f=f.getTrackItemIndex(a);a=g/2;-1<f&&(f*=c,g=null,f>a&&d-a>f?g=f-a+c/2:f<=a?g=0:d-a<=f&&(g=d),null!==g&&b.stop().animate({scrollTop:g},250,"swing"))}};b.prototype.focusTrackItemFromList=function(a){this._ensureNotDestructed();this._currentTrackItem&&
this.focusOutTrackItemFromList(this._currentTrackItem);(a=this._getTrackItemNode(a))&&(a.hasClass("current")||a.addClass("current"))};b.prototype.focusOutTrackItemFromList=function(a){this._ensureNotDestructed();(a=this._getTrackItemNode(a))&&a.removeClass("current")};b.prototype.setCurrentTrackItem=function(a){this._ensureNotDestructed();this._reflectTrackItemToPlayer(a);this.focusTrackItemFromList(a);this.scrollToTrackList(a);this.setPosition(0);this._currentTrackItem=a};b.prototype.destruct=function(){this.isDestructed()||
(this._TrackListSimpleBar&&(this._TrackListSimpleBar.unMount(),this._TrackListSimpleBar=null),this._ListClusterize&&(this._ListClusterize.destroy(),this._ListClusterize=null),this._TrackListTemplates=null,m(window).off("resize",this._onResizeHandler),m(document).off("click touchstart",this._onDocumentClickHandler),this._$TrackLisContainer.off("contextmenu",this._onTrackListContextHandler),this._$PlayToggleButton.off("click",this._onPlayToggleButtonClickHandler),this._$PlayPrevButton.off("click",this._onPrevButtonClickHandler),
this._$PlayNextButton.off("click",this._onNextButtonClickHandler),this._$ModeButton.off("click",this._onModeButtonClickHandler),this._$RandomButton.off("click",this._onRandomButtonClickHandler),this._$VolumeButton.off("click",this._onVolumeButtonClickHandler),this._$TrackLisContainer.off("click",".TrackList .TrackItem[data-id]",this._onTrackItemClickHandler),this._$Lyric.off("click",this._onLyricClickHandler),this._$LyricExtendCloseButton.off("click",this._onExtendedLyricCloseButtonClickHandler),
this._$LyricExtendContent.off("click",".lrc[data-position]",this._onExtendedLyricLineClickHandler),this._$PlaybackTimelineSlider.slider("destroy"),this._$VolumeSlider.slider("destroy"),this._$VolumeSlider=this._$PlaybackTimelineSlider=null,this._$UI.remove(),this._$AlbumCoverContainer=this._$CurrentTime=this._$Duration=this._$TrackInfoTags=this._$VolumeButton=this._$PlayNextButton=this._$PlayPrevButton=this._$PlayToggleButton=this._$RandomButton=this._$ModeButton=this._$TrackList=this._$TrackListRightClickMenu=
this._$TrackListWrapper=this._$TrackLisContainer=this._$VolumeSlider=this._$PlayerControls=this._$UI=null,this._destructed=!0)};return b}(),z=function(){function c(b,a){this.start=b;this.end=a;this.duration=a-b}function f(b){if("suspended"!==b.state)return{promise:Promise.resolve(),abort:function(){}};var a=!1,e=null,c=null,d=new Promise(function(a,d){e=d;c=window.setTimeout(function(){d({type:"timeout",error:null})},5E3);b.resume().then(function(){window.clearTimeout(c);a()})["catch"](function(a){window.clearTimeout(c);
d(a)})});d["catch"](function(a){a instanceof Error&&console.error(a)});return{promise:d,abort:function(){null!==c&&(window.clearTimeout(c),c=null);a||(a=!0,e&&e(void 0))}}}function d(b,a){this._audio=document.createElement("audio");this.onPlay=new l;this.onPlaying=new l;this.onPaused=new l;this.onAudioEnded=new l;this.onTimeUpdate=new l;this.onVolumeChange=new l;this.onDurationChange=new l;this.onActuallyPlaying=new l;this.onCurrentBufferedChange=new l;this.onStalled=new l;this.onSeeking=new l;this.onSeeked=
new l;this._lastPlayingPosition=this._onProgressTimerID=null;this._stalled=!0;this._actuallyPlayingTimerID=this._actuallyPlayingDeferred=this._currentTimeRange=null;this._actuallyPlayingTimerAttemptCount=0;this._actuallyPlayingLastTimeStamp=null;this._actuallyPlaying=!1;this._Player=b;this._seekTimerID=null;this._destructed=!1;this._seekDeferred=this._seekPosition=null;this._signalledPlay=!1;this._playDeferred=null;this._subscribers=[];this._listeners=[];this._activeFade=a.activeFade;this._fadeDuration=
"number"===typeof a.fadeDuration&&!isNaN(a.fadeDuration)&&0<a.fadeDuration?a.fadeDuration:200;this._WebAudio=null;this._process={fadeEndTimer:null,direction:null,value:null};this._currentTrackItem=null;this._onAudioTimeupdate=this._handleAudioTimeUpdateEvent.bind(this);this._onAudioPlaying=this._handleAudioPlayingEvent.bind(this);this._onAudioSeeked=this._handleAudioSeekedEvent.bind(this);this._onAudioSeeking=this._handleAudioSeekingEvent.bind(this);this._onAudioDurationChange=this._handleAudioDurationChangeEvent.bind(this);
this._onAudioEnded=this._handleAudioEndedEvent.bind(this);this._onAudioPlay=this._handleAudioPlayEvent.bind(this);this._onAudioPaused=this._handleAudioPausedEvent.bind(this);this._onAudioVoluemChange=this._handleAudioVolumeChangeEvent.bind(this);this._onAudioLoadedMetadata=this._handleAudioLoadedMetadataEvent.bind(this);this._onAudioLoadedData=this._handleAudioLoadedDataEvent.bind(this);this._onCurrentBufferedChangeHandler=this._handleCurrentBufferedChange.bind(this);this._onCurrentBufferedChangeSubscriber=
this.onCurrentBufferedChange.subscribe(this._onCurrentBufferedChangeHandler);this._init()}c.build=function(b,a){void 0===a&&(a=1E3);var e=[];if(b)for(var d=0;d<b.buffered.length;d++)e.push(new c(b.buffered.start(d)*a,b.buffered.end(d)*a));return e};d.prototype._onProgress=function(){if(this.isReady()){var b=!1,a=this.getPosition(),e=this.getCurrentlyBufferedTimeRange();null!==this._lastPlayingPosition&&a&&(this._stalled||this._lastPlayingPosition!==a?this._stalled&&this._lastPlayingPosition!==a&&
(this._stalled=!1):b=!0);this._lastPlayingPosition=a;b&&(this._stalled=!0,this._actuallyPlaying=!1,this._actuallyPlayingLastTimeStamp=null,this.onStalled.dispatch(void 0));if(!e&&this._currentTimeRange||e&&(!this._currentTimeRange||this._currentTimeRange.start!==e.start||this._currentTimeRange.end!==e.end))this._currentTimeRange=e,this.onCurrentBufferedChange.dispatch(e);e&&e.end>=this.getDuration()&&this._clearProgressTimer()}};d.prototype._registerProgressTimer=function(){this._clearProgressTimer();
this._onProgressTimerID=window.setInterval(this._onProgress.bind(this),100);this._onProgress()};d.prototype._clearProgressTimer=function(){null!==this._onProgressTimerID&&(window.clearInterval(this._onProgressTimerID),this._onProgressTimerID=null);this._lastPlayingPosition=this._currentTimeRange=null;this._stalled=!1};d.prototype._init=function(){this._audio.preload="metadata";this._audio.setAttribute("controlslist",["nodownload"]);this._registerAudioEvents();if(this._WebAudio=this._activeFade?this._initWebAudio():
null){var b=this._WebAudio.context.createMediaElementSource(this._audio);this._WebAudio.mediaElementSource=b;b.connect(this._WebAudio.gainNode)}};d.prototype._initWebAudio=function(){"AudioContext"in window||(this._activeFade=!1);try{if(!("AudioContext"in window))throw Error("WebAudio is not supported");var b=new window.AudioContext;if(!b.destination.maxChannelCount)throw Error("WebAudio output channels error");var a=b.createGain();a.connect(b.destination);return{context:b,gainNode:a}}catch(e){return this._activeFade=
!1,null}};d.prototype._activateWebAudio=function(){return this._WebAudio?f(this._WebAudio.context):{promise:Promise.resolve(),abort:function(){}}};d.prototype.getWebAudioState=function(){if(this._WebAudio&&this._WebAudio.context&&this._WebAudio.gainNode)return this._process.direction};d.prototype.applyWebAudioValue=function(b,a){void 0!==this._beforeFade(a)&&(this._applyFadeValue(b),a())};d.prototype.processFade=function(b,a,e){var c=this;if(void 0!==this._beforeFade(a)){var d=this._process,f=function(){c._applyFadeValue(g);
d.direction=null;d.fadeEndTimer=null;a&&a()};d.direction=b;var g="in"===b?1:"out"===b?0:null,h=this._WebAudio.context,k=this._WebAudio.gainNode;if(null===g)throw Error("Direction is must be 'in' or 'out'.");void 0===e?(this._applyFadeValue(g),f()):(a&&("in"===b?(b=Math.abs(g-1),this._applyFadeValue(Math.max(1===d.value?b:0,b))):"out"===b&&this._applyFadeValue(Math.min(d.value,Math.abs(g-1)))),k.gain.linearRampToValueAtTime(g,h.currentTime+e/1E3),d.fadeEndTimer=window.setTimeout(f,e))}};d.prototype.abortFade=
function(){if(this.getWebAudioState()){var b=this._process,a=this._WebAudio.context,e=this._WebAudio.gainNode;b.fadeEndTimer&&(e.gain.cancelScheduledValues(a.currentTime),window.clearTimeout(b.fadeEndTimer));b.fadeEndTimer=null;b.direction=null;b.value=e.gain.value}};d.prototype._applyFadeValue=function(b,a){var e=this._WebAudio.context,c=this._process;this._WebAudio.gainNode.gain.setValueAtTime(b,a||e.currentTime);c.value=b;return!0};d.prototype._beforeFade=function(b){var a=this.getWebAudioState();
if(void 0===a)"function"===typeof b&&b();else return a&&this.abortFade(),null};d.prototype._registerAudioEvents=function(){this._listenTo("play",this._onAudioPlay);this._listenTo("pause",this._onAudioPaused);this._listenTo("ended",this._onAudioEnded);this._listenTo("seeked",this._onAudioSeeked);this._listenTo("seeking",this._onAudioSeeking);this._listenTo("timeupdate",this._onAudioTimeupdate);this._listenTo("play",this._onAudioPlay);this._listenTo("playing",this._onAudioPlaying);this._listenTo("durationchange",
this._onAudioDurationChange);this._listenTo("volumechange",this._onAudioVoluemChange);this._listenTo("loadedmetadata",this._onAudioLoadedMetadata);this._listenTo("loadeddata",this._onAudioLoadedData)};d.prototype._load=function(b){if(b){var a=b.type,e=this._Player._customAudioType;if(a&&e&&e.hasOwnProperty(a)&&e[a])return e[a](this._audio,b),!0;if(b.url)return this._audio.src=b.url,this._audio.load(),!0}return!1};d.prototype._handleCurrentBufferedChange=function(b){if(!this.isDestructed()){var a=
this.getDuration();this._Player._UI.updateBufferedSlider(b?b.end:0,a)}};d.prototype._handleAudioTimeUpdateEvent=function(){if(this.isReady()){var b=this._getElementPosition(),a=this._Player._UI;this.onTimeUpdate.dispatch(b);a.setPosition(b)}this.isPlaying()&&this._checkIsActuallyPlaying()};d.prototype._handleAudioDurationChangeEvent=function(){if(this.isReady()){var b=1E3*this._audio.duration,a=this._Player._UI;this.onDurationChange.dispatch(b);a.setDuration(b)}};d.prototype._handleAudioVolumeChangeEvent=
function(){var b=this._audio.muted,a=this._audio.volume,e=this._Player._UI;e.isMuted()!==b&&e.setMute(b);b||e.setVolume(100*a);this.onVolumeChange.dispatch({muted:b,volume:100*a})};d.prototype._handleAudioSeekingEvent=function(){this.onSeeking.dispatch(this.getPosition())};d.prototype._handleAudioSeekedEvent=function(){this.onSeeked.dispatch(this.getPosition());this._registerProgressTimer()};d.prototype._handleAudioEndedEvent=function(){this._actuallyPlayingLastTimeStamp=this._getElementPosition();
this.onAudioEnded.dispatch(void 0)};d.prototype._handleAudioPlayingEvent=function(){var b=this,a=this._Player;a._registerMediaSessionHandlers();this._currentTrackItem&&a._updateMediaSessionMetadata(this._currentTrackItem);this.isActuallyPlaying()||(this._checkIsActuallyPlaying(),this._actuallyPlayingLastTimeStamp=this._getElementPosition(),this._actuallyPlayingTimerAttemptCount=0,this._actuallyPlayingTimerID||(this._actuallyPlayingTimerID=window.setInterval(function(){b._checkIsActuallyPlaying()},
20)));this.onPlaying.dispatch(void 0)};d.prototype._handleAudioPlayEvent=function(){this._Player._UI.setUIPaused();this.onPlay.dispatch()};d.prototype._handleAudioPausedEvent=function(){this._Player._UI.setUIPlaying();this.onPaused.dispatch();this._actuallyPlaying=!1};d.prototype._handleAudioLoadedDataEvent=function(){this._seekPosition&&this.isReady()&&this._handleElementSeek(this._seekPosition);this._registerProgressTimer();this._handleElementPlay()};d.prototype._handleAudioLoadedMetadataEvent=
function(){};d.prototype._checkIsActuallyPlaying=function(){this._signalledPlay&&(null!==this._actuallyPlayingTimerID&&!this.isPlaying()&&150<++this._actuallyPlayingTimerAttemptCount&&this._clearActuallyPlayingTimer(),this.isDestructed()||this.isActuallyPlaying()||!this.isPlaying()||!this._audio||this._audio.paused||this._getElementPosition()===this._actuallyPlayingLastTimeStamp||(this._clearActuallyPlayingTimer(),this._actuallyPlaying=!0,this.onActuallyPlaying.dispatch(void 0),this._actuallyPlayingDeferred.isResolved()||
this._actuallyPlayingDeferred.resolve(),this._WebAudio&&(null===this.getWebAudioState()?this.processFade("in",function(){},this._fadeDuration||200):this.processFade("in"))))};d.prototype._clearActuallyPlayingTimer=function(){null!==this._actuallyPlayingTimerID&&(window.clearInterval(this._actuallyPlayingTimerID),this._actuallyPlayingTimerID=null)};d.prototype._listenToOnce=function(b,a){var e=this._listenTo(b,function(b){a(b);e()});return e};d.prototype._listenTo=function(b,a){var e=this,c=!1,d=function(b){a(b)},
f=function(){if(!c){var a=e._listeners.indexOf(g);-1<a&&e._listeners.splice(a,1);e._audio.removeEventListener(b,d,!1);c=!0}},g={type:b,callback:a,remove:f};this._listeners.push(g);this._audio.addEventListener(b,d,!1);return f};d.prototype._removeListeners=function(){for(;0<this._listeners.length;)this._listeners.shift().remove()};d.prototype._getElementPosition=function(){return this._audio&&this._audio.currentTime&&!isNaN(this._audio.currentTime)?1E3*this._audio.currentTime:0};d.prototype.isReady=
function(){return!(this.isDestructed()||!this._audio||!this._audio.duration||isNaN(this._audio.duration))};d.prototype.isDestructed=function(){return this._destructed};d.prototype.isActuallyPlaying=function(){return this._actuallyPlaying};d.prototype.getCurrentTrackItem=function(){return this._currentTrackItem};d.prototype._getElementDuration=function(){return this._audio&&!isNaN(this._audio.duration)&&this._audio.duration?1E3*this._audio.duration:0};d.prototype.getDuration=function(){var b=this._getElementDuration(),
a=this.getCurrentTrackItem();return b?b:a&&a.duration?a.duration:0};d.prototype.getPosition=function(){return this._getElementPosition()};d.prototype._handleElementPlay=function(){if(this._playDeferred&&!this._playDeferred.isResolved()){var b=this,a=this._audio;if(a.paused){a=a.play();var e=this._activateWebAudio();if(a)a.then(function(){b._playDeferred.resolve({ActuallyPlayingPromise:b._actuallyPlayingDeferred.promise})})["catch"](function(a){e.abort();"AbortError"===a.name?b._playDeferred.resolve({ActuallyPlayingPromise:b._actuallyPlayingDeferred.promise}):
b._playDeferred.reject(a)});else this._playDeferred.resolve({ActuallyPlayingPromise:b._actuallyPlayingDeferred.promise})}else if(this.isActuallyPlaying())this._playDeferred.resolve({ActuallyPlayingPromise:Promise.resolve()});else if(this._actuallyPlayingDeferred&&!this._actuallyPlayingDeferred.isResolved())this._playDeferred.resolve({ActuallyPlayingPromise:b._actuallyPlayingDeferred.promise});else throw Error("Unexpected Error");}};d.prototype._handleElementPause=function(){var b=this;this._actuallyPlayingLastTimeStamp=
this._getElementPosition();this._signalledPlay=this._actuallyPlaying=!1;this._WebAudio?this.processFade("out",function(){b._audio.pause()},this._fadeDuration||200):this._audio.paused||this._audio.pause()};d.prototype._handleElementSeek=function(b){var a=this;this._audio.currentTime=b/1E3;this._listenToOnce("seeked",function(){a._seekDeferred.resolve()})};d.prototype.play=function(){if(this._actuallyPlaying)return Promise.resolve(Promise.resolve());if(this.isPlaying()&&this._actuallyPlayingDeferred&&
!this._actuallyPlayingDeferred.isResolved())return Promise.resolve(this._actuallyPlayingDeferred.promise);this._signalledPlay=!0;this._actuallyPlaying=!1;if(!this._playDeferred||this._playDeferred.isResolved()){if(this._playDeferred=p(),!this._actuallyPlayingDeferred||this._actuallyPlayingDeferred.isResolved())this._clearActuallyPlayingTimer(),this._actuallyPlayingDeferred=p()}else return this._playDeferred;this.isReady()&&this._handleElementPlay();this._playDeferred.promise["catch"](function(b){b&&
b instanceof Error&&console.error(b)});this._actuallyPlayingDeferred.promise["catch"](function(b){b&&b instanceof Error&&"NotAllowedError"!==b.name&&console.error(b)});return this._playDeferred.promise};d.prototype.pause=function(){this._playDeferred&&!this._playDeferred.isResolved()&&this._playDeferred.reject({type:"paused",error:null});this._actuallyPlayingDeferred&&!this._actuallyPlayingDeferred.isResolved()&&this._actuallyPlayingDeferred.reject({type:"paused",error:null});this._clearActuallyPlayingTimer();
this._handleElementPause()};d.prototype.isPlaying=function(){return this.isReady()&&!this._audio.paused};d.prototype.isSignalledPlay=function(){return this._signalledPlay};d.prototype.seek=function(b){this._seekDeferred&&!this._seekDeferred.isResolved()&&this._seekDeferred.reject({type:"rejected",position:b,error:null});this._seekDeferred=p();var a=this._seekDeferred.promise;a["catch"](function(a){a instanceof Error&&console.error(a)});this.isReady()?this._handleElementSeek(b):this._seekPosition=
b;return a};d.prototype.setVolume=function(b){this._audio.volume=b/100};d.prototype.setMute=function(b){this._audio.muted=b};d.prototype.setTrack=function(b){this._playDeferred&&!this._playDeferred.isResolved()&&(this._playDeferred.reject({type:"aborted",error:null,TrackItem:b}),this._playDeferred=null);this._actuallyPlayingDeferred&&!this._actuallyPlayingDeferred.isResolved()&&this._actuallyPlayingDeferred.reject({type:"aborted",trackItem:b,error:null});this._actuallyPlaying=!1;this._Player._Playlist.provideCurrentTrackItem(b);
this._currentTrackItem=b;this._seekPosition=null;this._signalledPlay=!1;this._load(b)};d.prototype.getBufferedTimeRanges=function(){return c.build(this._audio)};d.prototype.getCurrentlyBufferedTimeRange=function(){var b=this.getPosition();return this.getBufferedTimeRanges().find(function(a){return b>=a.start&&b<a.end})||null};d.prototype.destruct=function(){this.isDestructed()||(this._clearProgressTimer(),this._removeListeners(),this._audio&&this._audio.hasAttribute("src")&&(this._audio.removeAttribute("src"),
this._audio.load()),this._destructed=!0)};return d}(),x=function(){function c(a,b){return{promise:Promise.resolve(a),abort:function(){},isResolved:function(){return!0},getType:function(){return b||null}}}function f(a,b){var e=b.playlist,c=b.mode,d=b.handlers;this._player=a;this._destructed=!1;this._playlist=this.constructor.parse(e);this._trackMode=void 0!==g[c]?c:g.REPEAT_LIST;this._CustomPlaylist=d.CustomPlaylist?new d.CustomPlaylist(a):null;this._PlaylistManager=this._currentTrackItem=null;this._random=
b.random;this.setTrackMode(this._trackMode);this.setRandom(this._random)}var d=function(){function a(a){this._destructed=!1;this._playingTrackHistory=[];this._playlist=a;this._trackMode=this._lastHistoryItemIndex=this._lastTrackItem=null}a.prototype.buildPlaylist=function(){return null};a.prototype.provideCurrentTrackItem=function(a){if(!this._lastTrackItem)this._lastTrackItem=a;else if(a&&this._lastTrackItem!==a){for(this._lastTrackItem=a;1E3<this._playingTrackHistory.length;)null!==this._lastHistoryItemIndex&&
(this._lastHistoryItemIndex--,0>this._lastHistoryItemIndex&&(this._lastHistoryItemIndex=null)),this._playingTrackHistory.shift();a=this._playingTrackHistory.indexOf(this._lastTrackItem);-1<a&&this._playingTrackHistory.splice(a,1);this._playingTrackHistory.push(this._lastTrackItem)}};a.prototype.isDestructed=function(){return this._destructed};a.prototype.isRandom=function(){return null};a.prototype.getPreviousTrack=function(){return null};a.prototype.getNextTrack=function(){return null};a.prototype.setRandom=
function(){return null};a.prototype.resetSequence=function(){return null};a.prototype.getPreviousTrackFromHistory=function(){var a=-1;null===this._lastHistoryItemIndex&&this._lastTrackItem&&(a=this._playingTrackHistory.indexOf(this._lastTrackItem));-1===a&&(a=null===this._lastHistoryItemIndex?this._playingTrackHistory.length:this._lastHistoryItemIndex);var b=null;this._lastHistoryItemIndex=0<=a?--a:a;0<=this._lastHistoryItemIndex&&(b=this._playingTrackHistory[a]||null);return c(b,"previous_track_from_history")};
a.prototype.addTrackItems=function(a){for(var b=[];0<a.length;){var e=a.shift();-1===this._playlist.indexOf(e)&&(this._playlist.push(e),b.push(e))}return b};a.prototype.removeTrackItem=function(a){return a&&(a=this._playlist.indexOf(a),-1<a)?(this._playlist.splice(a,1),!0):!1};a.prototype.setTrackMode=function(a){return null};a.prototype.getTrackMode=function(){return this._trackMode};a.prototype.resetSequence=function(){return null};a.prototype.getType=function(){return"PLAYLIST_MANAGER"};a.prototype.destruct=
function(){this.isDestructed()||(this._destructed=!0)};return a}(),b=function(){function a(a,b){var e=d.apply(this,arguments)||this;e._pickedPlaylist=[];e._standByPlaylist=this.buildPlaylist(a.slice());e._trackMode=b}w(a,d);a.prototype.buildPlaylist=function(a){for(var b=a.length;0<b;){var e=Math.floor(Math.random()*b);b--;var c=a[b];a[b]=a[e];a[e]=c}return a};a.prototype.provideCurrentTrackItem=function(a){var b=this._standByPlaylist.indexOf(a),e=this._pickedPlaylist.indexOf(a);-1<b?this._standByPlaylist.splice(b,
1):-1<e&&this._pickedPlaylist.splice(e,1);(-1<b||-1<e)&&this._pickedPlaylist.push(a);d.prototype.provideCurrentTrackItem.call(this,a)};a.prototype.resetSequence=function(){this._lastTrackItem=null;this._pickedPlaylist=[];this._standByPlaylist=this.buildPlaylist(this._playlist.slice())};a.prototype.getPreviousTrackItem=function(){return this.getPreviousTrackFromHistory()};a.prototype.getNextTrackItem=function(a){if(a&&this._lastTrackItem&&this._trackMode===g.REPEAT_TRACK)return c(this._currentTrackItem);
this._standByPlaylist.length||a&&this.getTrackMode()!==g.REPEAT_LIST||this.resetSequence();(a=this._standByPlaylist.shift())&&this._pickedPlaylist.push(a);this._lastHistoryItemIndex=null;return c(a||null)};a.prototype.addTrackItems=function(a){if(a=d.prototype.addTrackItems.call(this,a))this._standByPlaylist=this._standByPlaylist.concat(a),this.buildPlaylist(this._standByPlaylist)};a.prototype.removeTrackItem=function(a){d.prototype.removeTrackItem.call(this,a);var b=this._pickedPlaylist.indexOf(a);
a=this._standByPlaylist.indexOf(a);-1<b&&this._pickedPlaylist.splice(b,1);-1<a&&this._standByPlaylist.splice(a,1)};a.prototype.setTrackMode=function(a){this._trackMode=a};a.prototype.getType=function(){return"RANDOM_PLAYLIST_MANAGER"};a.prototype.destruct=function(){this.isDestructed()||(d.prototype.destruct.call(this),this._pickedPlaylist=[],this._standByPlaylist=[])};return a}();f.PlaylistManager=d;f.RandomPlaylistManager=b;f.getDefaultSongRequest=c;f.parse=function(a){return a&&0<a.length?a.map(function(a){return a?
new t({title:a.title,artist:a.artist,album:a.album,albumArt:a.albumArt||a.cover,duration:a.duration,url:a.url,type:a.type,lrcType:a.lrcType,lrc:a.lrc,allowRemove:a.allowRemove},a.description):null}).filter(function(a){return null!==a}):[]};f.prototype.getPlaylist=function(){return this._playlist};f.prototype.getPreviousTrackItem=function(){return this._PlaylistManager?this._PlaylistManager.getPreviousTrackItem():this._getPreviousTrackItem()};f.prototype._getPreviousTrackItem=function(){var a=this.getTrackItemCount();
if(a){var b=this.getTrackItemIndex(this._currentTrackItem);if(-1!==b&&this._currentTrackItem&&0!==b){if(a=this.getTrackItemByIndex(b-1))return c(a)}else return a=this.getTrackItemByIndex(a-1),c(a)}return c(null)};f.prototype.getNextTrackItem=function(a){return this._PlaylistManager?this._PlaylistManager.getNextTrackItem(a):this._getNextTrackItem(a)};f.prototype._getNextTrackItem=function(a){if(a&&this._currentTrackItem&&this._trackMode===g.REPEAT_TRACK)return c(this._currentTrackItem);var b=this.getTrackItemCount();
if(b){var d=this.getTrackItemIndex(this._currentTrackItem);if(!this._currentTrackItem||-1===d||(!a||this._trackMode===g.REPEAT_LIST)&&d+1>=b){if(a=this.getTrackItemByIndex(0))return c(a)}else if(a=this.getTrackItemByIndex(d+1))return c(a)}return c(null)};f.prototype.getTrackItemIndex=function(a){return a?this._playlist.indexOf(a):-1};f.prototype.provideCurrentTrackItem=function(a){this._currentTrackItem=a;this._PlaylistManager&&this._PlaylistManager.provideCurrentTrackItem(this._currentTrackItem)};
f.prototype.getTrackItemIndexByTrackID=function(a){return a?this._playlist.findIndex(function(b){return b.id==a}):-1};f.prototype.getTrackItem=function(a){return this._playlist.find(function(b){return b.id==a})};f.prototype.getTrackItemByIndex=function(a){var b=this.getPlaylist();return void 0!==a&&0<b.length&&b[a]?b[a]:null};f.prototype.getTrackItemCount=function(){return this._playlist.length};f.prototype.isRandom=function(){return this._random};f.prototype.setTrackMode=function(a){void 0!==g[a]&&
(this._trackMode=a,g.CUSTOM_LIST===a?(this._PlaylistManager&&this._CustomPlaylist&&this._PlaylistManager.constructor!==this._CustomPlaylist.constructor&&this._PlaylistManager.destruct(),this._PlaylistManager=this._CustomPlaylist,this._PlaylistManager.setRandom(this.isRandom())):(this._PlaylistManager&&this._CustomPlaylist&&this._PlaylistManager===this._CustomPlaylist&&(this._PlaylistManager=null,this.isRandom()&&this.setRandom(!0)),this._PlaylistManager&&this._PlaylistManager.setTrackMode(a)))};f.prototype.getTrackMode=
function(){return this._trackMode};f.prototype.setRandom=function(a){this._trackMode===g.CUSTOM_LIST?this._PlaylistManager&&this._PlaylistManager.setRandom(a):a?(this._PlaylistManager=new b(this._playlist,this.getTrackMode()),this._currentTrackItem&&this._PlaylistManager.provideCurrentTrackItem(this._currentTrackItem)):(this._PlaylistManager&&this._PlaylistManager.destruct(),this._PlaylistManager=null);this._random=a};f.prototype.addTrackItems=function(a){var b=this,c=this._player._UI,d=this.constructor.parse(a);
d.forEach(function(a){b._playlist.push(a)});this._PlaylistManager&&this._PlaylistManager.addTrackItems(a);c.addTrackItems(d);return d};f.prototype.removeTrackItem=function(a){var b=this._playlist.indexOf(a);a=this.getTrackItemByIndex(b);return-1<b?(this._playlist.splice(b,1),this._PlaylistManager&&this._PlaylistManager.removeTrackItem(a),!0):!1};f.prototype.resetSequence=function(){if(this._PlaylistManager)return this._PlaylistManager.resetSequence();this._currentTrackItem=null};f.prototype.isDestructed=
function(){return this._destructed};f.prototype.destruct=function(){this.isDestructed()||(this._destructed=!0)};return f}(),A=function(){function c(c){if(!c)throw Error("Player must be extsts.");this._currentTrackItem=null;this._subscribers=[];this._Player=c;this._Playback=this._Player._Playback;this._Playlist=this._Player._Playlist;this._UI=this._Player._UI;this._Lyric=this._Player._Lyric;this._destructed=!1;this._trackRequestJob=null;this._init()}c.prototype._init=function(){var c=this._Playlist.getPlaylist();
this._UI.addTrackItems(c);this._registerUIListeners();this.resetPlaylistSequence(this._Player._autoplay)};c.prototype._registerUIListeners=function(){this._subscribers.push(this._UI.onTrackItemClick.subscribe(this._onTrackItemClick.bind(this)));this._subscribers.push(this._UI.onModeButtonClick.subscribe(this._handleModeButtonClick.bind(this)));this._subscribers.push(this._UI.onPreviousButtonClick.subscribe(this._handlePreviousButtonClick.bind(this)));this._subscribers.push(this._UI.onNextButtonClick.subscribe(this._handleNextButtonClick.bind(this)));
this._subscribers.push(this._UI.onRandomButtonClick.subscribe(this._handleRandomButtonClick.bind(this)));this._subscribers.push(this._Playback.onAudioEnded.subscribe(this._handleAudioEnded.bind(this)))};c.prototype._onTrackItemClick=function(c){c&&this._currentTrackItem===c?this._Playback.isPlaying()?this._Playback.pause():this._Playback.play():(this._abortTrackRequestJob(),this._currentTrackItem=c,this.switchLyric(c),this._Playback.setTrack(c),this._Playback.play())};c.prototype._handlePreviousButtonClick=
function(){var c=this._Playback;this.skipBackwardTrack(c.isPlaying()||c.isSignalledPlay())};c.prototype._handleNextButtonClick=function(){var c=this._Playback;this.skipForwardTrack(c.isPlaying()||c.isSignalledPlay())};c.prototype.setCurrentTrackItem=function(c,d){c&&(this._currentTrackItem=c,this._UI.setCurrentTrackItem(c),this._Playback.setTrack(c),this.switchLyric(c),d&&this._Playback.play())};c.prototype._handleRandomButtonClick=function(c){this._Player._random=c;this._Playlist.setRandom(c)};c.prototype._handleModeButtonClick=
function(c){this._Player._mode=c;this._Playlist.setTrackMode(c)};c.prototype._handleAudioEnded=function(){this._abortTrackRequestJob();this._trackRequestJob=this._Playlist.getNextTrackItem(!0);var c=this;this._trackRequestJob.promise.then(function(d){d?c.setCurrentTrackItem(d,!0):c._Player._mode!==g.CUSTOM_LIST&&c.resetPlaylistSequence()})};c.prototype.resetPlaylistSequence=function(c){var d=this,b=this._Playlist;this._abortTrackRequestJob();b.resetSequence();this._trackRequestJob=this._Playlist.getNextTrackItem();
this._trackRequestJob.promise.then(function(a){d.setCurrentTrackItem(a,c)})};c.prototype._abortTrackRequestJob=function(){this._trackRequestJob&&!this._trackRequestJob.isResolved()&&this._trackRequestJob.abort();this._trackRequestJob=null};c.prototype.switchLyric=function(c){c&&this._Lyric&&this._Lyric.provideCurrentTrackItem(c)};c.prototype.removeSubscribers=function(){for(;0<this._subscribers.length;)this._subscribers.shift().remove()};c.prototype.skipBackwardTrack=function(c){this._abortTrackRequestJob();
this._trackRequestJob=this._Playlist.getPreviousTrackItem();var d=this;this._trackRequestJob.promise.then(function(b){d.setCurrentTrackItem(b,c)})};c.prototype.skipForwardTrack=function(c){this._abortTrackRequestJob();this._trackRequestJob=this._Playlist.getNextTrackItem();var d=this;this._trackRequestJob.promise.then(function(b){d.setCurrentTrackItem(b,c)})};c.prototype.pause=function(){this._Playback.pause()};c.prototype.isDestructed=function(){return this._destructed};c.prototype.destruct=function(){this.isDestructed()||
(this.removeSubscribers(),this._destructed=!0)};return c}(),C=function(){function c(c,b){return{text:c,wait:b||!1}}function f(c,b){var a=b.messages;this._player=c;this._destructed=!1;this._lastLyricIndex=this._lyric=this._LrcInitDeferred=this._currentTrackItem=null;this._listeners=[];this._loadingLyric=a.loadingLyric||"Loading...";this._notFoundLyric=a.notFoundLyric||"";this._singleLineUpdateTimerID=this._lyricUpdateTimerID=this._secondLyric=this._firstLyric=null;this._evenLine=this._singleLineMode=
!1;this._recentLyricOffset=null}f.prototype._onTimeupdateHandler=function(c){this._update(c)};f.prototype._onSeekedHandler=function(c){this._recentLyricOffset=this._lastLyricIndex=null;this._evenLine=!1;this._clearLyricUpdateTimer();this._update(c,!0)};f.prototype._onPausedHandler=function(){this._clearLyricUpdateTimer()};f.prototype._getSecondLyric=function(){return this.isLyricExist()?(null===this._secondLyric&&(this._secondLyric=this._getLyricByOffset(1)),this._secondLyric):null};f.prototype._getFirstLyric=
function(){return this.isLyricExist()?(null===this._firstLyric&&(this._firstLyric=this._getLyricByOffset(0)),this._firstLyric):null};f.prototype._getLyricByOffset=function(c){for(var b=[],a=-1,d=null,f=0;f<this._lyric.length;f++){var g=this._lyric[f];d!==g[0]&&(d=g[0],a++);if(a>c)break;a===c&&b.push(g)}return b};f.prototype._update=function(d,b){var a=this._player._Playback,e=a.getPosition();void 0===d&&(d=e);if(isNaN(d)||0>d)d=0;var f=this,g=this._getSecondLyric(),h=null;g&&g.length&&(h=g[0][0]);
var k=this._getFirstLyric();if(null===this._lastLyricIndex&&k&&0<k.length){var l=k[0][0];if(h&&d<h){this._isSingleLineLyric()?d<l?this._singleLineUpdate(null,k[0],g[0],null,d):this._singleLineUpdate(k[0],g[0],null,null,d):this.updateLyric(k.map(function(a){return c(a[1],l>d)}));this._recentLyricOffset=null;if(d<l)this.focusCurrentLineInExtendedLyric(),this._lastLyricIndex=-1;else{var m=[];k.forEach(function(a,b){m.push(b)});this.focusCurrentLineInExtendedLyric(m);this._lastLyricIndex=m.length-1}return}}if(this._lyric&&
0<this._lyric.length){null===this._lastLyricIndex&&(this._lastLyricIndex=-1);g=[];h=[];k=null;for(var p=this._lastLyricIndex+1;p<this._lyric.length;p++){var q=this._lyric[p],u=q[0];if(d>u)k!==u&&(g=[],h=[],k=u),g.push(c(q[1])),h.push(p),this._lastLyricIndex=p;else break}if(g.length){this._recentLyricOffset=h;this.focusCurrentLineInExtendedLyric(h);var r=this._lastLyricIndex+1<this._lyric.length?this._lyric[this._lastLyricIndex+1]:null;a.isActuallyPlaying()&&r&&d<r[0]&&(this._clearLyricUpdateTimer(),
this._lyricUpdateTimerID=window.setTimeout(function(){f._update(r[0]+10)},r[0]-e));this._isSingleLineLyric()?(a=0<=this._lastLyricIndex-1?this._lyric[this._lastLyricIndex-1]:null,this._singleLineUpdate(this._lyric[this._lastLyricIndex],r,null,b?null:a,d)):this.updateLyric(g)}}};f.prototype._isSingleLineLyric=function(){return this._singleLineMode};f.prototype._singleLineUpdate=function(d,b,a,e,f){this._clearSingleLineTimer();var g=this,h=[];if(!d&&b)h.push(c(b[1],!0)),a&&h.push(c(a[1],!0)),this._evenLine=
!this._evenLine;else if(d&&(b||e))if(e){var k=this._evenLine;k?(h.push(c(e[1],!0)),h.push(c(d[1],!1))):(h.push(c(d[1],!1)),h.push(c(e[1],!0)));b&&(this._singleLineUpdateTimerID=window.setTimeout(function(){var a=[];k?(a.push(c(b[1],!0)),a.push(c(d[1],!1))):(a.push(c(d[1],!1)),a.push(c(b[1],!0)));g.updateLyric(a)},(b[0]-f)/3))}else b&&(k?(h.push(c(b[1],!0)),h.push(c(d[1],!1))):(h.push(c(d[1],!1)),h.push(c(b[1],!0))));else h.push(c(d[1],!1));this._evenLine=!this._evenLine;this.updateLyric(h)};f.prototype._clearSingleLineTimer=
function(){null!==this._singleLineUpdateTimerID&&(window.clearTimeout(this._singleLineUpdateTimerID),this._singleLineUpdateTimerID=null)};f.prototype._clearLyricUpdateTimer=function(){null!==this._lyricUpdateTimerID&&(window.clearTimeout(this._lyricUpdateTimerID),this._lyricUpdateTimerID=null)};f.prototype._connectEventHandler=function(){var c=this._player._Playback;this._disconnectEventHandler();var b=c.onTimeUpdate.subscribe(this._onTimeupdateHandler.bind(this)),a=c.onSeeked.subscribe(this._onSeekedHandler.bind(this));
c=c.onPaused.subscribe(this._onPausedHandler.bind(this));this._listeners.push(b);this._listeners.push(a);this._listeners.push(c)};f.prototype._disconnectEventHandler=function(){for(;this._listeners.length;)this._listeners.shift().remove()};f.prototype.updateLyric=function(c){this._player._UI.updateLyric(c&&0<c.length?c:"")};f.prototype.showNoticeForExtendedLyric=function(c){this._player._UI.updateExtendedLyric(c,!0)};f.prototype.focusCurrentLineInExtendedLyric=function(c){this._player._UI.focusExtendedLyricLine(c)};
f.prototype.provideLyricToExtendedLyric=function(c){this._player._UI.updateExtendedLyric(c)};f.prototype.showLoadingBanner=function(){this.updateLyric([c(this._loadingLyric,!0)]);this.showNoticeForExtendedLyric([this._loadingLyric])};f.prototype.showNotFoundBanner=function(){this.updateLyric([c(this._notFoundLyric,!0)]);this.showNoticeForExtendedLyric([this._notFoundLyric])};f.prototype.abortLrcInitDeferred=function(c){this._LrcInitDeferred&&!this._LrcInitDeferred.isResolved()&&(this._LrcInitDeferred.reject({type:c||
"abort"}),this._LrcInitDeferred=null)};f.prototype.isLyricExist=function(){return this._lyric&&0<this._lyric.length};f.prototype.getRecentLyricOffset=function(){return this._recentLyricOffset};f.prototype.provideCurrentTrackItem=function(c){var b=this;this.abortLrcInitDeferred();this._clearSingleLineTimer();this._disconnectEventHandler();this._clearLyricUpdateTimer();this._secondLyric=this._firstLyric=this._recentLyricOffset=this._lastLyricIndex=this._lyric=null;this._evenLine=this._singleLineMode=
!1;var a=c._Lrc?c._Lrc:null;!a&&c&&c.lrc&&(a=new B(c),c._Lrc=a);if(a)return this._LrcInitDeferred=p(),c=this._LrcInitDeferred.promise,a.isLoaded()||this.showLoadingBanner(),a.getLyric().then(function(a){b._LrcInitDeferred.resolve(a)})["catch"](function(a){b._LrcInitDeferred.reject(a);a instanceof Error&&console.error(a)}),c.then(function(c){c&&0<c.length?(b._connectEventHandler(),b._lyric=c,b.provideLyricToExtendedLyric(b._lyric),b._singleLineMode=a.isSingleLineLyric(),b._update()):b.showNotFoundBanner()})["catch"](function(a){a instanceof
Error&&console.error(a)}),c;this.showNotFoundBanner();return null};f.prototype.isDestructed=function(){return this._destructed};f.prototype.destruct=function(){this.isDestructed()||(this._clearSingleLineTimer(),this._clearLyricUpdateTimer(),this._disconnectEventHandler(),this.abortLrcInitDeferred("destructed"),this._recentLyricOffset=null,this._destructed=!0)};return f}(),B=function(){function c(c){this._TrackItem=c;this._lrcType=c.lrcType;this._parsedLyric=null;this._destructed=this._loaded=!1;this._singleLineLyric=
this._requestingLrcJob=null}c.parse=function(c){if(!c)return null;for(var d=c.split("\n"),b=[],a=d.length,e=0;e<a;e++){var f=d[e].match(/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g);c=d[e].replace(/.*\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g,"").replace(/<(\d{2}):(\d{2})(\.(\d{2,3}))?>/g,"").replace(/^\s+|\s+$/g,"");if(f)for(var g=f.length,h=0;h<g;h++){var k=/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/.exec(f[h]),l=60*k[1],m=parseInt(k[2]);k=k[4]?parseInt(k[4])/(2===(k[4]+"").length?100:1E3):0;b.push([1E3*(l+m+k),c])}}var p=
!0,q=3;b=b.filter(function(a){if(a[1]){0!==a[0]&&(p=!1);if(0===a[0])if(p)if(0<q)q--;else return!1;else return!1;return a[1]}});b.reduce(function(a,b){var c=a.shift();c&&c.time!==b[0]&&(a.push(c),c=null);c||(c={time:b[0],lyric:[]});c.lyric.push(c);a.push(c);return a},[]).sort(function(a,b){return a.time-b.time}).reduce(function(a,b){return b&&b.lyric.length?a.concat(b.lyric):a},[]);return b};c.getLyricFromServer=function(c){var d=p(),b=new XMLHttpRequest;b.open("GET",c,!0);b.send();b.addEventListener("readystatechange",
function(){b.readyState===XMLHttpRequest.DONE&&(200===b.status?d.resolve(b.response):d.reject(null))});return{promise:d.promise,abort:function(){b&&4!==b.readyState&&(b.abort(),d.reject(null))},isResolved:function(){return!1}}};c.prototype.getLyric=function(){var c=this;if(this.isLoaded())return Promise.resolve(this.isReady()?this._parsedLyric:null);if(this._TrackItem&&this._TrackItem.lrc){if(!this._requestingLrcJob||this._requestingLrcJob.isResolved())this._requestingLrcJob=this.constructor.getLyricFromServer(this._TrackItem.lrc);
var d=this._requestingLrcJob.promise,b=p();d.then(function(a){a=c._onLyricRetrieved(a);b.resolve(a)})["catch"](function(){b.reject(null)});return b.promise}this._loaded=!0;return Promise.resolve(null)};c.prototype._onLyricRetrieved=function(c){this._loaded=!0;return c&&(c=this.constructor.parse(c))&&0<c.length?this._parsedLyric=c:null};c.prototype.abortRequestingLrcJob=function(){this._requestingLrcJob&&!this._requestingLrcJob.isResolved()&&this._requestingLrcJob.abort();this._requestingLrcJob=null};
c.prototype.isLoaded=function(){return this._loaded};c.prototype.isReady=function(){return this._parsedLyric&&0<this._parsedLyric.length};c.prototype.isDestructed=function(){this._destructed=!1};c.prototype.isSingleLineLyric=function(){if(null===this._singleLineLyric&&this.isReady()){for(var c=null,d=!1,b=0;b<this._parsedLyric.length;b++){var a=this._parsedLyric[b];if(c!==a[0])c=a[0];else{d=!0;break}}this._singleLineLyric=!d}return this._singleLineLyric};return c}();h.TrackItem=t;h.TrackMode=g;h.Playlist=
x;h.Tools={extend:w,makeDeferred:p};h.prototype.getID=function(){return this._id};h.prototype.isInitialized=function(){return this._initialized};h.prototype.init=function(){if(!this.isInitialized())try{var c={container:this._container,mode:this._mode,volume:this._volume,customAudioType:this._customAudioType,showAlbumName:this._showAlbumName,enableLyric:this._enableLyric,activeFade:this._activeFade,fadeDuration:this._fadeDuration,playlist:this._initPlaylist,labels:this._labels,random:this._random,
messages:this._messages,handlers:this._handlers};this._initialized=!0;this._Playlist=new x(this,c);this._UI=new y(this._container,this,c);this._Playback=new z(this,c);this._Lyric=this._enableLyric?new C(this,c):null;this._Controller=new A(this);this._initializingDeferred.resolve(this)}catch(f){this._initializingDeferred.reject(f)}};h.prototype.getInitializingPromise=function(){return this._initializingPromise};h.prototype._registerMediaSessionHandlers=function(){if(this._enableMediaSession&&k){var c=
this;k.setActionHandler("play",function(){c.play()});k.setActionHandler("pause",function(){c.pause()});this._mediaSessionBackwardTime?k.setActionHandler("seekbackward",function(){c.seek(Math.max(0,c.getPosition()-c._mediaSessionBackwardTime))}):k.setActionHandler("seekbackward",null);this._mediaSessionForwardTime?k.setActionHandler("seekforward",function(){c.seek(Math.min(c.getDuration()||0,c.getPosition()+c._mediaSessionForwardTime))}):k.setActionHandler("seekforward",null);k.setActionHandler("previoustrack",
function(){1E4<c.getPosition()?c.seek(0):c.skipBackward()});k.setActionHandler("nexttrack",function(){c.skipForward()})}};h.prototype._updateMediaSessionMetadata=function(c){this._enableMediaSession&&k&&c&&(k.metadata=new window.MediaMetadata({title:c.title?c.title:void 0,artist:c.artist?c.artist:void 0,album:c.album?c.album:void 0,artwork:c.albumArt?[{src:c.albumArt}]:void 0}))};h.prototype._ensureNotDestructed=function(){if(this.isDestructed())throw Error("Player was destructed.");};h.prototype.play=
function(){this._ensureNotDestructed();var c=this._Controller,f=this._Playback;f.getCurrentTrackItem()||c.resetPlaylistSequence();return f.getCurrentTrackItem()?f.play():Promise.reject({type:"not_found_track",error:null})};h.prototype.pause=function(){this._ensureNotDestructed();var c=this._Playback,f=this._UI;if(c.isPlaying())return f.setUIPlaying(),c.pause()};h.prototype.seek=function(c){this._ensureNotDestructed();var f=this._Playback;return f.getCurrentTrackItem()?f.seek(c):Promise.reject({type:"not_found_track",
error:null})};h.prototype.skipBackward=function(){this._ensureNotDestructed();var c=this._Playback;this._Controller.skipBackwardTrack(c.isPlaying()||c.isSignalledPlay())};h.prototype.skipForward=function(){this._ensureNotDestructed();var c=this._Playback;this._Controller.skipForwardTrack(c.isPlaying()||c.isSignalledPlay())};h.prototype.getPosition=function(){return this.isDestructed()?0:this._Playback.getPosition()};h.prototype.getDuration=function(){var c=this._Playback;return this.isDestructed()||
!c.isReady()?0:c.getDuration()};h.prototype.getMode=function(){return this._mode};h.prototype.isDestructed=function(){return this._destructed};h.prototype.isRandom=function(){return this._random};h.prototype.destruct=function(){this.isDestructed()||(this._initTimerID&&(this._initTimerID=null),this._Controller.destruct(),this._Playback.destruct(),this._UI.destruct(),this._Playlist.destruct(),this._Lyric&&this._Lyric.destruct(),this.onDestructed.dispatch(),this._destructed=!0)};return h}();window.BluePlayer=
v})(window.jQuery);