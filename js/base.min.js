(function(h){function E(a){var b=[],c=null,f=c||44100,k=3,d=null,l=new MP3Parser,g=null;l.onFrame=function(a){try{null===g&&(f=c=l.samplerate,k=3,d={codecId:2,channels:2,samplerate:f,samplesize:16,timescale:c},g=new MP4Mux({audioTrackId:0,videoTrackId:-1,tracks:[d]}),g.ondata=function(a){b.push(a)}),l.onFrame=function(b){var a=new Uint8Array(b.length+1);var c=32|k<<2;a[0]=c|3;a.set(b,1);g.pushPacket(8,a,0)},l.onFrame(a)}catch(G){console.log(G)}};l.push(a);l.close();g.flush();if(0===b.length)throw Error("There was no output.");
return b}function z(a){a&&"http"!==a.substring(0,4)&&window.request_uri&&(a=(window.request_uri+a).replace(/(\/.\/)/gi,"/"));return a}function H(a){return a&&void 0!==window.default_url?new Promise(function(b,c){var f=new XMLHttpRequest,k=window.request_uri+"index.php?mid="+window.current_mid+"&act=getSimpleMP3Descriptions&document_srl="+a;A.isSupported()||(k+="&hls=false");f.open("GET",k,!0);f.send();f.addEventListener("load",function(){var a=f.response;if(200!=f.status)c(f.status);else try{var k=
JSON.parse(a);b(k)}catch(g){c(g)}},!1)}):Promise.reject(void 0)}function t(a){return a?a.replace(/(&amp;)/gi,"&"):a}function I(a){return"string"===typeof a?a.replace(/\.[^/.]+$/,""):a}function B(a){function b(b){try{var a=b?atob(b):b}catch(F){return console.error(F),null}return a?window.decodeURIComponent(Array.prototype.map.call(a,function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}).join("")):null}var c=function(b){if(b)try{b.ownerID&&(b.ownerID=window.atob(b.ownerID)),b.data&&(b.data=
window.atob(b.data)),b.description&&(b.description=window.atob(b.description))}catch(g){}},f=!1;h.config&&(f=h.config.remove_extension_in_title);if(a){var k="title artist album albumartist contentgroup genre publisher conductor composer copyright comment www unsyncedlyrics".split(" "),d=["priv","comm","uniquefileid","albumArt"];a.forEach(function(a){if(a=a.description){a.tags||(a.tags={title:null,artist:null,album:null,albumArt:null});var g=a.tags;a.download_url&&(a.download_url=window.default_url+
"index.php"+t(a.download_url));g.priv&&0<g.priv.length&&g.priv.forEach(c);g.uniquefileid&&c(g.uniquefileid);g.comm&&g.comm.forEach(c);f&&(a.filename=I(a.filename));if(a=a.stream){var h=a.audio,l=a.video;h&&h.length&&h.forEach(function(b){b&&Object.keys(b).forEach(function(a){var e=typeof b[a];"boolean"!==e&&"number"!==e&&null!==b[a]&&(b[a]=window.atob(b[a]))})});l&&Object.keys(l).forEach(function(b){var a=typeof l[b];"boolean"!==a&&"number"!==a&&null!==l[b]&&(l[b]=window.atob(l[b]))})}Object.keys(g).forEach(function(a){if(-1===
d.indexOf(a)){var c=typeof g[a];"boolean"!==c&&"number"!==c&&null!==g[a]&&(g[a]=-1<k.indexOf(a)?b(g[a]):window.atob(g[a]))}});g.title&&(g.title=t(g.title));g.artist&&(g.artist=t(g.artist));g.album&&(g.album=t(g.album))}})}}var n=function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,a){b.__proto__=a}||function(b,a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])};return function(b,c){function f(){this.constructor=b}a(b,c);null===c?b.prototype=Object.create(c):(f.prototype=
c.prototype,b.prototype=new f)}}(),m=function(){function a(){this._listeners=[]}var b=0;a.prototype.getListeners=function(){return this._listeners=this._listeners.filter(function(b){return!b.dead}).sort(function(b,a){return b.priority-a.priority})};a.prototype.subscribe=function(a,f){void 0===f&&(f=20);var c={id:b++,handler:a,priority:f,dead:!1};this._listeners.push(c);return{remove:function(){c.dead=!0}}};a.prototype.dispatch=function(b){var a=this;this.getListeners().forEach(function(c){a._handleCallback(c.handler,
b)})};a.prototype._handleCallback=function(b,a){try{b(a)}catch(k){window.setTimeout(function(){throw k;},0)}};return a}(),x=function(){var a,b,c=!1;return{promise:new Promise(function(c,k){a=c;b=k}),resolve:function(b){c||(a(b),c=!0)},reject:function(a){c||(b(a),c=!0)},isEnded:function(){return c}}},J=function(){function a(b){void 0===b&&(b=15E7);this._destructed=!1;this._maxCacheSize=b;this._cacheSize=0;this._store=[]}a.prototype.getCache=function(b,a,f){var c=this._store.find(function(c){return c.file_srl===
b&&c.start===a&&c.end===f});return c?c.data:null};a.prototype.setCache=function(a,c,f,k){this.getCache(c,f,k)||(this._store.push({file_srl:c,start:f,end:k,data:a}),this._cacheSize+=a.byteLength);this.getCacheUsage()>this._maxCacheSize&&this.clear(c)};a.prototype.getCacheUsage=function(){return this._cacheSize};a.prototype.updateCacheUsage=function(){return this._cacheSize=this._store.reduce(function(a,c){return a+(c&&c.data?c.data.byteLength:0)},0)};a.prototype.setMaximumCacheSize=function(a){void 0===
a&&(a=15E7);this._maxCacheSize=a;this.getCacheUsage()>this._maxCacheSize&&this.clear()};a.prototype.clear=function(a){var b=!a;if(a){var f=0;this._store=this._store.filter(function(b){return b.file_srl===a?(b&&b.data&&(f+=b.data.byteLength),!0):!1});f>this._maxCacheSize&&(b=!0)}b&&(this._cacheSize=0,this._store=[]);this.updateCacheUsage()};a.prototype.isDestructed=function(){return this._destructed};a.prototype.destruct=function(){this.isDestructed()||(this._destructed=!0,this._store=[],this._cacheSize=
0)};return a}(),y=function(a){return new Promise(function(b){a.then(function(a){b(a)})["catch"](function(a){b(a)})})},K=function(){function a(){this._jobQueue=[];this._worker=null;this._destructed=!1;this._currentJob=null}var b=Error("Decrypting Aborted"),c=Error("could not read encrypted data"),f=function(){function a(a,b,c){this.cipher=a;this.iv=b;this.key=c;this._finish=!1;this._worker=null;this._aborted=this._workerRunning=!1;this._deferred=x();this._promise=this._deferred.promise;this.onAbort=
new m;this.onFinish=new m;this.onDecryptStart=new m;this.onDecryptEnded=new m;this._onMessageHandler=this._onMessage.bind(this);this._onErrorHandler=this._onError.bind(this);this._workerTerminated=!1}a.prototype._onMessage=function(a){this._finish||((a=a.data)&&a.buffer instanceof ArrayBuffer&&void 0!==a.byteLength?this._onFinish(a):this._onError(c))};a.prototype._onError=function(a){this._finish||(this.isAborted()||this.abort(!0),this._deferred.reject(b),this._onEnded(a))};a.prototype._onFinish=
function(a){this.onFinish.dispatch(a);this._deferred.resolve(a);this._onEnded()};a.prototype._onEnded=function(a){this._finish||(this._finish=!0,this._workerRunning=!1,this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler,!1),this._worker.removeEventListener("error",this._onErrorHandler,!1),this._worker=null),this.key=this.iv=this.cipher=null,this._finish=!0,this.onDecryptEnded.dispatch(a))};a.prototype._run=function(){try{this._workerRunning=!0,this._worker.postMessage({iv:this.iv,
key:this.key,cipher:this.cipher}),this.onDecryptStart.dispatch(this)}catch(d){this._deferred.reject(d)}};a.prototype._provideWorker=function(a){this.isFinish()||(this._worker=a,this._worker.addEventListener("message",this._onMessageHandler,!1),this._worker.addEventListener("error",this._onErrorHandler,!1),this._run())};a.prototype.getPromise=function(){return this._promise};a.prototype.isFinish=function(){return this._finish||this._aborted};a.prototype.isWorkerRunning=function(){return this._workerRunning};
a.prototype.isWorkerTerminated=function(){return this._workerTerminated};a.prototype.isAborted=function(){return this._aborted};a.prototype.abort=function(a){this.isFinish()||(this._aborted=!0,this.isWorkerRunning()&&(this._workerTerminated=!0,this._worker.terminate()),a||this._onError(b),this.onAbort.dispatch(void 0))};return a}();a.prototype._buildWorker=function(){return this._worker?null:this._worker=new Worker(window.default_url+"addons/simple_mp3_player/js/decrypt.js")};a.prototype.getWorker=
function(){return this._worker?this._worker:this._buildWorker()};a.prototype._onJobEnded=function(a){this._currentJob===a&&(a.isWorkerTerminated()&&(this._worker=null),this._currentJob=null);this._performNextJob()};a.prototype._performNextJob=function(){0<this._jobQueue.length&&(!this._currentJob||this._currentJob.isFinish())&&(this._currentJob=this._jobQueue.shift(),this._currentJob._provideWorker(this.getWorker()))};a.prototype._decryptJobObserver=function(a){var b=this;this._jobQueue.push(a);a.onDecryptEnded.subscribe(function(){b._onJobEnded(a)});
this._performNextJob()};a.prototype._buildDecryptJob=function(a,b,c){a=new f(a,b,c);this._decryptJobObserver(a);return a};a.prototype.decrypt=function(a,b,c){return this._buildDecryptJob(a,b,c)};a.prototype.destruct=function(){this._destructed||(this._currentJob&&(this._currentJob.abort(),this._currentJob=null),this._jobQueue.forEach(function(a){a.abort()}),this._jobQueue=[],this._destructed=!0)};return a}(),A=function(){function a(){var a=r?'audio/mp4; codecs="mp3"':"audio/mpeg";m&&(a="audio/mp4");
return a}function b(a){if(!a)return[];a=a.buffered;for(var b=a.length,e=[],c=0;c<b;c++)e.push({start:a.start(c),end:a.end(c)});return e}function c(a){var b=0,c=null;return a.map(function(a){a.key&&(c=a.key);var e={duration:a.time,startOffset:a.startOffset,endOffset:a.endOffset,url:a.url?a.url:null,key:c,TimeRange:{start:b,end:b+a.time}};b+=a.time;return e})}function f(a,b,c){a=z(a);var e=q.RequestToFetch,p=q.RequestToXHR;a=e.isSupported()?new e(a,b,c):new p(a,b,c);return{promise:y(a.getPromise.call(a)),
abort:a.abort.bind(a),isSettled:a.isSettled.bind(a)}}function h(a){var b=!1;return{promise:Promise.resolve({aborted:b,code:200,data:a,retryCount:0,cache:!0}),isSettled:function(){return!0},abort:function(){return b=!0}}}function d(b,p,u,L,d){this._id=l++;this._audio=b;this._file_srl=L;this._playlist=u;this._duration=u.duration;this._BufferRetriever=u.encrypted?new t.EncryptedBufferRetriever:new t.BufferRetriever;this._offsets=c(this._playlist.offsets);this._mp3URL=p;this._MediaSource=new window.MediaSource;
this._sourceBuffer=null;this._url=window.URL.createObjectURL(this._MediaSource);this._desturct=this._initialized=!1;this._mimeCodec=a();this._appendInitBuffer=!1;this._onAudioSeekingHandler=this._onAudioSeeking.bind(this);this._onAudioTimeUpdateHandler=this._onAudioTimeUpdate.bind(this);this._onMediaSourceInitHandler=this._onMediaSourceInit.bind(this);this._onMediaSourceEndedHandler=this._onMediaSourceEnded.bind(this);this._onMediaSourceCloseHandler=this._onMediaSourceClose.bind(this);this._onMediaSourceErrorHandler=
this._onMediaSourceError.bind(this);this._onSourceBufferUpdateEndHandler=this._onSourceBufferUpdateEnd.bind(this);this._onSourceBufferErrorHandler=this._onSourceBufferError.bind(this);this._CacheManager=this._currentPerformJob=null;this._bufferSize=d&&"number"===typeof d?d:12;this._MediaSource.addEventListener("sourceopen",this._onMediaSourceInitHandler,!1);this._MediaSource.addEventListener("sourceclose",this._onMediaSourceCloseHandler,!1);this._MediaSource.addEventListener("error",this._onMediaSourceErrorHandler,
!1);this._jobQueue=[];this._seeking=!1;this._request=null;this._eosSignalled=!1;this._lastSegmentIndex=-1;this._playingObserverTimerID=null;this._init()}var l=0,g="undefined"!==typeof window.navigator?window.navigator.userAgent:"",m=!/chrome|opera/i.test(g)&&/safari/i.test(g);0<=g.indexOf("Trident/")||g.indexOf("MSIE ");var r=0<=g.toLowerCase().indexOf("firefox");/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(g);var q=function(){function a(a,b,c,e){return{code:a||-1,data:b||
null,retryCount:c||0,aborted:e}}var b=0,c=function(){function c(a,c,e){var v=this;this._id=b++;this._url=a;this._rangeStart=c;this._rangeEnd=e;this._rejectHandler=this._resolveHandler=null;this._aborted=this._settled=!1;this._response=null;this._promise=new window.Promise(function(a,b){v._resolveHandler=a;v._rejectHandler=b});this._stalledTimerID=this._retryTimerID=null;this._retryCount=0;this._initTimerID=window.setTimeout(function(){v._initTimerID=null;v._run()},0)}c.prototype._run=function(){return null};
c.prototype._performRequest=function(){return null};c.prototype._retry=function(){this._retryCount++;this._retryTimerID=window.setTimeout(this._run.bind(this),1200)};c.prototype._resolve=function(a){this._settled||(this._resolveHandler(a),this._settled=!0)};c.prototype._reject=function(a){this._settled||(this._rejectHandler(a),this._settled=!0)};c.prototype._clearRetryTimerID=function(){null!==this._retryTimerID&&window.clearTimeout(this._retryTimerID);this._retryTimerID=null};c.prototype._clearStalledTimerID=
function(){this._stalledTimerID&&window.clearTimeout(this._stalledTimerID);this._stalledTimerID=null};c.prototype._setStalledTimerID=function(){this._clearStalledTimerID();this._stalledTimerID=window.setTimeout(this._onTimeout.bind(this),18E3)};c.prototype._onTimeout=function(){this._clearStalledTimerID();this._abort();this._run()};c.prototype.abort=function(){this._settled||(null!==this._initTimerID&&(window.clearTimeout(this._initTimerID),this._initTimerID=null),this._aborted=!0,this._clearRetryTimerID(),
this._clearStalledTimerID(),this._reject(a(void 0,void 0,void 0,!0)))};c.prototype.isSettled=function(){return this._settled||this._aborted};c.prototype.isAborted=function(){return this._aborted};c.prototype.getPromise=function(){return this._promise};return c}(),d=function(){function b(a,b,e){var v=c.apply(this,arguments)||this;v._AbortController=null;v._requestJob=null}n(b,c);b.isSupported=function(){return"AbortController"in window&&"fetch"in window&&"Headers"in window};b.prototype._run=function(){if(!this.isSettled()){var b=
this,c=this._performRequest();c.promise.then(function(e){if(!b.isAborted()&&!c.aborted){if(e.ok)e.arrayBuffer().then(function(c){b._clearStalledTimerID();b._resolve(a(e.status,c,b._retryCount,b.isAborted()))})["catch"](function(a){});else b._clearStalledTimerID(),e.status&&400<=e.status&&500>=e.status?b._reject(a(e.status,null,b._retryCount,b.isAborted())):b._retry();b._response=e}})["catch"](function(a){c.aborted||(b._clearStalledTimerID(),b._aborted||null===b._retryTimerID&&b._retry())});b._requestJob=
c;b._setStalledTimerID()}};b.prototype._abort=function(){this._AbortController&&(this._requestJob.aborted=!0,this._AbortController.abort())};b.prototype.abort=function(){this._settled||(this._abort(),c.prototype.abort.call(this))};b.prototype._performRequest=function(){this._clearRetryTimerID();this._AbortController=new window.AbortController;var a=void 0;void 0!==this._rangeStart&&void 0!==this._rangeEnd&&(a=new window.Headers,a.append("Range","bytes="+this._rangeStart+"-"+this._rangeEnd));return{promise:window.fetch(this._url,
{method:"GET",signal:this._AbortController.signal,credentials:"omit",headers:a}),aborted:!1}};return b}(),f=function(){function b(a,b,e){var p=c.apply(this,arguments)||this;p._requestJob=null;p._runHandler=null}n(b,c);b.prototype._onTimeout=function(){c.prototype._onTimeout.call(this)};b.prototype._run=function(){if(!this.isSettled()){var b=this,c=b._performRequest();y(c.promise).then(function(e){c.aborted||(b._clearStalledTimerID(),400<=e.status&&500>e.status?b._reject(a(e.status,e.data,b._retryCount,
b.isAborted())):e&&200<=e.status&&300>e.status?b._resolve(a(e.status,e.data,b._retryCount,b.isAborted())):b._retry())});b._requestJob=c;b._setStalledTimerID()}};b.prototype._performRequest=function(){this._clearRetryTimerID();var a=new XMLHttpRequest;a.open("GET",this._url,!0);void 0!==this._rangeStart&&void 0!==this._rangeEnd&&a.setRequestHeader("Range","bytes="+this._rangeStart+"-"+this._rangeEnd);a.responseType="arraybuffer";var b=x(),c={xhr:a,deferred:b,promise:b.promise,aborted:!1};a.send();
a.addEventListener("readystatechange",function(c){400<=a.status&&500>a.status?b.reject({status:a.status,data:null}):a.readyState===XMLHttpRequest.DONE&&(200===a.status||206===a.status?b.resolve({status:a.status,data:a.response}):b.reject({status:0,data:null}))});return c};b.prototype._abort=function(){this._requestJob&&!this._requestJob.aborted&&(this._requestJob.xhr.abort(),this._requestJob.aborted=!0)};b.prototype.abort=function(){this._settled||(this._abort(),c.prototype.abort.call(this))};return b}();
return{RequestToFetch:d,RequestToXHR:f}}(),t=function(){function a(a,b,c,e){void 0===c&&(c=!1);void 0===e&&(e=0);return{aborted:c,code:a||-1,data:b||null,retryCount:e}}var b=function(){function a(){this._encrypted=this._destructed=!1;this._key=null;this._initialized=!1;this._keyRetriever=null;this._bufferRetriever=[];this._init()}a.prototype._init=function(){this._initialized=!0};a.prototype.isEncrypted=function(){return null};a.prototype.isInitialized=function(){return this._initialized};a.prototype.isKeyRetrieving=
function(){return!!this._keyRetriever&&!this._keyRetriever.isSettled()};a.prototype.getBuffer=function(a){return null};a.prototype.abortKeyRetriever=function(){this.isKeyRetrieving()&&this._keyRetriever.abort();this._keyRetriever=null};a.prototype.abort=function(){this.abortKeyRetriever();this._bufferRetriever.forEach(function(a){a.abort()})};a.prototype.destruct=function(){this._destructed||(this.abort(),this._bufferRetriever=[],this._destructed=!0)};return a}(),c=function(){function a(){b.call(this)}
n(a,b);a.prototype._init=function(){b.prototype._init.call(this)};a.prototype._observeBufferRetriever=function(a){var b=this;this._bufferRetriever.push(a);y(a.promise).then(function(){var c=b._bufferRetriever.indexOf(a);-1<c&&b._bufferRetriever.splice(c,1)})};a.prototype.getBuffer=function(a,b,c){a=f(a,b,c);this._observeBufferRetriever(a);return a};a.prototype.isEncrypted=function(){return!1};return a}();return{EncryptedBufferRetriever:function(){function b(){(c.call(this)||this)._handshake=null}
var e=["handshake","timestamp","document_srl","file_srl","ip"],p=new K,d=function(){function a(a,b){this._deferred=x();this._settled=this._aborted=!1;this.promise=this._deferred.promise;this._keyRetriever=a;this._bufferBuilder=b;this._retrievedData=this._decrypter=this._bufferRetriever=null;this._run()}a.prototype._run=function(){var a=this,b=null;this._keyRetriever.promise.then(function(c){if(!a.isSettled())return b=new Uint8Array(c.data),a._bufferRetriever=a._bufferBuilder(),a._bufferRetriever.promise}).then(function(c){if(!a.isSettled()){a._retrievedData=
c;var e=new Uint8Array(c.data);c=e.slice(48,e.byteLength);e=e.slice(0,16);this._decrypter=p.decrypt(c,e,b);return this._decrypter.getPromise()}}).then(function(b){a.isSettled()||(a._retrievedData.data=b,a._deferred.resolve(a._retrievedData))})["catch"](function(b){a._deferred.reject(b);a._settled=!0})};a.prototype.abort=function(){this.isSettled()||(this._bufferRetriever&&(this._bufferRetriever.isSettled()||this._bufferRetriever.abort(),this._bufferRetriever=null),this._decrypter&&(this._decrypter.abort(),
this._decrypter=null),this._aborted=!0)};a.prototype.isSettled=function(){return this._aborted||this._settled};return a}(),u=function(a){var b=new URL((window.default_url+a).replace(/(\/.\/)/,"/")),c={};e&&e.forEach(function(a){var e=b.searchParams.get(a);e&&(c[a]=e)});return c},g=function(a){return{promise:a,abort:function(){},isSettled:function(){return!0}}};n(b,c);b.prototype.onKeyRetrieved=function(a){a&&a.data&&(this._handshake=a.handshake,this._key=new Uint8Array(a.data))};b.prototype._buildKeyRetriever=
function(a){return f(a)};b.prototype._updateKeyRetriever=function(a){var b=this,c=this._buildKeyRetriever(a),e=u(a);return c?(this._keyRetriever=c,this._handshake=e._handshake,c.promise.then(function(a){b.onKeyRetrieved({data:a.data,handshake:e.handshake})})["catch"](function(a){}),c):null};b.prototype.isValidKey=function(a){return u(a).handshake===this._handshake&&!!this._key};b.prototype.getKeyRetriever=function(b){var c=u(b);if(this.isValidKey(b))return g(Promise.resolve(a(200,this._key)));if(this.isKeyRetrieving()){if(c.handshake===
this._handshake)return this._keyRetriever;this.abortKeyRetriever()}this.resetKey();return(b=this._updateKeyRetriever(b))?b:g(Promise.reject(void 0))};b.prototype.resetKey=function(){this._key=this._handshake=null};b.prototype._buildBufferRetriever=function(a){return c.prototype.getBuffer.call(this,a)};b.prototype.getBuffer=function(a,b){return new d(this.getKeyRetriever(b),this._buildBufferRetriever.bind(this,a))};b.prototype.isEncrypted=function(){return!0};return b}(),BufferRetriever:c}}();d.isSupported=
function(){if("MediaSource"in window){if(m){var b=window.navigator.appVersion.match(/version\/([0-9]+)\.([0-9]+)/i),c=-1;b&&3<=b.length&&(b=parseInt(b[1],10),isNaN(b)||(c=b));if(10>c)return!1}return window.MediaSource.isTypeSupported(a())}return!1};d.prototype._init=function(){this.isDestructed()||(this._ensureNotDestructed(),this._audio.addEventListener("seeking",this._onAudioSeekingHandler,!1),this._audio.addEventListener("timeupdate",this._onAudioTimeUpdateHandler,!1),this._audio.src=this.getURL(),
this._audio.load(),180<this._bufferSize&&(this._bufferSize=180),1>this._bufferSize&&(this._bufferSize=12))};d.prototype._ensureNotDestructed=function(){if(this.isDestructed())throw Error("MSE was destructed.");};d.prototype.getCurrentBufferTimeRange=function(a){var c=b(this._sourceBuffer);return this._sourceBuffer&&c?c.find(function(b){return a>=b.start&&a<b.end})||null:null};d.prototype._getLeftBuffer=function(a){var b=0;if(!this.isDestructed()&&this._sourceBuffer){var c=null,e=this.getCurrentBufferTimeRange(a);
e&&(c=e.end,b=c-a);this._jobQueue.forEach(function(a){"append"===a.type&&(b+=a.duration)});this._currentPerformJob&&"append"===this._currentPerformJob.type&&(b+=this._currentPerformJob.duration);if(!(0<b)&&null===e)return null}return b};d.prototype._isRequireMoreBuffer=function(){if(!this.isDestructed()){var a=this._getLeftBuffer(this._audio.currentTime||0);return null!==a?a<this._bufferSize:!0}return!1};d.prototype.getSegmentOffset=function(a){a||(a=0);var b=-1,c=this._offsets.find(function(c,e){var d=
c.TimeRange;b=e;return a>=d.start&&a<=d.end})||null;return{index:c?b:-1,offset:c}};d.prototype.getDurationFromOffsets=function(){var a=null;this._offsets&&0<this._offsets.length&&(a=this._offsets[this._offsets.length-1].TimeRange.end);return a};d.prototype.getFormerBufferDuration=function(a){a||(a=0);var b={duration:0,start:0,end:0};if(!this.isDestructed()&&this._sourceBuffer){var c=this.getCurrentBufferTimeRange(a);c&&(b.duration=a-c.start,b.start=c.start,b.end=c.end)}return b};d.prototype.getSegmentIndex=
function(a){return this._offsets[a]};d.prototype._onAudioSeeking=function(){var a=this;this._userInteraction=this._seeking=!0;null!==this._playingObserverTimerID&&window.clearTimeout(this._playingObserverTimerID);this._playingObserverTimerID=window.setTimeout(function(){a._seeking=!1;a._playingObserverTimerID=null;a.seekResetAction()},30)};d.prototype._onAudioTimeUpdate=function(){this.performNextAction()};d.prototype._onBufferRetreived=function(a,b){if(!a.aborted&&!this.isClosed()){this._request=
null;if(400<=a.code&&500>a.code)return this.destruct();if(a.data){var c=b.TimeRange,e=c.start;c=c.end;var d=c-e,f=new Uint8Array(a.data);if("audio/mpeg"!==this._mimeCodec){f=E(f);var g=f[1];this._appendInitBuffer||(this._appendInitBuffer=!0,g=new Uint8Array(f[0].length+f[1].length),g.set(f[0],0),g.set(f[1],f[0].length));this.appendBuffer(g,d,e,c)}else this.appendBuffer(f,d,e,c)}this.performNextAction()}};d.prototype._onMediaSourceInit=function(a){this.isClosed()||(this._initialized=!0,this._MediaSource.duration=
this._duration||Infinity,this._MediaSource.removeEventListener("sourceopen",this._onMediaSourceInitHandler,!1),this._MediaSource.removeEventListener("sourceended",this._onMediaSourceInitHandler,!1),this._sourceBuffer=this._addSourceBuffer(this._mimeCodec),this._sourceBuffer.addEventListener("updateend",this._onSourceBufferUpdateEndHandler,!1),this._sourceBuffer.addEventListener("error",this._onSourceBufferErrorHandler,!1),this.performNextAction())};d.prototype._onMediaSourceEnded=function(a){};d.prototype.isClosed=
function(){return!this._audio.hasAttribute("src")||this.isDestructed()};d.prototype._onMediaSourceClose=function(){this.isDestructed()||this.destruct()};d.prototype._onMediaSourceError=function(a){console.error(a)};d.prototype._onSourceBufferUpdateEnd=function(){this._currentPerformJob=null;this.performNextAction()};d.prototype._onSourceBufferError=function(a){console.error(a)};d.prototype.isDestructed=function(){return this._desturct};d.prototype.isUpdating=function(){return this._sourceBuffer&&
this._sourceBuffer.updating};d.prototype.isEOSSignalled=function(){return this._eosSignalled};d.prototype.provideCacheManager=function(a){a&&(this._CacheManager=a)};d.prototype.seekResetAction=function(){if(this._audio||!this.isDestructed()){var a=b(this._sourceBuffer),c=!isNaN(this._audio.currentTime)&&this._audio.currentTime?this._audio.currentTime:0;c=this.getCurrentBufferTimeRange(c);if(1===a.length&&c)this.performNextAction();else{var d=this;this.abort();this._request&&!this._request.isSettled()&&
(this._request.abort(),this._request=null);this._eosSignalled=!1;this._sourceBuffer&&a.forEach(function(a){d.removeBuffer(a.start,a.end)});a=this.getSegmentOffset(this._audio.currentTime);c=a.offset;this._lastSegmentIndex=a.index;if(-1===this._lastSegmentIndex)if(this._audio&&!isNaN(this._audio.currentTime)&&this._audio.currentTime){if(a=this.getDurationFromOffsets())this._audio.currentTime=a-.2}else window.setTimeout(function(){throw Error("Current playback head outside of buffer in append-continue state.");
},0);else this._lastSegmentIndex--,this.setTimestampOffset(c.TimeRange.start),this.performNextAction()}}};d.prototype.getBufferRetriever=function(a,b,c){return this._BufferRetriever.getBuffer(a,b,c)};d.prototype.performNextAction=function(){this._ensureNotDestructed();if(this._sourceBuffer&&!this._seeking&&!this.isEOSSignalled()&&!this.isClosed()){var a=this,b=this.getFormerBufferDuration(this._audio.currentTime);6<b.duration&&this.removeBuffer(b.start,b.start+b.duration-1);if(null===this._request&&
this._isRequireMoreBuffer())if(this._lastSegmentIndex++,this._lastSegmentIndex<this._offsets.length){var c=this.getSegmentIndex(this._lastSegmentIndex);this._request=(b=this.getCache(c.startOffset,c.endOffset))?h(b):c.url?this.getBufferRetriever(c.url,c.key):this.getBufferRetriever(this._mp3URL,c.startOffset,c.endOffset);this._request.promise.then(function(b){!b||200!==b.code&&206!==b.code||a.setCache(b.data,c.startOffset,c.endOffset);a._onBufferRetreived(b,c)})["catch"](function(b){console.error(b,
c);a._onBufferRetreived(b,c)})}else if(this._lastSegmentIndex>=this._offsets.length)return this.signalEOS()}this.performNextQueueAction()};d.prototype.getCache=function(a,b){return this._CacheManager?this._CacheManager.getCache(this._file_srl,a,b):null};d.prototype.setCache=function(a,b,c){if(this._CacheManager)return this._CacheManager.setCache(a,this._file_srl,b,c)};d.prototype.performNextQueueAction=function(){if(!this.isUpdating()&&!this.isDestructed()&&this._sourceBuffer&&0<this._jobQueue.length){var a=
this._sourceBuffer,b=this._jobQueue.shift(),c=b.type;this._currentPerformJob=b;switch(c){case "remove":a.remove(b.start,b.end);break;case "append":a.appendBuffer(b.data);break;case "timestampOffset":a.timestampOffset=b.offset;this.performNextAction();break;case "eos":this._MediaSource.endOfStream()}}};d.prototype._revokeURL=function(){this._url&&(window.URL.revokeObjectURL(this._url),this._url=null)};d.prototype._addSourceBuffer=function(a){this._ensureNotDestructed();a=this._MediaSource.addSourceBuffer(a||
this._mimeCodec);a.mode="sequence";return a};d.prototype._removeSourceBuffer=function(){if(this._sourceBuffer){var a=this;this._sourceBuffer.removeEventListener("updateend",this._onSourceBufferUpdateEndHandler,!1);this._sourceBuffer.removeEventListener("error",this._onSourceBufferErrorHandler,!1);Array.prototype.some.call(this._MediaSource.sourceBuffers,function(b){return b===a._sourceBuffer})&&this._MediaSource.removeSourceBuffer(this._sourceBuffer);this._sourceBuffer=null}};d.prototype.removeBuffer=
function(a,b){this._ensureNotDestructed();this._jobQueue.push({type:"remove",start:a,end:b});this.performNextQueueAction()};d.prototype.appendBuffer=function(a,b,c,d){this._ensureNotDestructed();this._jobQueue.push({type:"append",start:c,end:d||c+b,duration:b,data:a});this.performNextQueueAction()};d.prototype.setTimestampOffset=function(a){this._ensureNotDestructed();this._jobQueue.push({type:"timestampOffset",offset:a});this.performNextQueueAction()};d.prototype.signalEOS=function(){this._ensureNotDestructed();
this._eosSignalled=!0;this._jobQueue.push({type:"eos"});this.performNextQueueAction()};d.prototype.abort=function(){this._jobQueue=[];this._currentPerformJob=null;this._sourceBuffer&&this._sourceBuffer.updating&&this._sourceBuffer.abort()};d.prototype.getURL=function(){return this._url};d.prototype.destruct=function(){this._desturct||(this.abort(),this._desturct=!0,this._BufferRetriever.destruct(),this._BufferRetriever=null,this._request&&!this._request.isSettled()&&this._request.abort(),this._audio.removeEventListener("seeking",
this._onAudioSeekingHandler,!1),this._audio.removeEventListener("timeupdate",this._onAudioTimeUpdateHandler,!1),this._initialized||this._MediaSource.removeEventListener("sourceopen",this._onMediaSourceInitHandler,!1),this._MediaSource.removeEventListener("sourceended",this._onMediaSourceEndedHandler,!1),this._MediaSource.removeEventListener("sourceclose",this._onMediaSourceCloseHandler,!1),this._MediaSource.removeEventListener("error",this._onMediaSourceErrorHandler,!1),this._removeSourceBuffer(),
this._audio.src&&(this._audio.removeAttribute("src"),this._audio.load()),this._revokeURL(),this._CacheManager=this._audio=null)};return d}(),q=function(){function a(a){this.onPlaying=new m;this.onDestructed=new m;this._player=a;this._onDestructedHandler=this._onAudioPlayingHandler=null}a.prototype.getAutoplayPriority=function(){return 100};a.prototype.onAudioPlaying=function(){this.onPlaying.dispatch(this)};a.prototype.onAudioDestructed=function(){this.onDestructed.dispatch(this)};a.prototype.isPlaying=
function(){return null};a.prototype.getType=function(){return"DEFAULT_PLAYER"};a.prototype.play=function(){return null};a.prototype.pause=function(){return null};return a}(),r=function(){function a(a){var b=q.call(this,a)||this;b._autoplayFlag=!1;b._onLoadedDataHandler=b._onLoadedData.bind(b);b._onAudioPlayingHandler=b.onAudioPlaying.bind(b);a.addEventListener("loadeddata",b._onLoadedDataHandler,!1);a.addEventListener("playing",b._onAudioPlayingHandler,!1)}n(a,q);a.prototype._onLoadedData=function(){this._player.removeEventListener("loadeddata",
this._onLoadedDataHandler,!1);if(this._autoplayFlag&&!this.isPlaying()){var a=this,c=this._player.play();if(c)c.then(function(){a._autoplayFlag=!1})["catch"](function(b){a._autoplayFlag=!1;console.error(b)});else this._autoplayFlag=!1}};a.prototype.getAutoplayPriority=function(){return 90};a.prototype.isPlaying=function(){return this._player?!this._player.paused:!1};a.prototype.getType=function(){return"HTML5_PLAYER"};a.prototype.play=function(a){return this._player&&this._player.duration&&this._player.paused?
this._player.play():a?this._autoplayFlag=!0:!1};a.prototype.pause=function(){this._autoplayFlag=!1;this.isPlaying()&&this._player.pause()};return a}(),M=function(){function a(a){(r.call(this,a._audio)||this)._SimplePlayer=a}n(a,r);a.prototype.getAutoplayPriority=function(){return 85};a.prototype.getType=function(){return"SIMPLE_PLAYER"};return a}(),N=function(){function a(a){(r.call(this,a.audio)||this)._APlayer=a}n(a,r);a.prototype.getAutoplayPriority=function(){return 80};a.prototype.getType=function(){return"A_PLAYER"};
return a}(),O=function(){function a(a){var b=a.constructor.Tools.makeDeferred;a=q.call(this,a)||this;a.makeDeferred=b;a._initializingDeferred=b();a._initializingPromise=a._initializingDeferred.promise;a._playingDeferred=null;a._isInitialized=!1;a._occurredError=!1;a._onAudioPlayingHandler=this.onAudioPlaying.bind(this);a._onAudioPlayingSubscriber=null;a._init()}n(a,q);a.prototype._init=function(){var a=this,c=this._player;if(c.isInitialized())this._initializingDeferred.resolve();else this._player.getInitializingPromise().then(function(){var b=
c._Playback;a._isInitialized=!0;a._onAudioPlayingSubscriber=b.onPlaying.subscribe(a._onAudioPlayingHandler);a._initializingDeferred.resolve()})["catch"](function(b){a._initializingDeferred.reject(b);a._occurredError=!0;console.error(b)})};a.prototype.getAutoplayPriority=function(){return 80};a.prototype.isPlaying=function(){return this._isInitialized?this._player._Playback.isPlaying():!1};a.prototype.play=function(){var a=this;this._occurredError||(this._isInitialized?a._player.play():(this._playingDeferred=
this.makeDeferred(),this._initializingPromise.then(function(){a._player.play();a._playingDeferred.resolve()})["catch"](function(b){a._playingDeferred.reject(b)})))};a.prototype.pause=function(){this._playingDeferred&&!this._playingDeferred.isResolved()&&(this._playingDeferred.reject({type:"paused",error:null}),this._playingDeferred=null);if(this._isInitialized){var a=this._player;try{a.pause()}catch(c){}}};a.prototype.getType=function(){return"BLUE_PLAYER"};return a}(),P=function(){function a(a){a=
a.getVideoNode();var b=q.call(this,a)||this;b._autoplayFlag=!1;b._onLoadedDataHandler=b._onLoadedData.bind(b);b._onVideoPlayingHandler=b.onAudioPlaying.bind(b);a.addEventListener("loadeddata",b._onLoadedDataHandler,!1);a.addEventListener("playing",b._onVideoPlayingHandler,!1)}n(a,r);a.prototype.getAutoplayPriority=function(){return 80};return a}(),Q=function(){function a(){this._listeners=[];this._observers=[];this._currentPlayer=null}a.prototype.findObserver=function(a){return this._observers.find(function(b){return b===
a})||null};a.prototype.registerPlayer=function(a){if(a&&!this.findObserver(a)){var b=this,f=a.onPlaying.subscribe(function(){b._onPlaying(a)});this._observers.push(a);this._listeners.push(f)}};a.prototype._onPlaying=function(a){this._currentPlayer&&this._currentPlayer!==a&&this._currentPlayer.isPlaying()&&this._currentPlayer.pause();this._currentPlayer=a};a.prototype.performAutoplay=function(){var a=this._observers.reduce(function(a,b){return null===a?b:b.getAutoplayPriority()<a.getAutoplayPriority()?
b:a},null);a&&(a.play(!0),this._currentPlayer=a)};return a}(),w=null,C=new m,D=new m;document.addEventListener("DOMContentLoaded",function(a){if(w=(a=/document_(\d+)/.exec(jQuery(".xe_content[class*=document_]").attr("class")||""))?a[1]:null)h.document_srl=parseInt(w,10),H(w).then(function(a){h.isDescriptionLoaded=!0;if(a&&"success"===a.message&&a.descriptions){var b=a.config,f=b.mp3_realtime_buffer_cache_size;h.config=b;h.descriptions=a.descriptions;B(a.descriptions);var k=[],d=[];(a.descriptions?
a.descriptions.filter(function(a){return!(!a||!a.description)}):null).forEach(function(a){var b=a.description;if(b){var c=b.stream;c&&c.duration?(c.isVideo?d:k).push(a):b.offsetInfo&&b.offsetInfo.offsets&&0<b.offsetInfo.offsets.length&&k.push(a)}});h.audioDescriptions=k;h.videoDescriptions=d;C.dispatch(k);D.dispatch(d);b&&b.allow_autoplay&&h.PlayerManager&&h.PlayerManager.performAutoplay();h.MemoryCacheManager&&h.MemoryCacheManager.setMaximumCacheSize(f)}})["catch"](function(a){h.isDescriptionLoaded=
!0;h.descriptionLoadError.push(a)})});h.document_srl=w;h.config={};h.convertURL2URI=z;h.PlayerManager=new Q;h.PlayerObserver={HTML5PlayerObserver:r,APlayerObserver:N,SimplePlayerObserver:M,BluePlayerObserver:O,SimpleVideoPlayerObserver:P};h.descriptionLoadError=[];h.descriptions=[];h.audioDescriptions=null;h.videoDescriptions=null;h.isDescriptionLoaded=!1;h.onAudioDescriptionLoad=C;h.onVideoDescriptionLoad=D;h.getMP3Description=function(a,b){return a&&b&&void 0!==window.default_url?new Promise(function(c,
f){var h=new XMLHttpRequest;h.open("GET",window.request_uri+"index.php?act=getSimpleMP3Description&document_srl="+a+"&file_srl="+b,!0);h.send();h.addEventListener("load",function(){var a=h.response;if(200!=h.status)f(h.status);else try{var b=JSON.parse(a);c(b)}catch(g){f(g)}},!1)}):Promise.reject(void 0)};h.MemoryCacheManager=new J;h.descriptionDecorator=B;h.EventDispatcher=m;h.MSE=A})(window.$SimpleMP3Player||(window.$SimpleMP3Player={}));