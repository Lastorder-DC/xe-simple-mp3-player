!function(e){var t,r=(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,r){function i(){this.constructor=e}t(e,r),null===r?e.prototype=Object.create(r):(i.prototype=r.prototype,e.prototype=new i)}),i=function(){var e=0;function t(){this._listeners=[]}return t.prototype.getListeners=function(){return this._listeners=this._listeners.filter(function(e){return!e.dead}).sort(function(e,t){return e.priority-t.priority}),this._listeners},t.prototype.subscribe=function(t,r){void 0===r&&(r=20);var i={id:e++,handler:t,priority:r,dead:!1};return this._listeners.push(i),{remove:function(){i.dead=!0}}},t.prototype.dispatch=function(e){var t=this;this.getListeners().forEach(function(r){t._handleCallback(r.handler,e)})},t.prototype._handleCallback=function(e,t){try{e(t)}catch(e){window.setTimeout(function(){throw e},0)}},t}(),n=function(){var e,t,r=!1;return{promise:new Promise(function(r,i){e=r,t=i}),resolve:function(t){r||(e(t),r=!0)},reject:function(e){r||(t(e),r=!0)},isEnded:function(){return r}}},o=function(e){return new Promise(function(t){e.then(function(e){t(e)}).catch(function(e){t(e)})})},s=function(){function e(e){void 0===e&&(e=15e7),this._destructed=!1,this._maxCacheSize=e,this._cacheSize=0,this._store=[]}return e.prototype.getCache=function(e,t,r){var i=this._store.find(function(i){return i.file_srl===e&&i.start===t&&i.end===r});return i?i.data:null},e.prototype.setCache=function(e,t,r,i){this.getCache(t,r,i)||(this._store.push({file_srl:t,start:r,end:i,data:e}),this._cacheSize+=e.byteLength),this.getCacheUsage()>this._maxCacheSize&&this.clear(t)},e.prototype.getCacheUsage=function(){return this._cacheSize},e.prototype.updateCacheUsage=function(){return this._cacheSize=this._store.reduce(function(e,t){return e+(t&&t.data?t.data.byteLength:0)},0),this._cacheSize},e.prototype.setMaximumCacheSize=function(e){void 0===e&&(e=15e7),this._maxCacheSize=e,this.getCacheUsage()>this._maxCacheSize&&this.clear()},e.prototype.clear=function(e){var t=!e;if(e){var r=0;this._store=this._store.filter(function(t){return t.file_srl===e&&(t&&t.data&&(r+=t.data.byteLength),!0)}),r>this._maxCacheSize&&(t=!0)}t&&(this._cacheSize=0,this._store=[]),this.updateCacheUsage()},e.prototype.isDestructed=function(){return this._destructed},e.prototype.destruct=function(){this.isDestructed()||(this._destructed=!0,this._store=[],this._cacheSize=0)},e}();function a(e){return e&&"http"!==e.substring(0,4)&&window.request_uri&&(e=(window.request_uri+e).replace(/(?:\/|\.)+index.php/,"/index.php")),e}var u=function(){var e=0,t=12,s="audio/mpeg",u='audio/mp4; codecs="mp3"',d="audio/mp4",h=void 0!==window.navigator?window.navigator.userAgent:"",l=!/chrome|opera/i.test(h)&&/safari/i.test(h),c=(h.indexOf("Trident/")>=0||h.indexOf("MSIE "),h.toLowerCase().indexOf("firefox")>=0);/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(h);function f(){var e=c?u:s;return l&&(e=d),e}function p(e){if(!e)return[];for(var t=e.buffered,r=t.length,i=[],n=0;n<r;n++)i.push({start:t.start(n),end:t.end(n)});return i}function _(e){var t=0,r=null;return e.map(function(e){e.key&&(r=e.key);var i={duration:e.time,startOffset:e.startOffset,endOffset:e.endOffset,url:e.url?e.url:null,key:r,iv:e.iv?e.iv:null,TimeRange:{start:t,end:t+e.time}};return t+=e.time,i})}function y(e){var t=function(e){if("ID3"===String.fromCharCode.apply(null,e.slice(0,3))){var t=16&e[5]?1:0,r=e[6],i=e[7],n=e[8],o=e[9];if(0==(128&r)&&0==(128&i)&&0==(128&n)&&0==(128&o))return 2097152*(127&r)+16384*(127&i)+128*(127&n)+(127&o)+10+(t?10:0)}return 0}(e);return e.slice(t)}var v=function(){var e=new Error("Decrypting Aborted"),t=new Error("could not read encrypted data"),r=function(){function r(e,t,r){this.cipher=e,this.iv=t,this.key=r,this._finish=!1,this._worker=null,this._workerRunning=!1,this._aborted=!1,this._deferred=n(),this._promise=this._deferred.promise,this.onAbort=new i,this.onFinish=new i,this.onDecryptStart=new i,this.onDecryptEnded=new i,this._onMessageHandler=this._onMessage.bind(this),this._onErrorHandler=this._onError.bind(this),this._workerTerminated=!1}return r.prototype._onMessage=function(e){if(!this._finish){var r=e.data;r&&r.buffer instanceof ArrayBuffer&&void 0!==r.byteLength?this._onFinish(r):this._onError(t)}},r.prototype._onError=function(t){this._finish||(this.isAborted()||this.abort(!0),this._deferred.reject(e),this._onEnded(t))},r.prototype._onFinish=function(e){this.onFinish.dispatch(e),this._deferred.resolve(e),this._onEnded()},r.prototype._onEnded=function(e){this._finish||(this._finish=!0,this._workerRunning=!1,this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler,!1),this._worker.removeEventListener("error",this._onErrorHandler,!1),this._worker=null),this.cipher=null,this.iv=null,this.key=null,this._finish=!0,this.onDecryptEnded.dispatch(e))},r.prototype._run=function(){try{this._workerRunning=!0,this._worker.postMessage({iv:this.iv,key:this.key,cipher:this.cipher}),this.onDecryptStart.dispatch(this)}catch(e){this._deferred.reject(e)}},r.prototype._provideWorker=function(e){this.isFinish()||(this._worker=e,this._worker.addEventListener("message",this._onMessageHandler,!1),this._worker.addEventListener("error",this._onErrorHandler,!1),this._run())},r.prototype.getPromise=function(){return this._promise},r.prototype.isFinish=function(){return this._finish||this._aborted},r.prototype.isWorkerRunning=function(){return this._workerRunning},r.prototype.isWorkerTerminated=function(){return this._workerTerminated},r.prototype.isAborted=function(){return this._aborted},r.prototype.abort=function(t){this.isFinish()||(this._aborted=!0,this.isWorkerRunning()&&(this._workerTerminated=!0,this._worker.terminate()),t||this._onError(e),this.onAbort.dispatch(void 0))},r}();function o(){this._jobQueue=[],this._worker=null,this._destructed=!1,this._currentJob=null}return o.prototype._buildWorker=function(){return this._worker?null:(this._worker=new Worker(window.default_url+"addons/simple_mp3_player/js/decrypt.js"),this._worker)},o.prototype.getWorker=function(){return this._worker?this._worker:this._buildWorker()},o.prototype._onJobEnded=function(e){this._currentJob===e&&(e.isWorkerTerminated()&&(this._worker=null),this._currentJob=null),this._performNextJob()},o.prototype._performNextJob=function(){this._jobQueue.length>0&&(this._currentJob&&!this._currentJob.isFinish()||(this._currentJob=this._jobQueue.shift(),this._currentJob._provideWorker(this.getWorker())))},o.prototype._decryptJobObserver=function(e){var t=this;this._jobQueue.push(e),e.onDecryptEnded.subscribe(function(){t._onJobEnded(e)}),this._performNextJob()},o.prototype._buildDecryptJob=function(e,t,i){var n=new r(e,t,i);return this._decryptJobObserver(n),n},o.prototype.decrypt=function(e,t,r){return this._buildDecryptJob(e,t,r)},o.prototype.destruct=function(){this._destructed||(this._currentJob&&(this._currentJob.abort(),this._currentJob=null),this._jobQueue.forEach(function(e){e.abort()}),this._jobQueue=[],this._destructed=!0)},o}(),m=function(){var e=0;function t(e,t,r,i){return{code:e||-1,data:t||null,retryCount:r||0,aborted:i}}var i=function(){function r(t,r,i){var n=this;this._id=e++,this._url=t,this._rangeStart=r,this._rangeEnd=i,this._resolveHandler=null,this._rejectHandler=null,this._settled=!1,this._aborted=!1,this._response=null,this._promise=new window.Promise(function(e,t){n._resolveHandler=e,n._rejectHandler=t}),this._retryTimerID=null,this._stalledTimerID=null,this._retryCount=0,this._initTimerID=window.setTimeout(function(){n._initTimerID=null,n._run()},0)}return r.prototype._run=function(){return null},r.prototype._performRequest=function(){return null},r.prototype._retry=function(){this._retryCount++,this._retryTimerID=window.setTimeout(this._run.bind(this),1200)},r.prototype._resolve=function(e){this._settled||(this._resolveHandler(e),this._settled=!0)},r.prototype._reject=function(e){this._settled||(this._rejectHandler(e),this._settled=!0)},r.prototype._clearRetryTimerID=function(){null!==this._retryTimerID&&window.clearTimeout(this._retryTimerID),this._retryTimerID=null},r.prototype._clearStalledTimerID=function(){this._stalledTimerID&&window.clearTimeout(this._stalledTimerID),this._stalledTimerID=null},r.prototype._setStalledTimerID=function(){this._clearStalledTimerID(),this._stalledTimerID=window.setTimeout(this._onTimeout.bind(this),18e3)},r.prototype._onTimeout=function(){this._clearStalledTimerID(),this._abort(),this._run()},r.prototype.abort=function(){this._settled||(null!==this._initTimerID&&(window.clearTimeout(this._initTimerID),this._initTimerID=null),this._aborted=!0,this._clearRetryTimerID(),this._clearStalledTimerID(),this._reject(t(void 0,void 0,void 0,!0)))},r.prototype.isSettled=function(){return this._settled||this._aborted},r.prototype.isAborted=function(){return this._aborted},r.prototype.getPromise=function(){return this._promise},r}();return{RequestToFetch:function(){function e(e,t,r){var n=i.apply(this,arguments)||this;n._AbortController=null,n._requestJob=null}return r(e,i),e.isSupported=function(){return"AbortController"in window&&"fetch"in window&&"Headers"in window},e.prototype._run=function(){if(!this.isSettled()){var e=this,r=this._performRequest();r.promise.then(function(i){e.isAborted()||r.aborted||(i.ok?i.arrayBuffer().then(function(r){e._clearStalledTimerID(),e._resolve(t(i.status,r,e._retryCount,e.isAborted()))}).catch(function(e){}):(e._clearStalledTimerID(),i.status&&i.status>=400&&i.status<=500?e._reject(t(i.status,null,e._retryCount,e.isAborted())):e._retry()),e._response=i)}).catch(function(t){r.aborted||(e._clearStalledTimerID(),e._aborted||null===e._retryTimerID&&e._retry())}),e._requestJob=r,e._setStalledTimerID()}},e.prototype._abort=function(){this._AbortController&&(this._requestJob.aborted=!0,this._AbortController.abort())},e.prototype.abort=function(){this._settled||(this._abort(),i.prototype.abort.call(this))},e.prototype._performRequest=function(){this._clearRetryTimerID(),this._AbortController=new window.AbortController;var e=void 0;return void 0!==this._rangeStart&&void 0!==this._rangeEnd&&(e=new window.Headers).append("Range","bytes="+this._rangeStart+"-"+this._rangeEnd),{promise:window.fetch(this._url,{method:"GET",signal:this._AbortController.signal,credentials:"omit",headers:e}),aborted:!1}},e}(),RequestToXHR:function(){function e(e,t){return{status:e,data:t}}function s(e,t,r){var n=i.apply(this,arguments)||this;n._requestJob=null,n._runHandler=null}return r(s,i),s.prototype._onTimeout=function(){i.prototype._onTimeout.call(this)},s.prototype._run=function(){if(!this.isSettled()){var e=this,r=e._performRequest();o(r.promise).then(function(i){r.aborted||(e._clearStalledTimerID(),i.status>=400&&i.status<500?e._reject(t(i.status,i.data,e._retryCount,e.isAborted())):!function(e){return e&&e.status>=200&&e.status<300}(i)?e._retry():e._resolve(t(i.status,i.data,e._retryCount,e.isAborted())))}),e._requestJob=r,e._setStalledTimerID()}},s.prototype._performRequest=function(){this._clearRetryTimerID();var t=new XMLHttpRequest;t.open("GET",this._url,!0),void 0!==this._rangeStart&&void 0!==this._rangeEnd&&t.setRequestHeader("Range","bytes="+this._rangeStart+"-"+this._rangeEnd),t.responseType="arraybuffer";var r=n(),i={xhr:t,deferred:r,promise:r.promise,aborted:!1};return t.send(),t.addEventListener("readystatechange",function(i){t.status>=400&&t.status<500?r.reject(e(t.status,null)):t.readyState===XMLHttpRequest.DONE&&(200===t.status||206===t.status?r.resolve(e(t.status,t.response)):r.reject(e(0,null)))}),i},s.prototype._abort=function(){this._requestJob&&!this._requestJob.aborted&&(this._requestJob.xhr.abort(),this._requestJob.aborted=!0)},s.prototype.abort=function(){this._settled||(this._abort(),i.prototype.abort.call(this))},s}()}}();function g(e,t,r){e=a(e);var i=m.RequestToFetch,n=m.RequestToXHR,s=i.isSupported()?new i(e,t,r):new n(e,t,r);return{promise:o(s.getPromise.call(s)),abort:s.abort.bind(s),isSettled:s.isSettled.bind(s)}}var b=function(){var e=function(){function e(){this._destructed=!1,this._encrypted=!1,this._key=null,this._initialized=!1,this._keyRetriever=null,this._bufferRetriever=[],this._init()}return e.prototype._init=function(){this._initialized=!0},e.prototype.isEncrypted=function(){return null},e.prototype.isInitialized=function(){return this._initialized},e.prototype.isKeyRetrieving=function(){return!!this._keyRetriever&&!this._keyRetriever.isSettled()},e.prototype.getBuffer=function(e){return null},e.prototype.abortKeyRetriever=function(){this.isKeyRetrieving()&&this._keyRetriever.abort(),this._keyRetriever=null},e.prototype.abort=function(){this.abortKeyRetriever(),this._bufferRetriever.forEach(function(e){e.abort()})},e.prototype.destruct=function(){this._destructed||(this.abort(),this._bufferRetriever=[],this._destructed=!0)},e}(),t=function(){function t(){e.call(this)}return r(t,e),t.prototype._init=function(){e.prototype._init.call(this)},t.prototype._observeBufferRetriever=function(e){var t=this;this._bufferRetriever.push(e),o(e.promise).then(function(){var r=t._bufferRetriever.indexOf(e);r>-1&&t._bufferRetriever.splice(r,1)})},t.prototype.getBuffer=function(e,t,r){var i=g(e,t,r);return this._observeBufferRetriever(i),i},t.prototype.isEncrypted=function(){return!1},t}();return{EncryptedBufferRetriever:function(){var e=["handshake","timestamp","document_srl","file_srl","ip"],i=new v,o=function(){function e(e,t,r){this._deferred=n(),this._aborted=!1,this._settled=!1,this.promise=this._deferred.promise,this._keyRetriever=e,this._bufferBuilder=t,this._bufferRetriever=null,this._decrypter=null,this._retrievedData=null,this._iv=r||null,this._run()}return e.prototype._run=function(){var e=this,t=null;this._keyRetriever.promise.then(function(r){if(!e.isSettled())return t=new Uint8Array(r.data),e._bufferRetriever=e._bufferBuilder(),e._bufferRetriever.promise}).then(function(r){if(!e.isSettled()){e._retrievedData=r;var n=new Uint8Array(r.data),o=e._iv?n:n.slice(48,n.byteLength),s=e._iv?e._iv:n.slice(0,16);return this._decrypter=i.decrypt(o,s,t),this._decrypter.getPromise()}}).then(function(t){e.isSettled()||(e._retrievedData.data=t,e._deferred.resolve(e._retrievedData))}).catch(function(t){e._deferred.reject(t),e._settled=!0})},e.prototype.abort=function(){this.isSettled()||(this._bufferRetriever&&(this._bufferRetriever.isSettled()||this._bufferRetriever.abort(),this._bufferRetriever=null),this._decrypter&&(this._decrypter.abort(),this._decrypter=null),this._aborted=!0)},e.prototype.isSettled=function(){return this._aborted||this._settled},e}(),s=function(t){var r=new URL((window.default_url+t).replace(/(\/.\/)/,"/")),i={};return e&&e.forEach(function(e){var t=r.searchParams.get(e);t&&(i[e]=t)}),i},a=function(e){return{promise:e,abort:function(){},isSettled:function(){return!0}}};function u(){(t.call(this)||this)._handshake=null}return r(u,t),u.prototype.onKeyRetrieved=function(e){e&&e.data&&(this._handshake=e.handshake,this._key=new Uint8Array(e.data))},u.prototype._buildKeyRetriever=function(e){return g(e)},u.prototype._updateKeyRetriever=function(e){var t=this,r=this._buildKeyRetriever(e),i=s(e);return r?(this._keyRetriever=r,this._handshake=i._handshake,r.promise.then(function(e){t.onKeyRetrieved({data:e.data,handshake:i.handshake})}).catch(function(e){}),r):null},u.prototype.isValidKey=function(e){return s(e).handshake===this._handshake&&!!this._key},u.prototype.getKeyRetriever=function(e){var t=s(e);if(this.isValidKey(e))return a(Promise.resolve((r=200,i=this._key,void 0===n&&(n=!1),void 0===o&&(o=0),{aborted:n,code:r||-1,data:i||null,retryCount:o})));if(this.isKeyRetrieving()){if(t.handshake===this._handshake)return this._keyRetriever;this.abortKeyRetriever()}this.resetKey();var r,i,n,o,u=this._updateKeyRetriever(e);return u||a(Promise.reject(void 0))},u.prototype.resetKey=function(){this._handshake=null,this._key=null},u.prototype._buildBufferRetriever=function(e){return t.prototype.getBuffer.call(this,e)},u.prototype.getBuffer=function(e,t,r){return new o(this.getKeyRetriever(t),this._buildBufferRetriever.bind(this,e),r)},u.prototype.isEncrypted=function(){return!0},u}(),BufferRetriever:t}}();function w(r,i,n){void 0===n&&(n={file_srl:null,bufferSize:t,mp3url:null}),this._id=e++,this._audio=r,this._file_srl=n.file_srl,this._playlist=i,this._duration=this._playlist?this._playlist.duration:0,this._BufferRetriever=this._playlist&&this._playlist.encrypted?new b.EncryptedBufferRetriever:new b.BufferRetriever,this._offsets=this._playlist?_(this._playlist.offsets):null,this._mp3URL=n.mp3url,this._MediaSource=new window.MediaSource,this._sourceBuffer=null,this._url=window.URL.createObjectURL(this._MediaSource),this._initialized=!1,this._desturct=!1,this._mimeCodec=f(),this._appendInitBuffer=!1,this._onAudioSeekingHandler=this._onAudioSeeking.bind(this),this._onAudioTimeUpdateHandler=this._onAudioTimeUpdate.bind(this),this._onMediaSourceInitHandler=this._onMediaSourceInit.bind(this),this._onMediaSourceEndedHandler=this._onMediaSourceEnded.bind(this),this._onMediaSourceCloseHandler=this._onMediaSourceClose.bind(this),this._onMediaSourceErrorHandler=this._onMediaSourceError.bind(this),this._onSourceBufferUpdateEndHandler=this._onSourceBufferUpdateEnd.bind(this),this._onSourceBufferErrorHandler=this._onSourceBufferError.bind(this),this._currentPerformJob=null,this._CacheManager=null,this._bufferSize=n.bufferSize&&"number"==typeof n.bufferSize?n.bufferSize:t,this._MediaSource.addEventListener("sourceopen",this._onMediaSourceInitHandler,!1),this._MediaSource.addEventListener("sourceclose",this._onMediaSourceCloseHandler,!1),this._MediaSource.addEventListener("error",this._onMediaSourceErrorHandler,!1),this._jobQueue=[],this._seeking=!1,this._request=null,this._eosSignalled=!1,this._lastSegmentIndex=-1,this._playingObserverTimerID=null,this._MSEInitialized=!1,this._init()}return w.helper={getAudioBuffer:g},w.isSupported=function(){if("MediaSource"in window){if(l){var e=window.navigator.appVersion.match(/version\/([0-9]+)\.([0-9]+)/i),t=-1;if(e&&e.length>=3){var r=parseInt(e[1],10);isNaN(r)||(t=r)}if(t<10)return!1}return window.MediaSource.isTypeSupported(f())}return!1},w.prototype._init=function(){if(!this.isDestructed()){this._ensureNotDestructed(),this._audio.addEventListener("seeking",this._onAudioSeekingHandler,!1),this._audio.addEventListener("timeupdate",this._onAudioTimeUpdateHandler,!1),this._audio.src=this.getURL();try{this._audio.load()}catch(e){console.error(e)}this._bufferSize>180&&(this._bufferSize=180),this._bufferSize<1&&(this._bufferSize=t)}},w.prototype._ensureNotDestructed=function(){if(this.isDestructed())throw new Error("MSE was destructed.")},w.prototype.getCurrentBufferTimeRange=function(e){var t=p(this._sourceBuffer);return this._sourceBuffer&&t&&t.find(function(t){return e>=t.start&&e<t.end})||null},w.prototype._getLeftBuffer=function(e){var t=0;if(!this.isDestructed()&&this._sourceBuffer){var r=null,i=this.getCurrentBufferTimeRange(e);if(i&&(r=i.end,t=r-e),this._jobQueue.forEach(function(e){"append"===e.type&&(t+=e.duration)}),this._currentPerformJob&&"append"===this._currentPerformJob.type&&(t+=this._currentPerformJob.duration),t>0)return t;if(null===i)return null}return t},w.prototype._isRequireMoreBuffer=function(){if(!this.isDestructed()){var e=this._audio.currentTime||0,t=this._getLeftBuffer(e);return null===t||t<this._bufferSize}return!1},w.prototype._provideOffsetList=function(e){this.isClosed()||(this._playlist=e,this._offsets=_(this._playlist.offsets),this._duration=this._playlist.duration,this._BufferRetriever=this._playlist.encrypted?new b.EncryptedBufferRetriever:new b.BufferRetriever,this._MSEInitialized&&!this._initialized&&this._onMediaSourceInit())},w.prototype.getSegmentOffset=function(e){e||(e=0);var t=-1,r=this._offsets.find(function(r,i){var n=r.TimeRange;return t=i,e>=n.start&&e<=n.end})||null;return{index:r?t:-1,offset:r}},w.prototype.getDurationFromOffsets=function(){var e=null;this._offsets&&this._offsets.length>0&&(e=this._offsets[this._offsets.length-1].TimeRange.end);return e},w.prototype.getFormerBufferDuration=function(e){e||(e=0);var t={duration:0,start:0,end:0};if(!this.isDestructed()&&this._sourceBuffer){var r=this.getCurrentBufferTimeRange(e);r&&(t.duration=e-r.start,t.start=r.start,t.end=r.end)}return t},w.prototype.getSegmentIndex=function(e){return this._offsets[e]},w.prototype._onAudioSeeking=function(){var e=this;this._seeking=!0,this._userInteraction=!0,null!==this._playingObserverTimerID&&window.clearTimeout(this._playingObserverTimerID),this._playingObserverTimerID=window.setTimeout(function(){e._seeking=!1,e._playingObserverTimerID=null,e.seekResetAction()},30)},w.prototype._onAudioTimeUpdate=function(){this.performNextAction()},w.prototype._onBufferRetreived=function(e,t){if(!e.aborted&&!this.isClosed()){if(this._request=null,e.code>=400&&e.code<500)return this.destruct();if(e.data){var r=t.TimeRange,i=r.start,n=r.end,o=n-i,a=y(new Uint8Array(e.data));if(this._mimeCodec!==s){var u=function(e){var t=[],r=null,i={rate:r||44100,id:3},n=null,o=new MP3Parser,s=null;if(o.onFrame=function(e){try{null===s&&(r=o.samplerate,n={codecId:2,channels:2,samplerate:(i={rate:r,id:3}).rate,samplesize:16,timescale:r},(s=new MP4Mux({audioTrackId:0,videoTrackId:-1,tracks:[n]})).ondata=function(e){t.push(e)}),o.onFrame=function(e){var t=new Uint8Array(e.length+1),r=32;r|=i.id<<2,r|=2,r|=1,t[0]=r,t.set(e,1),s.pushPacket(8,t,0)},o.onFrame(e)}catch(e){console.log(e)}},o.push(e),o.close(),s.flush(),0===t.length)throw new Error("There was no output.");return t}(a),d=u[1];this._appendInitBuffer||(this._appendInitBuffer=!0,(d=new Uint8Array(u[0].length+u[1].length)).set(u[0],0),d.set(u[1],u[0].length)),this.appendBuffer(d,o,i,n)}else this.appendBuffer(a,o,i,n)}this.performNextAction()}},w.prototype._onMediaSourceInit=function(e){this._MSEInitialized=!0,this.isClosed()||this._initialized||!this._offsets||(this._initialized=!0,this._MediaSource.duration=this._duration||1/0,this._MediaSource.removeEventListener("sourceopen",this._onMediaSourceInitHandler,!1),this._MediaSource.removeEventListener("sourceended",this._onMediaSourceInitHandler,!1),this._sourceBuffer=this._addSourceBuffer(this._mimeCodec),this._sourceBuffer.addEventListener("updateend",this._onSourceBufferUpdateEndHandler,!1),this._sourceBuffer.addEventListener("error",this._onSourceBufferErrorHandler,!1),this.performNextAction())},w.prototype._onMediaSourceEnded=function(e){},w.prototype.isClosed=function(){return!this._audio.hasAttribute("src")||this.isDestructed()},w.prototype._onMediaSourceClose=function(){this.isDestructed()||this.destruct()},w.prototype._onMediaSourceError=function(e){console.error(e)},w.prototype._onSourceBufferUpdateEnd=function(){this._currentPerformJob=null,this.performNextAction()},w.prototype._onSourceBufferError=function(e){console.error(e)},w.prototype.isDestructed=function(){return this._desturct},w.prototype.isUpdating=function(){return this._sourceBuffer&&this._sourceBuffer.updating},w.prototype.isEOSSignalled=function(){return this._eosSignalled},w.prototype.provideCacheManager=function(e){e&&(this._CacheManager=e)},w.prototype.seekResetAction=function(){if(this._audio||!this.isDestructed()){var e=p(this._sourceBuffer),t=!isNaN(this._audio.currentTime)&&this._audio.currentTime?this._audio.currentTime:0,r=this.getCurrentBufferTimeRange(t);if(1===e.length&&r)this.performNextAction();else{var i=this;this.abort(),this._request&&!this._request.isSettled()&&(this._request.abort(),this._request=null),this._eosSignalled=!1,this._sourceBuffer&&e.forEach(function(e){i.removeBuffer(e.start,e.end)});var n=this.getSegmentOffset(this._audio.currentTime),o=n.offset;if(this._lastSegmentIndex=n.index,-1!==this._lastSegmentIndex)this._lastSegmentIndex--,this.setTimestampOffset(o.TimeRange.start),this.performNextAction();else if(this._audio&&!isNaN(this._audio.currentTime)&&this._audio.currentTime){var s=this.getDurationFromOffsets();s&&(this._audio.currentTime=s-.2)}else window.setTimeout(function(){throw new Error("Current playback head outside of buffer in append-continue state.")},0)}}},w.prototype.getBufferRetriever=function(e,t,r){return this._BufferRetriever.getBuffer(e,t,r)},w.prototype.performNextAction=function(){if(this._ensureNotDestructed(),this._sourceBuffer&&!this._seeking&&!this.isEOSSignalled()&&!this.isClosed()){var e=this,t=this.getFormerBufferDuration(this._audio.currentTime);if(t.duration>6&&this.removeBuffer(t.start,t.start+t.duration-1),null===this._request&&this._isRequireMoreBuffer())if(this._lastSegmentIndex++,this._lastSegmentIndex<this._offsets.length){var r=this.getSegmentIndex(this._lastSegmentIndex),i=this.getCache(r.startOffset,r.endOffset);this._request=i?(n=i,o=!1,{promise:Promise.resolve({aborted:o,code:200,data:n,retryCount:0,cache:!0}),isSettled:function(){return!0},abort:function(){return o=!0}}):r.url?this.getBufferRetriever(r.url,r.key,r.iv?r.iv:void 0):this.getBufferRetriever(this._mp3URL,r.startOffset,r.endOffset),this._request.promise.then(function(t){!t||200!==t.code&&206!==t.code||e.setCache(t.data,r.startOffset,r.endOffset),e._onBufferRetreived(t,r)}).catch(function(t){console.error(t,r),e._onBufferRetreived(t,r)})}else if(this._lastSegmentIndex>=this._offsets.length)return this.signalEOS()}var n,o;this.performNextQueueAction()},w.prototype.getCache=function(e,t){return this._CacheManager&&this._file_srl&&e&&t?this._CacheManager.getCache(this._file_srl,e,t):null},w.prototype.setCache=function(e,t,r){if(this._CacheManager&&this._file_srl)return this._CacheManager.setCache(e,this._file_srl,t,r)},w.prototype.performNextQueueAction=function(){if(!this.isUpdating()&&!this.isDestructed()&&this._sourceBuffer&&this._jobQueue.length>0){var e=this._sourceBuffer,t=this._jobQueue.shift(),r=t.type;switch(this._currentPerformJob=t,r){case"remove":e.remove(t.start,t.end);break;case"append":e.appendBuffer(t.data);break;case"timestampOffset":e.timestampOffset=t.offset,this.performNextAction();break;case"eos":this._MediaSource.endOfStream()}}},w.prototype._revokeURL=function(){this._url&&(window.URL.revokeObjectURL(this._url),this._url=null)},w.prototype._addSourceBuffer=function(e){this._ensureNotDestructed();var t=this._MediaSource.addSourceBuffer(e||this._mimeCodec);return t.mode="sequence",t},w.prototype._removeSourceBuffer=function(){if(this._sourceBuffer){var e=this;this._sourceBuffer.removeEventListener("updateend",this._onSourceBufferUpdateEndHandler,!1),this._sourceBuffer.removeEventListener("error",this._onSourceBufferErrorHandler,!1),Array.prototype.some.call(this._MediaSource.sourceBuffers,function(t){return t===e._sourceBuffer})&&this._MediaSource.removeSourceBuffer(this._sourceBuffer),this._sourceBuffer=null}},w.prototype.removeBuffer=function(e,t){this._ensureNotDestructed(),this._jobQueue.push({type:"remove",start:e,end:t}),this.performNextQueueAction()},w.prototype.appendBuffer=function(e,t,r,i){this._ensureNotDestructed(),this._jobQueue.push({type:"append",start:r,end:i||r+t,duration:t,data:e}),this.performNextQueueAction()},w.prototype.setTimestampOffset=function(e){this._ensureNotDestructed(),this._jobQueue.push({type:"timestampOffset",offset:e}),this.performNextQueueAction()},w.prototype.signalEOS=function(){this._ensureNotDestructed(),this._eosSignalled=!0,this._jobQueue.push({type:"eos"}),this.performNextQueueAction()},w.prototype.abort=function(){this._jobQueue=[],this._currentPerformJob=null,this._sourceBuffer&&this._sourceBuffer.updating&&this._sourceBuffer.abort()},w.prototype.getURL=function(){return this._url},w.prototype.destruct=function(){this._desturct||(this.abort(),this._desturct=!0,this._BufferRetriever.destruct(),this._BufferRetriever=null,this._request&&!this._request.isSettled()&&this._request.abort(),this._audio.removeEventListener("seeking",this._onAudioSeekingHandler,!1),this._audio.removeEventListener("timeupdate",this._onAudioTimeUpdateHandler,!1),this._initialized||this._MediaSource.removeEventListener("sourceopen",this._onMediaSourceInitHandler,!1),this._MediaSource.removeEventListener("sourceended",this._onMediaSourceEndedHandler,!1),this._MediaSource.removeEventListener("sourceclose",this._onMediaSourceCloseHandler,!1),this._MediaSource.removeEventListener("error",this._onMediaSourceErrorHandler,!1),this._removeSourceBuffer(),this._audio.src&&(this._audio.removeAttribute("src"),this._audio.load()),this._revokeURL(),this._audio=null,this._CacheManager=null)},w}(),d=function(){var e,t;e||(e={}),e[e.VOD=0]="VOD",e[e.LIVE=1]="LIVE",e[e.EVENT=2]="EVENT",t||(t={}),t[t.NONE=0]="NONE",t[t.AES_128=1]="AES_128",t[t.SAMPLE_AES=2]="SAMPLE_AES";var r=u.helper.getAudioBuffer,i=function(){function e(e,t,r){if(e<0||t<=0)throw new Error("Invalid TimeRange argument error.");this.start=e,this.duration=t,this.end=r||e+t}return e.sortTimeRanges=function(e){return e.slice(0).sort(function(e,t){return t.start-e.start})},e.normalizeTimeRanges=function(t){return e.sortTimeRanges(t).reduce(function(e,t,r){var i=e.length-1;return r>0&&t.start<=e[i].end?e[i].end=t.end:e.push(t),e},[]).map(function(t){var r=t.start,i=t.end;return new e(r,i-r,i)})},e}(),o=function(){var r=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(ALLOWCACHE): *(\w+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(MAP):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT(INF): *(\d+(?:\.\d+)?)(?:,(.*))?)|(?:(?!#)()(\S.+))|(?:#EXT-X-(BYTERANGE): *(\d+(?:@\d+(?:\.\d+)?)?)|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.+))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*)))(?:.*)\r?\n?/g,n=/(.+?)=(.+?)(?:,|$)/g,o=/^\d*(\.\d+)?$/;function s(e){var t,r,i={};for(n.lastIndex=0;null!==(t=n.exec(e));){var o=t[1].trim().toLowerCase(),s=0===(r=t[2].trim()).indexOf('"')&&r.lastIndexOf('"')===r.length-1?r.slice(1,-1):r;i[o]=s}return i}function a(e){0===e.indexOf("0x")&&(e=e.substr(2));var t=new Uint16Array(8);if(e.length%4!=0)throw new Error("Failed to parse IV (length is not multiple of 4).");for(var r=0;r<e.length;r+=4){var i=parseInt(e.substr(r,4),16);if(isNaN(i))throw new Error("Failed to parse hex number in IV string.");t[r/4]=i}return new Uint8Array(t)}function u(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}function d(e){this._data=null,this._data=this.parse(e)}return d.prototype.parse=function(n){var d=this._data,h={version:null,type:e.LIVE,mediaSequence:null,targetDuration:null,totalDuration:0,allowCache:null,ended:!1};r.lastIndex=0;for(var l,c=[],f=null,p=0,_=null,y={method:t.NONE},v=0;null!==(l=r.exec(n));){var m=l.filter(function(e,t){return 0!==t&&void 0!==e}).map(function(e,t){return 0===t?e.toLowerCase():e}),g=m[0],b=m.slice(1),w=!1;if(0===p){if("extm3u"!==g)throw new Error("First line did not contain EXTM3U tag.")}else{if(!w)switch(g){case"playlist-type":if(h.type!==e.LIVE)throw new Error("Already have playlist type.");switch(b[0].toLowerCase()){case"vod":h.type=e.VOD;break;case"event":h.type=e.EVENT;break;default:throw new Error("Invalid playlist type.")}break;case"media-sequence":if(null!==h.mediaSequence)throw new Error("Already have media sequence number.");var E=parseInt(b[0],10);if(b[0]!==E+"")throw new Error("Invalid media sequence number.");h.mediaSequence=E,v=E;break;case"allowcache":h.allowCache="YES"===b[0].toLowerCase();break;case"targetduration":if(null!==h.targetDuration)throw new Error("Already have target duration.");var S=parseInt(b[0],10);if(b[0]!==S+""||S<0)throw new Error("Invalid target duration.");h.targetDuration=1e3*S;break;case"version":if(null!==h.version)throw new Error("Already have version.");var D=parseInt(b[0],10);if(b[0]!==D+"")throw new Error("Invalid version.");if(D<3)throw new Error("HLS version must be 3 or above.");h.version=D;break;default:w=!0}if(w)switch(g){case"key":var T="method"in(_=s(b[0]))?_.method.toLowerCase():null,R="uri"in _?_.uri:null,k="iv"in _?a(_.iv):null;if(!T)throw new Error("Missing encryption method.");if("none"!==T&&!R)throw new Error("Missing key url.");switch(T){case"none":if(null!==R)throw new Error("Key url not allowed.");if(null!==k)throw new Error("IV not allowed.");y={method:t.NONE};break;case"aes-128":if(!R)throw new Error("Key url required.");y={method:t.AES_128,keyUrl:R,iv:k};break;case"sample-aes":if(!R)throw new Error("Key url required.");y={method:t.SAMPLE_AES,keyUrl:R,iv:k};break;default:throw new Error("Unknown encryption method.")}break;case"map":if(!("uri"in(_=s(b[0]))))throw new Error("URI missing from EXT-X-MAP tag.");if("byterange"in _)throw new Error("BYTERANGE in EXT-X-MAP tag is currently unsupported.");break;case"inf":if(!b[0].match(o))throw new Error("Invalid segment duration.");f=1e3*parseFloat(b[0]);break;case"":if(h.ended)throw new Error("Already received ENDLIST tag.");if(null===f)throw new Error("Not received segment duration.");c.push({url:b[0],timeRange:new i(h.totalDuration,f),encryptData:{method:y.method,keyUrl:y.keyUrl?y.keyUrl:null,iv:y.iv?y.iv:y.keyUrl?u(v):null}}),h.totalDuration+=f,f=null,v++;break;case"endlist":if(h.ended)throw new Error("Already had ENDLIST tag.");h.ended=!0;break;default:console.warn("Unable to parse playlist line.",g)}}p++}var A=h.version,I=h.type,M=h.mediaSequence,P=h.targetDuration,L=h.ended,B=h.totalDuration;if(null===A)throw new Error("Missing version.");if(null===P)throw new Error("Missing target duration.");if(L&&I===e.LIVE)throw new Error("Cannot be ended if type is LIVE.");if(!L&&I===e.VOD)throw new Error("Must be ended if type is VOD.");if(null===M&&(M=0),d){if(d.type!==I)throw new Error("Playlist type has changed since last update.");if(d.type===e.EVENT&&M!==d.mediaSequence)throw new Error("Media sequence number has changed. Not valid for EVENT playlist.");var C=h.segments[M-h.mediaSequence];if(!C)throw new Error("Tracking lost. The last segment of the previous playlist is no longer in the new one.");var O=C.timeRange.start;c.forEach(function(e){var t=e.timeRange;e.timeRange=new i(t.start+O,t.duration)}),B+=O}return{version:A,type:I,mediaSequence:M,targetDuration:P,totalDuration:B,ended:L,segments:c}},d.prototype._calculatePlaylist=function(){if(this._playlist){var e=0;this._playlist.forEach(function(t){e+=t.duration}),this._duration=e}},d.prototype.hasEnded=function(){if(!this._playlist)throw new Error("Not loaded yet.")},d.prototype.getSegmentCount=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.segments.length},d.prototype.getType=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.type},d.prototype.getSegment=function(e){if(!this._data)throw new Error("Not loaded yet.");return this._data.segments[e]},d.prototype.getSegmentByPosition=function(e){if(!this._data)throw new Error("Not loaded yet.");var t=null,r=this._data.segments.find(function(r,i){var n=r.timeRange;if(e>=n.start&&e<=n.end)return t=i,!0});return r?{index:t,segment:r}:null},d.prototype.getDuration=function(){return this._data.totalDuration},d.prototype.getEntireData=function(){return this._data},d.prototype.merge=function(e){},d}(),s=function(){function e(e){var t=this;this._deferred=n(),this._promise=this._deferred.promise,this._request=r(e),this._aborted=!1,this._ended=!1,this._request.promise.then(function(e){e.data?t._onLoad(String.fromCharCode.apply(null,new Uint8Array(e.data))):t._onFailure(e)})}return e.prototype._resolve=function(e){this._ended||(this._deferred.resolve(e),this._ended=!0)},e.prototype._reject=function(e){this._ended||(this._deferred.reject(e),this._ended=!0)},e.prototype._onLoad=function(e){try{var t=new o(e);return this._resolve(t.getEntireData())}catch(e){return this._onFailure(e)}},e.prototype._onFailure=function(e){this._reject(e)},e.prototype.getPromise=function(){return this._promise},e.prototype.isEnded=function(){return this._aborted||this._ended},e.prototype.abort=function(){this._request&&!this._request.isSettled()&&(this._request.abort(),this._aborted=!0)},e}();new Error("Destructed");function a(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}function d(e){return e.segments.reduce(function(e,r){var i=r.timeRange,n=r.encryptData,o=function(e){var t={startOffset:null,endOffset:null};if(e)try{var r=parseInt(a("start",e),10),i=parseInt(a("end",e),10);isNaN(r)||(t.startOffset=r),isNaN(i)||(t.endOffset=i)}catch(e){console.error(e)}return t}(r.url),s={start:i.start,end:i.end,time:i.duration/1e3,startOffset:o.startOffset,endOffset:o.endOffset};return r.url&&(s.url=r.url),n&&n.method!==t.NONE&&(e.encrypted=!0,s.key=n.keyUrl,s.iv=n.iv),e.offsets.push(s),e},{encrypted:!1,duration:e.totalDuration/1e3,offsets:[]})}function h(e,t,r,i){var n=this;this._audioNode=e,this._m3u8URL=t,this._file_srl=r,this._bufferSize=i,this._retreiver=new s(t),this._MSE=new u(this._audioNode,null,{file_srl:this._file_srl,bufferSize:this._bufferSize}),this._destructed=!1,this._playlist=null,this._offsetList=null,this._retreiver.getPromise().then(function(e){n._playlist=e,n._onPlaylistLoad(e)}).catch(function(e){console.error(e),n.destruct()}),this._cacheManager=null}return h.prototype._initMSE=function(e){this._MSE._provideOffsetList(e),this._cacheManager&&this._MSE.provideCacheManager(this._cacheManager)},h.prototype._onPlaylistLoad=function(e){this._offsetList=d(e),this._initMSE(this._offsetList)},h.prototype.provideCacheManager=function(e){this._MSE?this._MSE.provideCacheManager(e):this._cacheManager=e},h.prototype.destruct=function(){this._destructed||(this._retreiver&&!this._retreiver.isEnded()&&(this._retreiver.abort(),this._retreiver=null),this._MSE&&(this._MSE.destruct(),this._MSE=null),this._destructed=!0)},h}(),h=function(){function e(e){this.onPlaying=new i,this.onDestructed=new i,this._player=e,this._onAudioPlayingHandler=null,this._onDestructedHandler=null}return e.prototype.getAutoplayPriority=function(){return 100},e.prototype.onAudioPlaying=function(){this.onPlaying.dispatch(this)},e.prototype.onAudioDestructed=function(){this.onDestructed.dispatch(this)},e.prototype.isPlaying=function(){return null},e.prototype.getType=function(){return"DEFAULT_PLAYER"},e.prototype.play=function(){return null},e.prototype.pause=function(){return null},e}(),l=function(){function e(e){var t=h.call(this,e)||this;t._autoplayFlag=!1,t._onLoadedDataHandler=t._onLoadedData.bind(t),t._onAudioPlayingHandler=t.onAudioPlaying.bind(t),e.addEventListener("loadeddata",t._onLoadedDataHandler,!1),e.addEventListener("playing",t._onAudioPlayingHandler,!1)}return r(e,h),e.prototype._onLoadedData=function(){if(this._player.removeEventListener("loadeddata",this._onLoadedDataHandler,!1),this._autoplayFlag&&!this.isPlaying()){var e=this,t=this._player.play();t?t.then(function(){e._autoplayFlag=!1}).catch(function(t){e._autoplayFlag=!1,console.error(t)}):this._autoplayFlag=!1}},e.prototype.getAutoplayPriority=function(){return 90},e.prototype.isPlaying=function(){return!!this._player&&!this._player.paused},e.prototype.getType=function(){return"HTML5_PLAYER"},e.prototype.play=function(e){return this._player&&this._player.duration&&this._player.paused?this._player.play():!!e&&(this._autoplayFlag=!0)},e.prototype.pause=function(){this._autoplayFlag=!1,this.isPlaying()&&this._player.pause()},e}(),c=function(){function e(e){var t=e._audio;(l.call(this,t)||this)._SimplePlayer=e}return r(e,l),e.prototype.getAutoplayPriority=function(){return 85},e.prototype.getType=function(){return"SIMPLE_PLAYER"},e}(),f=function(){function e(e){var t=e.audio;(l.call(this,t)||this)._APlayer=e}return r(e,l),e.prototype.getAutoplayPriority=function(){return 80},e.prototype.getType=function(){return"A_PLAYER"},e}(),p=function(){function e(e){var t=e.constructor.Tools.makeDeferred,r=h.call(this,e)||this;r.makeDeferred=t,r._initializingDeferred=t(),r._initializingPromise=r._initializingDeferred.promise,r._playingDeferred=null,r._isInitialized=!1,r._occurredError=!1,r._onAudioPlayingHandler=this.onAudioPlaying.bind(this),r._onAudioPlayingSubscriber=null,r._init()}return r(e,h),e.prototype._init=function(){var e=this,t=this._player;t.isInitialized()?this._initializingDeferred.resolve():this._player.getInitializingPromise().then(function(){var r=t._Playback;e._isInitialized=!0,e._onAudioPlayingSubscriber=r.onPlaying.subscribe(e._onAudioPlayingHandler),e._initializingDeferred.resolve()}).catch(function(t){e._initializingDeferred.reject(t),e._occurredError=!0,console.error(t)})},e.prototype.getAutoplayPriority=function(){return 80},e.prototype.isPlaying=function(){return!!this._isInitialized&&this._player._Playback.isPlaying()},e.prototype.play=function(){var e=this,t=function(){e._player.play()};this._occurredError||(this._isInitialized?t():(this._playingDeferred=this.makeDeferred(),this._initializingPromise.then(function(){t(),e._playingDeferred.resolve()}).catch(function(t){e._playingDeferred.reject(t)})))},e.prototype.pause=function(){if(this._playingDeferred&&!this._playingDeferred.isResolved()&&(this._playingDeferred.reject({type:"paused",error:null}),this._playingDeferred=null),this._isInitialized){var e=this._player;try{e.pause()}catch(e){}}},e.prototype.getType=function(){return"BLUE_PLAYER"},e}(),_=function(){function e(e){var t=e.getVideoNode(),r=h.call(this,t)||this;r._autoplayFlag=!1,r._onLoadedDataHandler=r._onLoadedData.bind(r),r._onVideoPlayingHandler=r.onAudioPlaying.bind(r),t.addEventListener("loadeddata",r._onLoadedDataHandler,!1),t.addEventListener("playing",r._onVideoPlayingHandler,!1)}return r(e,l),e.prototype.getAutoplayPriority=function(){return 80},e}(),y=function(){function e(){this._listeners=[],this._observers=[],this._currentPlayer=null}return e.prototype.findObserver=function(e){return this._observers.find(function(t){return t===e})||null},e.prototype.registerPlayer=function(e){if(e&&!this.findObserver(e)){var t=this,r=e.onPlaying.subscribe(function(){t._onPlaying(e)});this._observers.push(e),this._listeners.push(r)}},e.prototype._onPlaying=function(e){this._currentPlayer&&this._currentPlayer!==e&&this._currentPlayer.isPlaying()&&this._currentPlayer.pause(),this._currentPlayer=e},e.prototype.performAutoplay=function(){var e=this._observers.reduce(function(e,t){return null===e?t:t.getAutoplayPriority()<e.getAutoplayPriority()?t:e},null);e&&(e.play(!0),this._currentPlayer=e)},e}();var v=null,m=new i,g=new i;function b(e){return e?e.replace(/(\&amp\;)/gi,"&"):e}function w(t){var r=function(e){if(e)try{e.ownerID&&(e.ownerID=window.atob(e.ownerID)),e.data&&(e.data=window.atob(e.data)),e.description&&(e.description=window.atob(e.description))}catch(e){}},i=!1;if(e.config){var n=e.config;n.default_cover,i=n.remove_extension_in_title}if(t){n.use_thumbnail;var o=["title","artist","album","albumartist","contentgroup","genre","publisher","conductor","composer","copyright","comment","www","unsyncedlyrics"],s=["priv","comm","uniquefileid","albumArt"];t.forEach(function(e){var t,n=e.description;if(n){n.tags||(n.tags={title:null,artist:null,album:null,albumArt:null});var a=n.tags;n.download_url&&(n.download_url=window.default_url+"index.php"+b(n.download_url)),a.priv&&a.priv.length>0&&a.priv.forEach(r),a.uniquefileid&&r(a.uniquefileid),a.comm&&a.comm.forEach(r),i&&(n.filename="string"==typeof(t=n.filename)?t.replace(/\.[^\/.]+$/,""):t);var u=n.stream;if(u){var d=u.audio,h=u.video;d&&d.length&&d.forEach(function(e){e&&Object.keys(e).forEach(function(t){var r=typeof e[t];"boolean"!==r&&"number"!==r&&null!==e[t]&&(e[t]=window.atob(e[t]))})}),h&&Object.keys(h).forEach(function(e){var t=typeof h[e];"boolean"!==t&&"number"!==t&&null!==h[e]&&(h[e]=window.atob(h[e]))})}Object.keys(a).forEach(function(e){if(-1===s.indexOf(e)){var t=typeof a[e];"boolean"!==t&&"number"!==t&&null!==a[e]&&(a[e]=o.indexOf(e)>-1?function(e){var t;try{t=e?atob(e):e}catch(e){return console.error(e),null}return t?window.decodeURIComponent(Array.prototype.map.call(t,function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")):null}(a[e]):window.atob(a[e]))}}),a.title&&(a.title=b(a.title)),a.artist&&(a.artist=b(a.artist)),a.album&&(a.album=b(a.album))}})}}document.addEventListener("DOMContentLoaded",function(t){var r=/document_(\d+)/.exec(jQuery(".xe_content[class*=document_]").attr("class")||"");(v=r?r[1]:null)&&(e.document_srl=parseInt(v,10),function(e){return e&&void 0!==window.default_url?new Promise(function(t,r){var i=new XMLHttpRequest,n=window.request_uri+"index.php?mid="+window.current_mid+"&act=getSimpleMP3Descriptions&document_srl="+e;u.isSupported()||(n+="&hls=false"),i.open("GET",n,!0),i.send(),i.addEventListener("load",function(){var e=i.response;if(200!=i.status)r(i.status);else try{var n=JSON.parse(e);t(n)}catch(e){r(e)}},!1)}):Promise.reject(void 0)}(v).then(function(t){if(e.isDescriptionLoaded=!0,t&&"success"===t.message&&t.descriptions){var r=t.config,i=r.mp3_realtime_buffer_cache_size;e.config=r,e.descriptions=t.descriptions,w(t.descriptions);var n=t.descriptions?t.descriptions.filter(function(e){return!(!e||!e.description)}):null,o=[],s=[];n.forEach(function(e){var t=e.description;if(t){var r=t.stream;if(r&&r.duration)(r.isVideo?s:o).push(e);else t.offsetInfo&&t.offsetInfo.offsets&&t.offsetInfo.offsets.length>0&&o.push(e)}}),e.audioDescriptions=o,e.videoDescriptions=s,m.dispatch(o),g.dispatch(s),r&&r.allow_autoplay&&e.PlayerManager&&e.PlayerManager.performAutoplay(),e.MemoryCacheManager&&e.MemoryCacheManager.setMaximumCacheSize(i)}}).catch(function(t){e.isDescriptionLoaded=!0,e.descriptionLoadError.push(t)}))}),e.document_srl=v,e.config={},e.convertURL2URI=a,e.PlayerManager=new y,e.PlayerObserver={HTML5PlayerObserver:l,APlayerObserver:f,SimplePlayerObserver:c,BluePlayerObserver:p,SimpleVideoPlayerObserver:_},e.descriptionLoadError=[],e.descriptions=[],e.audioDescriptions=null,e.videoDescriptions=null,e.isDescriptionLoaded=!1,e.onAudioDescriptionLoad=m,e.onVideoDescriptionLoad=g,e.getMP3Description=function(e,t){return e&&t&&void 0!==window.default_url?new Promise(function(r,i){var n=new XMLHttpRequest,o=window.request_uri+"index.php?act=getSimpleMP3Description&document_srl="+e+"&file_srl="+t;n.open("GET",o,!0),n.send(),n.addEventListener("load",function(){var e=n.response;if(200!=n.status)i(n.status);else try{var t=JSON.parse(e);r(t)}catch(e){i(e)}},!1)}):Promise.reject(void 0)},e.MemoryCacheManager=new s,e.descriptionDecorator=w,e.EventDispatcher=i,e.MSE=u,e.SimpleHLS=d}(window.$SimpleMP3Player||(window.$SimpleMP3Player={}));