!function(t,e){if(void 0!==e&&void 0!==window.BluePlayer){var s=!1,i=1,r=!1,n=!1,o=0,a=!1,l=!0,u=20,d=20,_=!0,f=!0,c=!1,h=12,p=!0,m=!1,y=200,g=e.MSE,v=e.SimpleHLS,P=null;t(document).ready(function(){e.audioDescriptions&&e.audioDescriptions.length>0?C(e.audioDescriptions):e.onAudioDescriptionLoad.subscribe(C)})}function b(v,P,b,C,R){if(e&&e.config){var k=e.config,q=k.BluePlayer__track_mode;s=k.BluePlayer__use_autostation,i="AutoStation"===q&&s?3:"RepeatTrack"===q?2:"RepeatList"===q?1:0,r=k.BluePlayer__track_random,n=k.isMobile?k.use_m_lyric:k.use_lyric,o=k.BluePlayer__autostation_max_size,k.allow_autoplay,a=k.BluePlayer_show_album_name,l=k.use_mediasession,d=k.mediasession_backward_time,u=k.mediasession_forward_time,_=k.use_mp3_realtime_streaming,f=k.BluePlayer_enable_download,c=k.BluePlayer__track_random_force,h=k.mp3_realtime_buffer_size,p=k.BluePlayer__autostation_search_filter,m=k.BluePlayer_enable_fade,y=k.BluePlayer_fade_duration}var x=function(t,s,i,r){var n=BluePlayer.Playlist,o=n.PlaylistManager,a=n.RandomPlaylistManager,l=n.getDefaultSongRequest,u=BluePlayer.Tools,d=u.makeDeferred,_=BluePlayer.TrackMode;function f(t,e){var s=!1,i=!1;return t.then(function(){i=!0}),{promise:t,abort:function(){i||s||(e.abortRequestingJob(),s=!0)},isResolved:function(){return i||s},type:"unknown"}}function c(t,e,s,i){var r=null,n=!1,o=!1;return{promise:new Promise(function(a,l){var u="";if(p){var d=new URL(window.current_url||window.location.href),_=d.searchParams.get("category"),f=d.searchParams.get("search_keyword"),c=d.searchParams.get("search_target");_&&(u+=_?"&category_srl="+_:""),f&&c&&(u+="&search_target="+c+"&search_keyword="+encodeURIComponent(f))}(r=new XMLHttpRequest).open("GET",window.default_url+"index.php?mid="+t+"&document_srl="+e+u+"&act="+s+(i?"&"+i:""),!0),r.send(),r.addEventListener("readystatechange",function(){if(r.status>=400&&r.status<500)n=!0,l(r.status);else if(r.readyState===XMLHttpRequest.DONE){if(o)return l({type:"aborted",error:null});200===r.status?(n=!0,a(JSON.parse(r.response))):l(r.status)}},!1)}),isResolved:function(){return n||o},abort:function(){n||o||!r||(o=!0,r.abort())}}}function h(e){var i=n.PlaylistManager.call(this,[])||this;i._player=e,i._mid=t,i._document_srl=s,i._loadedListCount=!1,i._requestingCountJob=null,i._requestingCountJobDeferred=null,i._previousListCount=null,i._nextListCount=null,i._randomListCount=null,i._previousListOffset=null,i._nextListOffset=null,i._randomListOffset=null,i._listOffsets=[],i._lastNextListOffset=null,i._lastPrevListOffset=null,i._lastRequestedNextListOffset=null,i._lastRequestedPrevListOffset=null,i._errors=[],i._requestingJob=null,i._descriptionQueue=[],i._random=!1,i._RandomPlaylistManager=null,i._init()}return(0,u.extend)(h,o),h.prototype._init=function(){this._loadedListCount||this._loadListCount()},h.prototype._loadListCount=function(){var t=this;return this._requestingCountJob&&!this._requestingCountJob.isResolved()&&this._requestingCountJob.abort(),this._requestingCountJobDeferred=d(),this._requestingCountJob=this.getTrackCount(),this._requestingCountJob.promise.then(function(e){t._previousListCount=e.prev,t._nextListCount=e.next,t._randomListCount=e.random,t._listOffsets=t.buildRandomOffset(t._randomListCount),t._loadedListCount=!0,t._lastNextListOffset=t._previousListCount+1,t._lastPrevListOffset=t._previousListCount,t._lastRequestedNextListOffset=t._lastNextListOffset,t._lastRequestedPrevListOffset=t._lastPrevListOffset,t._totalLoadedCount=0,t._requestingCountJobDeferred.resolve(e)}).catch(function(e){t._requestingCountJobDeferred.reject(e)}),this._requestingCountJobDeferred.promise},h.prototype.buildRandomOffset=function(t){for(var e=[],s=1;s<=t;s++)e.push(s);return a.prototype.buildPlaylist(e)},h.prototype.abortRequestingJob=function(){this._requestingJob&&!this._requestingJob.isResolved()&&this._requestingJob.abort(),this._requestingJob=null},h.prototype._handleError=function(t){this._errors.push(t),console.error(t)},h.prototype.getTrackCount=function(){var t,e,s=this,i=d();return this._requestingCountJob=(t=this._mid,e=this._document_srl,c(t,e,"getFileCount")),this._requestingCountJob.promise.then(function(t){i.resolve(t)}).catch(function(t){s._handleError(t)}),i},h.prototype.isCountLoading=function(){return this._requestingCountJob&&!this._requestingCountJob.isResolved()},h.prototype.isCountLoaded=function(){return this._loadedListCount},h.prototype.isRandom=function(){return this._random},h.prototype.getPlaylist=function(){var t=this._player._Playlist;return t?t.getPlaylist():[]},h.prototype.getNextSequenceOffsets=function(){var t=[];if(this._lastNextListOffset=this._lastRequestedNextListOffset,this._lastPrevListOffset=this._lastRequestedPrevListOffset,this.isRandom()||r)for(;this._listOffsets.length>0;){var e=Math.floor(this._listOffsets.length*Math.random());if(t.push(this._listOffsets[e]),t.length>=1)break}else{for(var s=this._previousListCount+this._nextListCount,i=this._lastNextListOffset;i<=s&&!(t.length>=1);i++)this._listOffsets.indexOf(i)>-1&&(t.push(i),this._lastNextListOffset=i);if(t.length<1)for(i=this._lastPrevListOffset;i>0&&(this._listOffsets.indexOf(i)>-1&&(t.push(i),this._lastPrevListOffset=i),!(t.length>=1));i--);}return t},h.prototype.getNextTrackDescriptions=function(){this.abortRequestingJob();var t=this,e=d();this._requestingJob=e;return(this.isCountLoading()?this._requestingCountJobDeferred.promise:this.isCountLoaded()?window.Promise.resolve():this._loadListCount()).then(function(){var s=t.getNextSequenceOffsets();t._requestingJob=function(t,e,s){return c(t,e,"getFileDescription",s.map(function(t){return"offset[]="+t}).join("&")+(g.isSupported()?"":"&hls=false"))}(t._mid,t._document_srl,s),t._requestingJob.promise.then(function(i){s.forEach(function(e){var s=t._listOffsets.indexOf(e);s>-1&&t._listOffsets.splice(s,1)}),i&&i.descriptions&&i.descriptions.length?(t._descriptionQueue=t._descriptionQueue.concat(i.descriptions),e.resolve(t._descriptionQueue)):e.reject({type:"not_found",error:null}),t._lastRequestedNextListOffset=t._lastNextListOffset,t._lastRequestedPrevListOffset=t._lastPrevListOffset}).catch(function(s){s instanceof Error&&t._handleError(s),e.reject(s)})}),e.promise},h.prototype.getTrackItemIndex=function(t){var e=this._player._Playlist;return e?e.getTrackItemIndex(t):-1},h.prototype._getNextTrack=function(){var t=this,s=d(),i=this._player._Playlist,r=function(){var r=t._descriptionQueue.shift();if(r){var n=[{description:r}];e.descriptionDecorator(n);var o=w(n,!0),a=i.addTrackItems(o);s.resolve(a.length?a[0]:null),t._totalLoadedCount++}else s.resolve(null)};return this._descriptionQueue.length&&r(),this.getNextTrackDescriptions().then(function(){r()}).catch(function(){s.resolve(null)}),s.promise},h.prototype.getPreviousTrackItem=function(){var t=this._player,e=t._Playback,s=t._Playlist;e.getCurrentTrackItem();return this.isRandom()?this.getPreviousTrackFromHistory():s._getPreviousTrackItem()},h.prototype.provideCurrentTrackItem=function(t){this._RandomPlaylistManager&&this._RandomPlaylistManager.provideCurrentTrackItem(t),o.prototype.provideCurrentTrackItem.call(this,t)},h.prototype.getNextTrackItem=function(t){var e=this._player,s=e._Playback,i=e._Playlist,r=s.getCurrentTrackItem(),n=this.isRandom();if(n&&i&&r)return this.hasQueueEmpty()?(this._RandomPlaylistManager||this.setRandomPlaylistManager(),this._RandomPlaylistManager.getNextTrackItem(t)):(this._RandomPlaylistManager=null,f(this._getNextTrack(),this));var o=this.getTrackItemIndex(r),a=i.getTrackItemCount();return this.hasQueueEmpty()&&o+1>=a&&(o=-1),n&&a&&(o=Math.floor(Math.random()*a)-1),o>=-1&&o+1<a?l(this.getPlaylist()[o+1]):f(this._getNextTrack(),this)},h.prototype.hasQueueEmpty=function(){return 0===this._listOffsets.length||i&&this._totalLoadedCount>=i},h.prototype.setRandom=function(t){this._random=t,t&&this.hasQueueEmpty()?this.setRandomPlaylistManager():this._RandomPlaylistManager=null},h.prototype.setRandomPlaylistManager=function(){var t=this._player,e=t?t._Playlist:null;this.hasQueueEmpty()&&e&&(this._RandomPlaylistManager=new a(e.getPlaylist(),_.REPEAT_LIST))},h}(R,C,o,c),T=t("<div></div>");v.prepend(T);var M=e.PlayerManager,J=e.PlayerObserver.BluePlayerObserver,N=w(P),I=new window.BluePlayer({container:T[0],playlist:N,volume:100,showAlbumName:a,enableLyric:n,activeFade:m,fadeDuration:y,random:r,autoplay:!1,mode:i,enableMediaSession:l,mediaSessionForwardTime:1e3*u,mediaSessionBackwardTime:1e3*d,labels:{play:"재생",pause:"일시정지",random:"랜덤재생",repeat:"반복설정",remove:"목록에서 삭제",more:"더 보기",close:"닫기",skipBackward:"이전 곡으로",skipForward:"다음 곡으로",rightClickPlay:"재생",rightClickPause:"일시정지",rightClickRemoveTrack:"목록에서 삭제"},messages:{loadingLyric:"가사를 불러오는 중입니다.",notFoundLyric:"가사를 찾을 수 없습니다."},handlers:{trackMenu:O,CustomPlaylist:R&&C&&s?x:null},customAudioType:{hls:L}});M.registerPlayer(new J(I)),window.tt=I}function L(t,s){if(s){var i=s.description;P&&(P.destruct(),P=null),_&&g&&g.isSupported()&&i?(i.offsetInfo?P=new g(t,i.offsetInfo,{mp3url:s.url,file_srl:i.file_srl,bufferSize:h}):i.m3u8link&&(P=new v(t,i.m3u8link,i.file_srl,h)),P&&P.provideCacheManager(e.MemoryCacheManager)):(t.src=s.url,t.load())}}function w(t,s){var i=[],r=e.config,n=r.default_cover,o=r.use_thumbnail;return n&&(n=e.convertURL2URI(n)),t.forEach(function(t){var e=t.description,r=e.offsetInfo,a=e.tags,l=e.stream;a||(a={}),r||(r={}),l||(l={});var u=e.file_srl,d=a.title?a.title:e.filename,_=a.artist?a.artist:null,f=a.album?a.album:null,c=a.albumArt?a.albumArt:null,h=r.duration?1e3*r.duration:l.duration?1e3*l.duration:null,p=e.filePath,m=window.request_uri+"index.php?act=getSimpleMP3Lyric&file_srl="+u+"&type=text";c||(o&&e.thumbnail?c=e.thumbnail:n&&(c=n)),i.push({title:d,artist:_,album:f,albumArt:c,duration:h,url:p,type:"hls",lrc:m,allowRemove:s||!1,description:e})}),i}function C(s){var i=t(".xe_content[class*=document_]"),r=/document_(\d+)/.exec(t(".xe_content[class*=document_]").attr("class")||""),n=r?r[1]:null;if(n&&s&&s.length){if(e.config){var o=e.config;(o.isMobile&&o.use_m_lyric||!o.isMobile&&o.use_lyric)&&!0}b(i,s,0,n,window.current_mid)}}function O(t){var s=[];if(t.description){var i=t.description;i.download_url&&f&&s.push({name:"다운로드",handler:k(t)});var r,n=e.config,o=n.BluePlayer_enable_thumbnail_button,a=n.is_supported_to_set_thumbnail;return i.document_srl&&(i.document_srl!==e.document_srl?s.push({name:"게시글 열기",handler:(r=i.document_srl,function(){r&&window.open(window.default_url+"index.php?document_srl="+r)})}):a&&o&&i.editable&&i.tags&&i.tags.albumArt&&s.push({name:"게시글 섬네일 변경",handler:R(i.document_srl,i.file_srl)})),s}}function R(t,e){return function(){if(t&&e){var s=window.default_url+"index.php?mid="+window.current_mid+"&act=updateSimpleMP3Thumbnail&document_srl="+t+"&file_srl="+e,i=new XMLHttpRequest;i.open("GET",s,!0),i.setRequestHeader("X-ADDONS-XSS-PROTECTOR","OK"),i.send(),i.addEventListener("load",function(){200===i.status?JSON.parse(i.response).result?alert("게시글의 섬네일을 선택한 곡의 앨범 커버로 변경하였습니다."):alert("게시글 섬네일을 변경하는 도중 오류가 발생했습니다."):console.error(i)},!1)}}}function k(t){return function(){if(t.description){var e=t.description;e.download_url&&window.open(e.download_url)}}}}(window.jQuery,window.$SimpleMP3Player);