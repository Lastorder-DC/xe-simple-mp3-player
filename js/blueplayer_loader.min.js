(function(q,h){function P(d,f,a,g,m){if(h&&h.config){a=h.config;var n=a.BluePlayer__track_mode;t=a.BluePlayer__use_autostation;x="AutoStation"===n&&t?3:"RepeatTrack"===n?2:"RepeatList"===n?1:0;y=a.BluePlayer__track_random;z=a.isMobile?a.use_m_lyric:a.use_lyric;A=a.BluePlayer__autostation_max_size;B=a.BluePlayer_show_album_name;C=a.use_mediasession;D=a.mediasession_backward_time;E=a.mediasession_forward_time;F=a.use_mp3_realtime_streaming;G=a.BluePlayer__track_random_force;H=a.mp3_realtime_buffer_size;
I=a.BluePlayer__autostation_search_filter;J=a.BluePlayer_enable_fade;K=a.BluePlayer_fade_duration}a=function(a,d,f,g){function l(b,c){var a=!1,d=!1;b.then(function(){d=!0});return{promise:b,abort:function(){d||a||(c.abortRequestingJob(),a=!0)},isResolved:function(){return d||a},type:"unknown"}}function m(b,c,a,d){var e=null,f=!1,k=!1;return{promise:new Promise(function(h,w){var g="";if(I){var l=new URL(window.current_url||window.location.href),m=l.searchParams.get("category"),r=l.searchParams.get("search_keyword");
l=l.searchParams.get("search_target");m&&(g+=m?"&category_srl="+m:"");r&&l&&(g+="&search_target="+l+"&search_keyword="+encodeURIComponent(r))}e=new XMLHttpRequest;e.open("GET",window.default_url+"index.php?mid="+b+"&document_srl="+c+g+"&act="+a+(d?"&"+d:""),!0);e.send();e.addEventListener("readystatechange",function(){if(400<=e.status&&500>e.status)f=!0,w(e.status);else if(e.readyState===XMLHttpRequest.DONE){if(k)return w({type:"aborted",error:null});200===e.status?(f=!0,h(JSON.parse(e.response))):
w(e.status)}},!1)}),isResolved:function(){return f||k},abort:function(){f||k||!e||(k=!0,e.abort())}}}function r(b,c,a){a=a.map(function(b){return"offset[]="+b}).join("&");return m(b,c,"getFileDescription",a+(u.isSupported()?"":"&hls=false"))}function k(b){var c=n.PlaylistManager.call(this,[])||this;c._player=b;c._mid=a;c._document_srl=d;c._loadedListCount=!1;c._requestingCountJob=null;c._requestingCountJobDeferred=null;c._previousListCount=null;c._nextListCount=null;c._randomListCount=null;c._previousListOffset=
null;c._nextListOffset=null;c._randomListOffset=null;c._listOffsets=[];c._lastNextListOffset=null;c._lastPrevListOffset=null;c._lastRequestedNextListOffset=null;c._lastRequestedPrevListOffset=null;c._errors=[];c._requestingJob=null;c._descriptionQueue=[];c._random=!1;c._RandomPlaylistManager=null;c._init()}var n=BluePlayer.Playlist,L=n.PlaylistManager,M=n.RandomPlaylistManager,q=n.getDefaultSongRequest,p=BluePlayer.Tools,v=p.makeDeferred,t=BluePlayer.TrackMode;p=p.extend;p(k,L);k.prototype._init=
function(){this._loadedListCount||this._loadListCount()};k.prototype._loadListCount=function(){var b=this;this._requestingCountJob&&!this._requestingCountJob.isResolved()&&this._requestingCountJob.abort();this._requestingCountJobDeferred=v();this._requestingCountJob=this.getTrackCount();this._requestingCountJob.promise.then(function(c){b._previousListCount=c.prev;b._nextListCount=c.next;b._randomListCount=c.random;b._listOffsets=b.buildRandomOffset(b._randomListCount);b._loadedListCount=!0;b._lastNextListOffset=
b._previousListCount+1;b._lastPrevListOffset=b._previousListCount;b._lastRequestedNextListOffset=b._lastNextListOffset;b._lastRequestedPrevListOffset=b._lastPrevListOffset;b._totalLoadedCount=0;b._requestingCountJobDeferred.resolve(c)})["catch"](function(c){b._requestingCountJobDeferred.reject(c)});return this._requestingCountJobDeferred.promise};k.prototype.buildRandomOffset=function(b){for(var c=[],a=1;a<=b;a++)c.push(a);return M.prototype.buildPlaylist(c)};k.prototype.abortRequestingJob=function(){this._requestingJob&&
!this._requestingJob.isResolved()&&this._requestingJob.abort();this._requestingJob=null};k.prototype._handleError=function(b){this._errors.push(b);console.error(b)};k.prototype.getTrackCount=function(){var b=this,a=v();this._requestingCountJob=m(this._mid,this._document_srl,"getFileCount");this._requestingCountJob.promise.then(function(b){a.resolve(b)})["catch"](function(a){b._handleError(a)});return a};k.prototype.isCountLoading=function(){return this._requestingCountJob&&!this._requestingCountJob.isResolved()};
k.prototype.isCountLoaded=function(){return this._loadedListCount};k.prototype.isRandom=function(){return this._random};k.prototype.getPlaylist=function(){var b=this._player._Playlist;return b?b.getPlaylist():[]};k.prototype.getNextSequenceOffsets=function(){var b=[];this._lastNextListOffset=this._lastRequestedNextListOffset;this._lastPrevListOffset=this._lastRequestedPrevListOffset;if(this.isRandom()||g)for(;0<this._listOffsets.length&&!(b.push(this._listOffsets[Math.floor(this._listOffsets.length*
Math.random())]),1<=b.length););else{for(var a=this._previousListCount+this._nextListCount,e=this._lastNextListOffset;e<=a&&!(1<=b.length);e++)-1<this._listOffsets.indexOf(e)&&(b.push(e),this._lastNextListOffset=e);if(1>b.length)for(e=this._lastPrevListOffset;0<e&&!(-1<this._listOffsets.indexOf(e)&&(b.push(e),this._lastPrevListOffset=e),1<=b.length);e--);}return b};k.prototype.getNextTrackDescriptions=function(){this.abortRequestingJob();var b=this,a=v();this._requestingJob=a;var e=null;e=this.isCountLoading()?
this._requestingCountJobDeferred.promise:this.isCountLoaded()?window.Promise.resolve():this._loadListCount();e.then(function(){var c=b.getNextSequenceOffsets();b._requestingJob=r(b._mid,b._document_srl,c);b._requestingJob.promise.then(function(e){c.forEach(function(a){a=b._listOffsets.indexOf(a);-1<a&&b._listOffsets.splice(a,1)});e&&e.descriptions&&e.descriptions.length?(b._descriptionQueue=b._descriptionQueue.concat(e.descriptions),a.resolve(b._descriptionQueue)):a.reject({type:"not_found",error:null});
b._lastRequestedNextListOffset=b._lastNextListOffset;b._lastRequestedPrevListOffset=b._lastPrevListOffset})["catch"](function(c){c instanceof Error&&b._handleError(c);a.reject(c)})});return a.promise};k.prototype.getTrackItemIndex=function(b){var a=this._player._Playlist;return a?a.getTrackItemIndex(b):-1};k.prototype._getNextTrack=function(){var b=this,a=v(),e=this._player._Playlist,d=function(){var c=b._descriptionQueue.shift();c?(c=[{description:c}],h.descriptionDecorator(c),c=N(c,!0),c=e.addTrackItems(c),
a.resolve(c.length?c[0]:null),b._totalLoadedCount++):a.resolve(null)};this._descriptionQueue.length&&d();this.getNextTrackDescriptions().then(function(){d()})["catch"](function(){a.resolve(null)});return a.promise};k.prototype.getPreviousTrackItem=function(){var b=this._player,a=b._Playlist;b._Playback.getCurrentTrackItem();return this.isRandom()?this.getPreviousTrackFromHistory():a._getPreviousTrackItem()};k.prototype.provideCurrentTrackItem=function(a){this._RandomPlaylistManager&&this._RandomPlaylistManager.provideCurrentTrackItem(a);
L.prototype.provideCurrentTrackItem.call(this,a)};k.prototype.getNextTrackItem=function(a){var b=this._player,e=b._Playlist,d=b._Playback.getCurrentTrackItem();if((b=this.isRandom())&&e&&d){if(this.hasQueueEmpty())return this._RandomPlaylistManager||this.setRandomPlaylistManager(),this._RandomPlaylistManager.getNextTrackItem(a);this._RandomPlaylistManager=null;return l(this._getNextTrack(),this)}a=this.getTrackItemIndex(d);e=e.getTrackItemCount();this.hasQueueEmpty()&&a+1>=e&&(a=-1);b&&e&&(a=Math.floor(Math.random()*
e)-1);return-1<=a&&a+1<e?q(this.getPlaylist()[a+1]):l(this._getNextTrack(),this)};k.prototype.hasQueueEmpty=function(){return 0===this._listOffsets.length||f&&this._totalLoadedCount>=f};k.prototype.setRandom=function(a){(this._random=a)&&this.hasQueueEmpty()?this.setRandomPlaylistManager():this._RandomPlaylistManager=null};k.prototype.setRandomPlaylistManager=function(){var a=this._player;a=a?a._Playlist:null;this.hasQueueEmpty()&&a&&(this._RandomPlaylistManager=new M(a.getPlaylist(),t.REPEAT_LIST))};
return k}(m,g,A,G);n=q("<div></div>");d.prepend(n);d=h.PlayerManager;var r=h.PlayerObserver.BluePlayerObserver;f=N(f);g=new window.BluePlayer({container:n[0],playlist:f,volume:100,showAlbumName:B,enableLyric:z,activeFade:J,fadeDuration:K,random:y,autoplay:!1,mode:x,enableMediaSession:C,mediaSessionForwardTime:1E3*E,mediaSessionBackwardTime:1E3*D,labels:{play:"\uc7ac\uc0dd",pause:"\uc77c\uc2dc\uc815\uc9c0",random:"\ub79c\ub364\uc7ac\uc0dd",repeat:"\ubc18\ubcf5\uc124\uc815",remove:"\ubaa9\ub85d\uc5d0\uc11c \uc0ad\uc81c",
more:"\ub354 \ubcf4\uae30",close:"\ub2eb\uae30",skipBackward:"\uc774\uc804 \uace1\uc73c\ub85c",skipForward:"\ub2e4\uc74c \uace1\uc73c\ub85c",rightClickPlay:"\uc7ac\uc0dd",rightClickPause:"\uc77c\uc2dc\uc815\uc9c0",rightClickRemoveTrack:"\ubaa9\ub85d\uc5d0\uc11c \uc0ad\uc81c"},messages:{loadingLyric:"\uac00\uc0ac\ub97c \ubd88\ub7ec\uc624\ub294 \uc911\uc785\ub2c8\ub2e4.",notFoundLyric:"\uac00\uc0ac\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."},handlers:{trackMenu:Q,CustomPlaylist:m&&g&&t?a:
null},customAudioType:{hls:R}});d.registerPlayer(new r(g));window.tt=g}function R(d,f){if(f){var a=f.description;p&&p.destruct();F&&u&&u.isSupported()&&a&&a.offsetInfo?(p=new u(d,f.url,a.offsetInfo,a.file_srl,H),p.provideCacheManager(h.MemoryCacheManager)):(d.src=f.url,d.load())}}function N(d,f){var a=[],g=h.config,m=g.default_cover,n=g.use_thumbnail;m&&(m=h.convertURL2URI(m));d.forEach(function(d){d=d.description;var g=d.offsetInfo,l=d.tags,h=d.stream;l||(l={});g||(g={});h||(h={});var p=l.title?
l.title:d.filename,q=l.artist?l.artist:null,r=l.album?l.album:null;l=l.albumArt?l.albumArt:null;g=g.duration?1E3*g.duration:h.duration?1E3*h.duration:null;h=d.filePath;var t=window.request_uri+"index.php?act=getSimpleMP3Lyric&file_srl="+d.file_srl+"&type=text";l||(n&&d.thumbnail?l=d.thumbnail:m&&(l=m));a.push({title:p,artist:q,album:r,albumArt:l,duration:g,url:h,type:"hls",lrc:t,allowRemove:f||!1,description:d})});return a}function O(d){var f=q(".xe_content[class*=document_]"),a=/document_(\d+)/.exec(q(".xe_content[class*=document_]").attr("class")||
"");if((a=a?a[1]:null)&&d&&d.length){var g=!1;if(h.config){var m=h.config;if(m.isMobile&&m.use_m_lyric||!m.isMobile&&m.use_lyric)g=!0}P(f,d,g,a,window.current_mid)}}function Q(d){var f=[];if(d.description){var a=d.description;a.download_url&&f.push({name:"\ub2e4\uc6b4\ub85c\ub4dc",handler:S(d)});var g=h.config;d=g.BluePlayer_enable_thumbnail_button;g=g.is_supported_to_set_thumbnail;a.document_srl&&(a.document_srl!==h.document_srl?f.push({name:"\uac8c\uc2dc\uae00 \uc5f4\uae30",handler:T(a.document_srl)}):
g&&d&&a.editable&&a.tags&&a.tags.albumArt&&f.push({name:"\uac8c\uc2dc\uae00 \uc12c\ub124\uc77c \ubcc0\uacbd",handler:U(a.document_srl,a.file_srl)}));return f}}function U(d,f){return function(){if(d&&f){var a=new XMLHttpRequest;a.open("GET",window.default_url+"index.php?mid="+window.current_mid+"&act=updateSimpleMP3Thumbnail&document_srl="+d+"&file_srl="+f,!0);a.setRequestHeader("X-ADDONS-XSS-PROTECTOR","OK");a.send();a.addEventListener("load",function(){200===a.status?JSON.parse(a.response).result?
alert("\uac8c\uc2dc\uae00\uc758 \uc12c\ub124\uc77c\uc744 \uc120\ud0dd\ud55c \uace1\uc758 \uc568\ubc94 \ucee4\ubc84\ub85c \ubcc0\uacbd\ud558\uc600\uc2b5\ub2c8\ub2e4."):alert("\uac8c\uc2dc\uae00 \uc12c\ub124\uc77c\uc744 \ubcc0\uacbd\ud558\ub294 \ub3c4\uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4."):console.error(a)},!1)}}}function S(d){return function(){if(d.description){var f=d.description;f.download_url&&window.open(f.download_url)}}}function T(d){return function(){d&&window.open(window.default_url+
"index.php?document_srl="+d)}}if(void 0!==h&&void 0!==window.BluePlayer){var t=!1,x=1,y=!1,z=!1,A=0,B=!1,C=!0,E=20,D=20,F=!0,G=!1,H=12,I=!0,J=!1,K=200,u=h.MSE,p=null;q(document).ready(function(){h.audioDescriptions&&0<h.audioDescriptions.length?O(h.audioDescriptions):h.onAudioDescriptionLoad.subscribe(O)})}})(window.jQuery,window.$SimpleMP3Player);