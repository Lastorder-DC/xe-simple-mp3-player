(function(g,e){function k(a){return a?(a=a.toLowerCase(),!!(-1<a.indexOf(".mp3")||-1<a.indexOf(".m4a")||-1<a.indexOf(".ogg"))):!1}if(void 0!==e){var h=e.MSE,l=e.PlayerManager,m=e.PlayerObserver.SimplePlayerObserver,d="undefined"!==typeof navigator&&"mediaSession"in navigator&&navigator.mediaSession||null,p=function(){function a(f,b,c){if(!b||!(h.isSupported()&&b.offsetInfo||b.filePath))throw Error("No source found.");this._targetDOM=f;this._id=n++;this._audio=document.createElement("audio");this._description=
b;this._MSE=null;this._useMediaSession=void 0!==c?c:!0;this._mediaSessionBackwardTime=this._mediaSessionForwardTime=20;this._destruct=!1;this._audio.preload="metadata";this._audio.controls=!0;this._audio.setAttribute("controlslist",["nodownload"]);this._onAudioPlayingHandler=this._onAudioPlaying.bind(this);this._init()}var n=0;a.prototype._init=function(){var f=!0,b=12;if(e&&e.config){var c=e.config;f=c.use_mp3_realtime_streaming;b=c.mp3_realtime_buffer_size;void 0!==c.mediaSessionForwardTime&&(this._mediaSessionForwardTime=
c.mediaSessionForwardTime);void 0!==c.mediaSessionBackwardTime&&(this._mediaSessionBackwardTime=c.mediaSessionBackwardTime)}this._targetDOM.parentNode.replaceChild(this._audio,this._targetDOM);f&&h.isSupported()?(this._MSE=new h(this._audio,this._description.filePath,this._description.offsetInfo,this._description.file_srl,b),this._MSE.provideCacheManager(e.MemoryCacheManager)):(this._audio.src=this._description.filePath,this._audio.load());this._audio.addEventListener("playing",this._onAudioPlayingHandler,
!1)};a.prototype._updateMediaSessionMetadata=function(){if(d)if(void 0!==this._description.tags){var f=e.config,b=f.default_cover;f=f.use_thumbnail;b&&(b=e.convertURL2URI(b));var c=this._description.tags,a=c.albumArt;a||(f&&this._description.thumbnail?a=this._description.thumbnail:b&&(a=b));d.metadata=new window.MediaMetadata({title:c.title?c.title:void 0,artist:c.artist?c.artist:void 0,album:c.album?c.album:void 0,artwork:a?[{src:a}]:void 0})}else d.metadata=void 0};a.prototype._registerMediaSessionHandlers=
function(){if(d){var a=this;d.setActionHandler("play",function(){a._audio.play()});d.setActionHandler("pause",function(){a._audio.pause()});d.setActionHandler("seekbackward",function(){a._audio.currentTime=Math.max(0,a._audio.currentTime-a._mediaSessionBackwardTime)});d.setActionHandler("seekforward",function(){a._audio.currentTime=Math.min(a._audio.duration||0,a._audio.currentTime+a._mediaSessionForwardTime)});d.setActionHandler("previoustrack",null);d.setActionHandler("nexttrack",null)}};a.prototype._onAudioPlaying=
function(){this._useMediaSession&&(this._updateMediaSessionMetadata(),this._registerMediaSessionHandlers())};a.prototype.getAudioNode=function(){return this._audio};a.prototype.destruct=function(){this._destruct||(this._audio.removeEventListener("playing",this._onAudioPlayingHandler,!1),null!==this._playingObserverTimerID&&(window.clearTimeout(this._playingObserverTimerID),this._playingObserverTimerID=null),this._MSE&&this._MSE.destruct())};return a}();g(document).ready(function(){var a=function(a){d&&
(d.remove(),d=null);a&&a.length&&g(".xe_content a").each(function(){var b=g(this),c=b.attr("href"),d=(b=b.attr("data-file-srl")||null)?parseInt(b,10):NaN;k(c)&&(b=a.find(function(a){var b=(a=a.description)&&a.uploaded_filename?a.uploaded_filename.replace(/^.\/files/i,"/files"):null;return d&&!isNaN(d)&&a.file_srl===d||b&&c&&-1<c.indexOf(b)}))&&(b=new p(this,b.description,!(!e.config||!e.config.use_mediasession)),l.registerPlayer(new m(b)))})},d=null;e.audioDescriptions&&0<e.audioDescriptions.length?
a(e.audioDescriptions):d=e.onAudioDescriptionLoad.subscribe(a)})}})(window.jQuery,window.$SimpleMP3Player);