(function(g,f){function n(d){var c=g(".xe_content[class*=document_]");if(c.length){var a=f.config,b=a.default_cover,e=a.use_thumbnail,p=a.link_to_media,y=a.use_mediasession,n=a.mediasession_backward_time,z=a.mediasession_forward_time,A=a.enable_webm,B=a.video_autoplay,C=a.video_autoplay_without_audio,D=a.video_playsinline,E=a.video_loop,F=a.video_loop_without_audio,G=a.video_gif_without_audio,H=a.video_gif_mode_if_click,I=a.video_preload,J=a.video_auto_attach,K=a.video_thumbnail_poster;if(a.enable_video){var k=
a.video_resize?new L(c):null,m=[],t=[],M=[],u=[],x=function(a){var c=a.stream,d=c.video?c.video:null,v=!c.isAudio&&G,g=c.isAudio?B:C,w=c.isAudio?E:F,f=I,p=a.filePath,h=a.tags?a.tags:null,k=document.title;h=h&&h.albumArt?h.albumArt:null;var l=K&&a.poster?a.poster:null,r=d&&d.resolution_x?d.resolution_x:null;d=d&&d.resolution_y?d.resolution_y:null;var q=c?c.isAudio:!1,m=c?c.fileformat:null;if(!A&&"webm"===m)return null;!h&&e&&a.thumbnail&&(h=a.thumbnail);!h&&b&&(h=b);v&&(f="auto",w=g=!0);return c&&
r&&d?new N(a,{loop:w,autoplay:q?!1:g,preload:f,gifMode:v,playsinline:D,enableMediaSession:q&&y,mediaSessionBackwardTime:n,mediaSessionForwardTime:z,title:k,artist:null,album:null,albumArt:h,poster:l,width:r,height:d,hasAudio:q,ifClickToShowControls:H,src:p}):null};if(p){var l=[];c.find("audio, video").each(function(a,c){var d=g(this),b=d.find("source");b.length&&b.each(function(a,c){var d=g(this).attr("src");d&&l.push(d)});(d=d.attr("src"))&&l.push(d)});var O=function(a){return l.find(function(c){return-1<
c.indexOf(a)||-1<a.indexOf(c)})};c.find("a").each(function(){var a=g(this),c=a.attr("href"),b=a.attr("data-file-srl")||null,f=b?parseInt(b,10):NaN;if(b=d.find(function(a){var b=(a=a.description)&&a.uploaded_filename?a.uploaded_filename.replace(/^.\/files/i,"/files"):null;return f&&!isNaN(f)&&a.file_srl===f||b&&c&&-1<c.indexOf(b)})){b=b.description;var e=x(b);e&&(t.push(e),a.replaceWith(e.getPlayer()),m.push(b),k&&k.registerPlayer(e))}})}J&&d.filter(function(a){return a.description&&-1===m.indexOf(a.description)}).reverse().forEach(function(a){a=
a.description;if(!O(a.uploaded_filename)){var b=x(a);if(b){u.unshift(b);var d=g("<p></p>");d.append(b.getPlayer());c.prepend(d);M.push(a);k&&k.registerPlayer(b)}}});t.concat(u).forEach(function(a){!a._gifMode&&a._hasAudio&&P.registerPlayer(new Q(a))})}}}if(void 0!==f){var P=f.PlayerManager,Q=f.PlayerObserver.SimpleVideoPlayerObserver,e="undefined"!==typeof navigator&&"mediaSession"in navigator&&navigator.mediaSession||null,L=function(){function d(c){this._$wrapper=c;this._player=[];this._destructed=
!1;this._onResizeHandler=this._onResize.bind(this);g(window).on("resize",this._onResizeHandler)}d.prototype._onResize=function(c){(c=this._$wrapper.innerWidth())&&this._resizeAllPlayer(c)};d.prototype._resizeAllPlayer=function(c){c||(c=this._$wrapper.innerWidth());var a=this;this._player.forEach(function(b){a._resizePlayer(b,c)})};d.prototype._resizePlayer=function(c,a){void 0===a&&(a=this._$wrapper.innerWidth());var b=c.getResolution();var d=c.getPlayer();if(a&&b&&d){var e=b.width;b=b.height;var f=
a/e;e=Math.min(e,parseInt(e*f,10));b=Math.min(b,parseInt(b*f,10));g(d).css({width:e,height:b})}};d.prototype.registerPlayer=function(c){-1===this._player.indexOf(c)&&(this._player.push(c),this._resizePlayer(c))};d.prototype.unregisterPlayer=function(c){c=this._player.indexOf(c);-1<c&&this._player.splice(c,1)};d.prototype.destruct=function(){this._destructed||(g(window).off("resize",this._onResizeHandler),this._player=[],this._destructed=!0)};return d}(),N=function(){function d(a,b){this._id=c++;this._description=
a;this._video=document.createElement("video");this._loop=b.loop;this._mute=b.mute;this._gifMode=b.gifMode;this._onVideoPlayingHandler=this._onVideoPlaying.bind(this);this._onVideoEndedHandler=this._onVideoEnded.bind(this);this._onVideoClickHandler=this._onVideoClick.bind(this);this._autoplay=b.autoplay;this._preload=b.preload;this._enableMediaSession=b.enableMediaSession;this._mediaSessionForwardTime=void 0!==b.mediaSessionForwardTime?b.mediaSessionForwardTime:10;this._mediaSessionBackwardTime=void 0!==
b.mediaSessionBackwardTime?b.mediaSessionBackwardTime:10;this._playsinline=b.playsinline;this._src=b.src;this._title=b.title;this._artist=b.artist;this._album=b.album;this._albumArt=b.albumArt;this._poster=b.poster||null;this._width=b.width;this._height=b.height;this._hasAudio=b.hasAudio;this._ifClickToShowControls=b.ifClickToShowControls;this._init()}var c=0;d.prototype._init=function(){this._video.addEventListener("playing",this._onVideoPlayingHandler,!1);this._video.addEventListener("ended",this._onVideoEndedHandler,
!1);this._video.addEventListener("click",this._onVideoClickHandler,!1);this._video.preload=this._gifMode?"auto":this._preload;this._video.controls=!0;this._video.setAttribute("controlslist",["nodownload"]);if(this._playsinline||this._gifMode)this._video.setAttribute("playsinline",""),this._video.setAttribute("webkit-playsinline","");this._poster&&this._video.setAttribute("poster",this._poster);this._gifMode&&this._video.hasAttribute("controls")&&this._video.removeAttribute("controls");if(this._mute||
this._gifMode)this._video.muted=!0;this._gifMode||this._video.setAttribute("controls","controls");this._video.src=this._src;this._video.load();this._autoplay&&this.play()};d.prototype._onVideoPlaying=function(){!this._gifMode&&this._enableMediaSession&&(this._registerMediaSessionHandlers(),this._updateMediaSessionMetadata())};d.prototype._onVideoEnded=function(){this._loop&&!isNaN(this._video.duration)&&this._video.duration&&(this.seek(0),this.play())};d.prototype._onVideoClick=function(){this._ifClickToShowControls&&
this._video&&!this._video.hasAttribute("controls")&&this._video.setAttribute("controls","")};d.prototype.seek=function(){!isNaN(this._video.duration)&&this._video.duration&&(this._video.currentTime=0)};d.prototype.play=function(){if(!isNaN(this._video.duration)&&this._video.duration){var a=this._video.play();if(a)a["catch"](function(a){console.error(a)})}else this._video.setAttribute("autoplay","autoplay")};d.prototype._updateMediaSessionMetadata=function(){e&&(e.metadata=new window.MediaMetadata({title:this._title?
this._title:void 0,artist:this._artist?this._artist:void 0,album:this._album?this._album:void 0,artwork:this._poster?[{src:this._poster}]:this._albumArt?[{src:this._albumArt}]:void 0}))};d.prototype._registerMediaSessionHandlers=function(){if(e){var a=this;e.setActionHandler("play",function(){a._video.play()});e.setActionHandler("pause",function(){a._video.pause()});e.setActionHandler("seekbackward",function(){a._video.currentTime=Math.max(0,a._video.currentTime-a._mediaSessionBackwardTime)});e.setActionHandler("seekforward",
function(){a._video.currentTime=Math.min(a._video.duration||0,a._video.currentTime+a._mediaSessionForwardTime)});e.setActionHandler("previoustrack",null);e.setActionHandler("nexttrack",null)}};d.prototype.getVideoNode=function(){return this._video};d.prototype.getPlayer=function(){return this._video};d.prototype.getResolution=function(){return this._width&&this._height?{width:this._width,height:this._height}:null};d.prototype.destruct=function(){this._destruct||(this._video.removeEventListener("playing",
this._onVideoPlayingHandler,!1),this._video.removeEventListener("ended",this._onVideoEndedHandler,!1),this._video.removeEventListener("click",this._onVideoClickHandler,!1),this._destruct=!0)};return d}();g(document).ready(function(){var d=function(a){c&&(c.remove(),c=null);a&&a.length&&n(a)},c=null;f.videoDescriptions&&0<f.videoDescriptions.length?d(f.videoDescriptions):c=f.onVideoDescriptionLoad.subscribe(d)})}})(window.jQuery,window.$SimpleMP3Player);